function t(t,e,i,s){var o,n=arguments.length,r=n<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(r=(n<3?o(r):n>3?o(e,i,r):o(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r}var e,i,s={};function o(t){return Math.PI*t/180}function n(t,e){let i=t.exec(e);return i?i[1]:""}function r(t){return t.toString().padStart(2,"0")}!function(t){/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var e,i,s,o,n,r,a,m,h,c,_,l,u,p,d=function(t,e){return(d=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)};function y(t,e){if("function"!=typeof e&&null!==e)throw TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}d(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var f=function(){return(f=Object.assign||function(t){for(var e,i=1,s=arguments.length;i<s;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function v(t,e){null==t&&(t={});var i=f({},t);for(var s in e)e.hasOwnProperty(s)&&void 0===t[s]&&(i[s]=e[s]);if("function"==typeof Object.getOwnPropertySymbols)for(var o=Object.getOwnPropertySymbols(e),n=0;n<o.length;n++){var r=o[n];e.propertyIsEnumerable(r)&&void 0===t[r]&&(i[r]=e[r])}return i}var x={debug:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}},g=Object.create(Math);g.EPSILON=1e-9,g.isFinite=function(t){return"number"==typeof t&&isFinite(t)&&!isNaN(t)},g.assert=function(t){},g.invSqrt=function(t){return 1/Math.sqrt(t)},g.nextPowerOfTwo=function(t){return t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,(t|=t>>16)+1},g.isPowerOfTwo=function(t){return t>0&&(t&t-1)==0},g.mod=function(t,e,i){return(void 0===e?(i=1,e=0):void 0===i&&(i=e,e=0),i>e)?(t=(t-e)%(i-e))+(t<0?i:e):(t=(t-i)%(e-i))+(t<=0?e:i)},g.clamp=function(t,e,i){return t<e?e:t>i?i:t},g.random=function(t,e){return void 0===t?(e=1,t=0):void 0===e&&(e=t,t=0),t===e?t:Math.random()*(e-t)+t};var b=function(){function t(e,i){if(!(this instanceof t))return new t(e,i);void 0===e?(this.x=0,this.y=0):"object"==typeof e?(this.x=e.x,this.y=e.y):(this.x=e,this.y=i)}return t.prototype._serialize=function(){return{x:this.x,y:this.y}},t._deserialize=function(e){var i=Object.create(t.prototype);return i.x=e.x,i.y=e.y,i},t.zero=function(){var e=Object.create(t.prototype);return e.x=0,e.y=0,e},t.neo=function(e,i){var s=Object.create(t.prototype);return s.x=e,s.y=i,s},t.clone=function(e){return t.neo(e.x,e.y)},t.prototype.toString=function(){return JSON.stringify(this)},t.isValid=function(t){return null!=t&&g.isFinite(t.x)&&g.isFinite(t.y)},t.assert=function(t){},t.prototype.clone=function(){return t.clone(this)},t.prototype.setZero=function(){return this.x=0,this.y=0,this},t.prototype.set=function(t,e){return"object"==typeof t?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),this},t.prototype.setNum=function(t,e){return this.x=t,this.y=e,this},t.prototype.setVec2=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.wSet=function(t,e,i,s){return void 0!==i||void 0!==s?this.setCombine(t,e,i,s):this.setMul(t,e)},t.prototype.setCombine=function(t,e,i,s){var o=t*e.x+i*s.x,n=t*e.y+i*s.y;return this.x=o,this.y=n,this},t.prototype.setMul=function(t,e){var i=t*e.x,s=t*e.y;return this.x=i,this.y=s,this},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.wAdd=function(t,e,i,s){return void 0!==i||void 0!==s?this.addCombine(t,e,i,s):this.addMul(t,e)},t.prototype.addCombine=function(t,e,i,s){var o=t*e.x+i*s.x,n=t*e.y+i*s.y;return this.x+=o,this.y+=n,this},t.prototype.addMul=function(t,e){var i=t*e.x,s=t*e.y;return this.x+=i,this.y+=s,this},t.prototype.wSub=function(t,e,i,s){return void 0!==i||void 0!==s?this.subCombine(t,e,i,s):this.subMul(t,e)},t.prototype.subCombine=function(t,e,i,s){var o=t*e.x+i*s.x,n=t*e.y+i*s.y;return this.x-=o,this.y-=n,this},t.prototype.subMul=function(t,e){var i=t*e.x,s=t*e.y;return this.x-=i,this.y-=s,this},t.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.mul=function(t){return this.x*=t,this.y*=t,this},t.prototype.length=function(){return t.lengthOf(this)},t.prototype.lengthSquared=function(){return t.lengthSquared(this)},t.prototype.normalize=function(){var t=this.length();if(t<g.EPSILON)return 0;var e=1/t;return this.x*=e,this.y*=e,t},t.lengthOf=function(t){return g.sqrt(t.x*t.x+t.y*t.y)},t.lengthSquared=function(t){return t.x*t.x+t.y*t.y},t.distance=function(t,e){var i=t.x-e.x,s=t.y-e.y;return g.sqrt(i*i+s*s)},t.distanceSquared=function(t,e){var i=t.x-e.x,s=t.y-e.y;return i*i+s*s},t.areEqual=function(t,e){return t===e||"object"==typeof e&&null!==e&&t.x===e.x&&t.y===e.y},t.skew=function(e){return t.neo(-e.y,e.x)},t.dot=function(t,e){return t.x*e.x+t.y*e.y},t.cross=function(e,i){return"number"==typeof i?t.neo(i*e.y,-i*e.x):"number"==typeof e?t.neo(-e*i.y,e*i.x):e.x*i.y-e.y*i.x},t.crossVec2Vec2=function(t,e){return t.x*e.y-t.y*e.x},t.crossVec2Num=function(e,i){return t.neo(i*e.y,-i*e.x)},t.crossNumVec2=function(e,i){return t.neo(-e*i.y,e*i.x)},t.addCross=function(e,i,s){return"number"==typeof s?t.neo(s*i.y+e.x,-s*i.x+e.y):"number"==typeof i?t.neo(-i*s.y+e.x,i*s.x+e.y):void 0},t.addCrossVec2Num=function(e,i,s){return t.neo(s*i.y+e.x,-s*i.x+e.y)},t.addCrossNumVec2=function(e,i,s){return t.neo(-i*s.y+e.x,i*s.x+e.y)},t.add=function(e,i){return t.neo(e.x+i.x,e.y+i.y)},t.wAdd=function(e,i,s,o){return void 0!==s||void 0!==o?t.combine(e,i,s,o):t.mulNumVec2(e,i)},t.combine=function(e,i,s,o){return t.zero().setCombine(e,i,s,o)},t.sub=function(e,i){return t.neo(e.x-i.x,e.y-i.y)},t.mul=function(e,i){return"object"==typeof e?t.neo(e.x*i,e.y*i):"object"==typeof i?t.neo(e*i.x,e*i.y):void 0},t.mulVec2Num=function(e,i){return t.neo(e.x*i,e.y*i)},t.mulNumVec2=function(e,i){return t.neo(e*i.x,e*i.y)},t.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this},t.neg=function(e){return t.neo(-e.x,-e.y)},t.abs=function(e){return t.neo(g.abs(e.x),g.abs(e.y))},t.mid=function(e,i){return t.neo((e.x+i.x)*.5,(e.y+i.y)*.5)},t.upper=function(e,i){return t.neo(g.max(e.x,i.x),g.max(e.y,i.y))},t.lower=function(e,i){return t.neo(g.min(e.x,i.x),g.min(e.y,i.y))},t.prototype.clamp=function(t){var e=this.x*this.x+this.y*this.y;if(e>t*t){var i=g.invSqrt(e);this.x*=i*t,this.y*=i*t}return this},t.clamp=function(e,i){return(e=t.neo(e.x,e.y)).clamp(i),e},t.scaleFn=function(e,i){return function(s){return t.neo(s.x*e,s.y*i)}},t.translateFn=function(e,i){return function(s){return t.neo(s.x+e,s.y+i)}},t}(),A=function(){function t(e,i){if(!(this instanceof t))return new t(e,i);this.lowerBound=b.zero(),this.upperBound=b.zero(),"object"==typeof e&&this.lowerBound.setVec2(e),"object"==typeof i?this.upperBound.setVec2(i):"object"==typeof e&&this.upperBound.setVec2(e)}return t.prototype.isValid=function(){return t.isValid(this)},t.isValid=function(t){return null!=t&&b.isValid(t.lowerBound)&&b.isValid(t.upperBound)&&b.sub(t.upperBound,t.lowerBound).lengthSquared()>=0},t.assert=function(t){},t.prototype.getCenter=function(){return b.neo((this.lowerBound.x+this.upperBound.x)*.5,(this.lowerBound.y+this.upperBound.y)*.5)},t.prototype.getExtents=function(){return b.neo((this.upperBound.x-this.lowerBound.x)*.5,(this.upperBound.y-this.lowerBound.y)*.5)},t.prototype.getPerimeter=function(){return 2*(this.upperBound.x-this.lowerBound.x+this.upperBound.y-this.lowerBound.y)},t.prototype.combine=function(t,e){e=e||this;var i=t.lowerBound,s=t.upperBound,o=e.lowerBound,n=e.upperBound,r=g.min(i.x,o.x),a=g.min(i.y,o.y),m=g.max(n.x,s.x),h=g.max(n.y,s.y);this.lowerBound.setNum(r,a),this.upperBound.setNum(m,h)},t.prototype.combinePoints=function(t,e){this.lowerBound.setNum(g.min(t.x,e.x),g.min(t.y,e.y)),this.upperBound.setNum(g.max(t.x,e.x),g.max(t.y,e.y))},t.prototype.set=function(t){this.lowerBound.setNum(t.lowerBound.x,t.lowerBound.y),this.upperBound.setNum(t.upperBound.x,t.upperBound.y)},t.prototype.contains=function(t){return this.lowerBound.x<=t.lowerBound.x&&this.lowerBound.y<=t.lowerBound.y&&t.upperBound.x<=this.upperBound.x&&t.upperBound.y<=this.upperBound.y},t.prototype.extend=function(e){return t.extend(this,e),this},t.extend=function(t,e){t.lowerBound.x-=e,t.lowerBound.y-=e,t.upperBound.x+=e,t.upperBound.y+=e},t.testOverlap=function(t,e){var i=e.lowerBound.x-t.upperBound.x,s=t.lowerBound.x-e.upperBound.x,o=e.lowerBound.y-t.upperBound.y,n=t.lowerBound.y-e.upperBound.y;return!(i>0)&&!(o>0)&&!(s>0)&&!(n>0)},t.areEqual=function(t,e){return b.areEqual(t.lowerBound,e.lowerBound)&&b.areEqual(t.upperBound,e.upperBound)},t.diff=function(t,e){var i=g.max(0,g.min(t.upperBound.x,e.upperBound.x)-g.max(e.lowerBound.x,t.lowerBound.x)),s=g.max(0,g.min(t.upperBound.y,e.upperBound.y)-g.max(e.lowerBound.y,t.lowerBound.y));return(t.upperBound.x-t.lowerBound.x)*(t.upperBound.y-t.lowerBound.y)+(e.upperBound.x-e.lowerBound.x)*(e.upperBound.y-e.lowerBound.y)-i*s},t.prototype.rayCast=function(t,e){for(var i=-1/0,s=1/0,o=e.p1,n=b.sub(e.p2,e.p1),r=b.abs(n),a=b.zero(),m="x";null!==m;m="x"===m?"y":null)if(r.x<g.EPSILON){if(o[m]<this.lowerBound[m]||this.upperBound[m]<o[m])return!1}else{var h=1/n[m],c=(this.lowerBound[m]-o[m])*h,_=(this.upperBound[m]-o[m])*h,l=-1;if(c>_){var u=c;c=_,_=u,l=1}if(c>i&&(a.setZero(),a[m]=l,i=c),i>(s=g.min(s,_)))return!1}return!(i<0)&&!(e.maxFraction<i)&&(t.fraction=i,t.normal=a,!0)},t.prototype.toString=function(){return JSON.stringify(this)},t}(),B=function(){function t(){}return Object.defineProperty(t,"linearSlopSquared",{get:function(){return t.linearSlop*t.linearSlop},enumerable:!1,configurable:!0}),Object.defineProperty(t,"polygonRadius",{get:function(){return 2*t.linearSlop},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxTranslationSquared",{get:function(){return t.maxTranslation*t.maxTranslation},enumerable:!1,configurable:!0}),Object.defineProperty(t,"maxRotationSquared",{get:function(){return t.maxRotation*t.maxRotation},enumerable:!1,configurable:!0}),Object.defineProperty(t,"linearSleepToleranceSqr",{get:function(){return Math.pow(t.linearSleepTolerance,2)},enumerable:!1,configurable:!0}),Object.defineProperty(t,"angularSleepToleranceSqr",{get:function(){return Math.pow(t.angularSleepTolerance,2)},enumerable:!1,configurable:!0}),t.maxManifoldPoints=2,t.maxPolygonVertices=12,t.aabbExtension=.1,t.aabbMultiplier=2,t.linearSlop=.005,t.angularSlop=2/180*Math.PI,t.maxSubSteps=8,t.maxTOIContacts=32,t.maxTOIIterations=20,t.maxDistnceIterations=20,t.velocityThreshold=1,t.maxLinearCorrection=.2,t.maxAngularCorrection=8/180*Math.PI,t.maxTranslation=2,t.maxRotation=.5*Math.PI,t.baumgarte=.2,t.toiBaugarte=.75,t.timeToSleep=.5,t.linearSleepTolerance=.01,t.angularSleepTolerance=2/180*Math.PI,t}(),w=function(){function t(t){this._list=[],this._max=1/0,this._createCount=0,this._outCount=0,this._inCount=0,this._discardCount=0,this._list=[],this._max=t.max||this._max,this._createFn=t.create,this._outFn=t.allocate,this._inFn=t.release,this._discardFn=t.discard}return t.prototype.max=function(t){return"number"==typeof t?(this._max=t,this):this._max},t.prototype.size=function(){return this._list.length},t.prototype.allocate=function(){var t;return this._list.length>0?t=this._list.shift():(this._createCount++,t="function"==typeof this._createFn?this._createFn():{}),this._outCount++,"function"==typeof this._outFn&&this._outFn(t),t},t.prototype.release=function(t){this._list.length<this._max?(this._inCount++,"function"==typeof this._inFn&&this._inFn(t),this._list.push(t)):(this._discardCount++,"function"==typeof this._discardFn&&(t=this._discardFn(t)))},t.prototype.toString=function(){return" +"+this._createCount+" >"+this._outCount+" <"+this._inCount+" -"+this._discardCount+" ="+this._list.length+"/"+this._max},t}(),V=function(){function t(t){this.aabb=new A,this.userData=null,this.parent=null,this.child1=null,this.child2=null,this.height=-1,this.id=t}return t.prototype.toString=function(){return this.id+": "+this.userData},t.prototype.isLeaf=function(){return null==this.child1},t}(),C=function(){function t(){this.inputPool=new w({create:function(){return{}},release:function(t){}}),this.stackPool=new w({create:function(){return[]},release:function(t){t.length=0}}),this.iteratorPool=new w({create:function(){return new M},release:function(t){t.close()}}),this.m_root=null,this.m_nodes={},this.m_lastProxyId=0,this.m_pool=new w({create:function(){return new V}})}return t.prototype.getUserData=function(t){return this.m_nodes[t].userData},t.prototype.getFatAABB=function(t){return this.m_nodes[t].aabb},t.prototype.allocateNode=function(){var t=this.m_pool.allocate();return t.id=++this.m_lastProxyId,t.userData=null,t.parent=null,t.child1=null,t.child2=null,t.height=-1,this.m_nodes[t.id]=t,t},t.prototype.freeNode=function(t){this.m_pool.release(t),t.height=-1,delete this.m_nodes[t.id]},t.prototype.createProxy=function(t,e){var i=this.allocateNode();return i.aabb.set(t),A.extend(i.aabb,B.aabbExtension),i.userData=e,i.height=0,this.insertLeaf(i),i.id},t.prototype.destroyProxy=function(t){var e=this.m_nodes[t];this.removeLeaf(e),this.freeNode(e)},t.prototype.moveProxy=function(t,e,i){var s=this.m_nodes[t];return!s.aabb.contains(e)&&(this.removeLeaf(s),s.aabb.set(e),e=s.aabb,A.extend(e,B.aabbExtension),i.x<0?e.lowerBound.x+=i.x*B.aabbMultiplier:e.upperBound.x+=i.x*B.aabbMultiplier,i.y<0?e.lowerBound.y+=i.y*B.aabbMultiplier:e.upperBound.y+=i.y*B.aabbMultiplier,this.insertLeaf(s),!0)},t.prototype.insertLeaf=function(t){if(null==this.m_root){this.m_root=t,this.m_root.parent=null;return}for(var e=t.aabb,i=this.m_root;!i.isLeaf();){var s=i.child1,o=i.child2,n=i.aabb.getPerimeter(),r=new A;r.combine(i.aabb,e);var a=r.getPerimeter(),m=2*a,h=2*(a-n),c=void 0;if(s.isLeaf()){var _=new A;_.combine(e,s.aabb),c=_.getPerimeter()+h}else{var _=new A;_.combine(e,s.aabb);var l=s.aabb.getPerimeter(),u=_.getPerimeter();c=u-l+h}var p=void 0;if(o.isLeaf()){var _=new A;_.combine(e,o.aabb),p=_.getPerimeter()+h}else{var _=new A;_.combine(e,o.aabb);var l=o.aabb.getPerimeter(),u=_.getPerimeter();p=u-l+h}if(m<c&&m<p)break;i=c<p?s:o}var d=i,y=d.parent,f=this.allocateNode();for(f.parent=y,f.userData=null,f.aabb.combine(e,d.aabb),f.height=d.height+1,null!=y?(y.child1===d?y.child1=f:y.child2=f,f.child1=d,f.child2=t,d.parent=f,t.parent=f):(f.child1=d,f.child2=t,d.parent=f,t.parent=f,this.m_root=f),i=t.parent;null!=i;){var s=(i=this.balance(i)).child1,o=i.child2;i.height=1+g.max(s.height,o.height),i.aabb.combine(s.aabb,o.aabb),i=i.parent}},t.prototype.removeLeaf=function(t){if(t===this.m_root){this.m_root=null;return}var e,i=t.parent,s=i.parent;if(e=i.child1===t?i.child2:i.child1,null!=s){s.child1===i?s.child1=e:s.child2=e,e.parent=s,this.freeNode(i);for(var o=s;null!=o;){var n=(o=this.balance(o)).child1,r=o.child2;o.aabb.combine(n.aabb,r.aabb),o.height=1+g.max(n.height,r.height),o=o.parent}}else this.m_root=e,e.parent=null,this.freeNode(i)},t.prototype.balance=function(t){if(t.isLeaf()||t.height<2)return t;var e=t.child1,i=t.child2,s=i.height-e.height;if(s>1){var o=i.child1,n=i.child2;return i.child1=t,i.parent=t.parent,t.parent=i,null!=i.parent?i.parent.child1===t?i.parent.child1=i:i.parent.child2=i:this.m_root=i,o.height>n.height?(i.child2=o,t.child2=n,n.parent=t,t.aabb.combine(e.aabb,n.aabb),i.aabb.combine(t.aabb,o.aabb),t.height=1+g.max(e.height,n.height),i.height=1+g.max(t.height,o.height)):(i.child2=n,t.child2=o,o.parent=t,t.aabb.combine(e.aabb,o.aabb),i.aabb.combine(t.aabb,n.aabb),t.height=1+g.max(e.height,o.height),i.height=1+g.max(t.height,n.height)),i}if(s<-1){var r=e.child1,a=e.child2;return e.child1=t,e.parent=t.parent,t.parent=e,null!=e.parent?e.parent.child1===t?e.parent.child1=e:e.parent.child2=e:this.m_root=e,r.height>a.height?(e.child2=r,t.child1=a,a.parent=t,t.aabb.combine(i.aabb,a.aabb),e.aabb.combine(t.aabb,r.aabb),t.height=1+g.max(i.height,a.height),e.height=1+g.max(t.height,r.height)):(e.child2=a,t.child1=r,r.parent=t,t.aabb.combine(i.aabb,r.aabb),e.aabb.combine(t.aabb,a.aabb),t.height=1+g.max(i.height,r.height),e.height=1+g.max(t.height,a.height)),e}return t},t.prototype.getHeight=function(){return null==this.m_root?0:this.m_root.height},t.prototype.getAreaRatio=function(){if(null==this.m_root)return 0;for(var t,e=this.m_root.aabb.getPerimeter(),i=0,s=this.iteratorPool.allocate().preorder(this.m_root);t=s.next();)t.height<0||(i+=t.aabb.getPerimeter());return this.iteratorPool.release(s),i/e},t.prototype.computeHeight=function(t){if((e=void 0!==t?this.m_nodes[t]:this.m_root).isLeaf())return 0;var e,i=this.computeHeight(e.child1.id),s=this.computeHeight(e.child2.id);return 1+g.max(i,s)},t.prototype.validateStructure=function(t){if(null!=t){this.m_root;var e=t.child1,i=t.child2;t.isLeaf()||(this.validateStructure(e),this.validateStructure(i))}},t.prototype.validateMetrics=function(t){if(null!=t){var e=t.child1,i=t.child2;if(!t.isLeaf()){var s=e.height,o=i.height;g.max(s,o),new A().combine(e.aabb,i.aabb),this.validateMetrics(e),this.validateMetrics(i)}}},t.prototype.validate=function(){this.validateStructure(this.m_root),this.validateMetrics(this.m_root)},t.prototype.getMaxBalance=function(){for(var t,e=0,i=this.iteratorPool.allocate().preorder(this.m_root);t=i.next();)if(!(t.height<=1)){var s=g.abs(t.child2.height-t.child1.height);e=g.max(e,s)}return this.iteratorPool.release(i),e},t.prototype.rebuildBottomUp=function(){for(var t,e=[],i=0,s=this.iteratorPool.allocate().preorder(this.m_root);t=s.next();)!(t.height<0)&&(t.isLeaf()?(t.parent=null,e[i]=t,++i):this.freeNode(t));for(this.iteratorPool.release(s);i>1;){for(var o=1/0,n=-1,r=-1,a=0;a<i;++a)for(var m=e[a].aabb,h=a+1;h<i;++h){var c=e[h].aabb,_=new A;_.combine(m,c);var l=_.getPerimeter();l<o&&(n=a,r=h,o=l)}var u=e[n],p=e[r],d=this.allocateNode();d.child1=u,d.child2=p,d.height=1+g.max(u.height,p.height),d.aabb.combine(u.aabb,p.aabb),d.parent=null,u.parent=d,p.parent=d,e[r]=e[i-1],e[n]=d,--i}this.m_root=e[0],this.validate()},t.prototype.shiftOrigin=function(t){for(var e,i=this.iteratorPool.allocate().preorder(this.m_root);e=i.next();){var s=e.aabb;s.lowerBound.x-=t.x,s.lowerBound.y-=t.y,s.upperBound.x-=t.x,s.upperBound.y-=t.y}this.iteratorPool.release(i)},t.prototype.query=function(t,e){var i=this.stackPool.allocate();for(i.push(this.m_root);i.length>0;){var s=i.pop();if(null!=s&&A.testOverlap(s.aabb,t)){if(s.isLeaf()){if(!1===e(s.id))return}else i.push(s.child1),i.push(s.child2)}}this.stackPool.release(i)},t.prototype.rayCast=function(t,e){var i=t.p1,s=t.p2,o=b.sub(s,i);o.normalize();var n=b.crossNumVec2(1,o),r=b.abs(n),a=t.maxFraction,m=new A,h=b.combine(1-a,i,a,s);m.combinePoints(i,h);var c=this.stackPool.allocate(),_=this.inputPool.allocate();for(c.push(this.m_root);c.length>0;){var l=c.pop();if(null!=l&&!1!==A.testOverlap(l.aabb,m)){var u=l.aabb.getCenter(),p=l.aabb.getExtents();if(!(g.abs(b.dot(n,b.sub(i,u)))-b.dot(r,p)>0)){if(l.isLeaf()){_.p1=b.clone(t.p1),_.p2=b.clone(t.p2),_.maxFraction=a;var d=e(_,l.id);if(0===d)return;d>0&&(a=d,h=b.combine(1-a,i,a,s),m.combinePoints(i,h))}else c.push(l.child1),c.push(l.child2)}}}this.stackPool.release(c),this.inputPool.release(_)},t}(),M=function(){function t(){this.parents=[],this.states=[]}return t.prototype.preorder=function(t){return this.parents.length=0,this.parents.push(t),this.states.length=0,this.states.push(0),this},t.prototype.next=function(){for(;this.parents.length>0;){var t=this.parents.length-1,e=this.parents[t];if(0===this.states[t])return this.states[t]=1,e;if(1===this.states[t]&&(this.states[t]=2,e.child1))return this.parents.push(e.child1),this.states.push(1),e.child1;if(2===this.states[t]&&(this.states[t]=3,e.child2))return this.parents.push(e.child2),this.states.push(1),e.child2;this.parents.pop(),this.states.pop()}},t.prototype.close=function(){this.parents.length=0},t}(),I=function(){function t(){var t=this;this.m_tree=new C,this.m_proxyCount=0,this.m_moveBuffer=[],this.query=function(e,i){t.m_tree.query(e,i)},this.queryCallback=function(e){if(e===t.m_queryProxyId)return!0;var i=g.min(e,t.m_queryProxyId),s=g.max(e,t.m_queryProxyId),o=t.m_tree.getUserData(i),n=t.m_tree.getUserData(s);return t.m_callback(o,n),!0}}return t.prototype.getUserData=function(t){return this.m_tree.getUserData(t)},t.prototype.testOverlap=function(t,e){var i=this.m_tree.getFatAABB(t),s=this.m_tree.getFatAABB(e);return A.testOverlap(i,s)},t.prototype.getFatAABB=function(t){return this.m_tree.getFatAABB(t)},t.prototype.getProxyCount=function(){return this.m_proxyCount},t.prototype.getTreeHeight=function(){return this.m_tree.getHeight()},t.prototype.getTreeBalance=function(){return this.m_tree.getMaxBalance()},t.prototype.getTreeQuality=function(){return this.m_tree.getAreaRatio()},t.prototype.rayCast=function(t,e){this.m_tree.rayCast(t,e)},t.prototype.shiftOrigin=function(t){this.m_tree.shiftOrigin(t)},t.prototype.createProxy=function(t,e){var i=this.m_tree.createProxy(t,e);return this.m_proxyCount++,this.bufferMove(i),i},t.prototype.destroyProxy=function(t){this.unbufferMove(t),this.m_proxyCount--,this.m_tree.destroyProxy(t)},t.prototype.moveProxy=function(t,e,i){this.m_tree.moveProxy(t,e,i)&&this.bufferMove(t)},t.prototype.touchProxy=function(t){this.bufferMove(t)},t.prototype.bufferMove=function(t){this.m_moveBuffer.push(t)},t.prototype.unbufferMove=function(t){for(var e=0;e<this.m_moveBuffer.length;++e)this.m_moveBuffer[e]===t&&(this.m_moveBuffer[e]=null)},t.prototype.updatePairs=function(t){for(this.m_callback=t;this.m_moveBuffer.length>0;)if(this.m_queryProxyId=this.m_moveBuffer.pop(),null!==this.m_queryProxyId){var e=this.m_tree.getFatAABB(this.m_queryProxyId);this.m_tree.query(e,this.queryCallback)}},t}(),z=function(){function t(e){if(!(this instanceof t))return new t(e);"number"==typeof e?this.setAngle(e):"object"==typeof e?this.setRot(e):this.setIdentity()}return t.neo=function(e){var i=Object.create(t.prototype);return i.setAngle(e),i},t.clone=function(e){var i=Object.create(t.prototype);return i.s=e.s,i.c=e.c,i},t.identity=function(){var e=Object.create(t.prototype);return e.s=0,e.c=1,e},t.isValid=function(t){return null!=t&&g.isFinite(t.s)&&g.isFinite(t.c)},t.assert=function(t){},t.prototype.setIdentity=function(){this.s=0,this.c=1},t.prototype.set=function(t){"object"==typeof t?(this.s=t.s,this.c=t.c):(this.s=g.sin(t),this.c=g.cos(t))},t.prototype.setRot=function(t){this.s=t.s,this.c=t.c},t.prototype.setAngle=function(t){this.s=g.sin(t),this.c=g.cos(t)},t.prototype.getAngle=function(){return g.atan2(this.s,this.c)},t.prototype.getXAxis=function(){return b.neo(this.c,this.s)},t.prototype.getYAxis=function(){return b.neo(-this.s,this.c)},t.mul=function(e,i){if("c"in i&&"s"in i){var s=t.identity();return s.s=e.s*i.c+e.c*i.s,s.c=e.c*i.c-e.s*i.s,s}if("x"in i&&"y"in i)return b.neo(e.c*i.x-e.s*i.y,e.s*i.x+e.c*i.y)},t.mulRot=function(e,i){var s=t.identity();return s.s=e.s*i.c+e.c*i.s,s.c=e.c*i.c-e.s*i.s,s},t.mulVec2=function(t,e){return b.neo(t.c*e.x-t.s*e.y,t.s*e.x+t.c*e.y)},t.mulSub=function(t,e,i){var s=t.c*(e.x-i.x)-t.s*(e.y-i.y),o=t.s*(e.x-i.x)+t.c*(e.y-i.y);return b.neo(s,o)},t.mulT=function(e,i){if("c"in i&&"s"in i){var s=t.identity();return s.s=e.c*i.s-e.s*i.c,s.c=e.c*i.c+e.s*i.s,s}if("x"in i&&"y"in i)return b.neo(e.c*i.x+e.s*i.y,-e.s*i.x+e.c*i.y)},t.mulTRot=function(e,i){var s=t.identity();return s.s=e.c*i.s-e.s*i.c,s.c=e.c*i.c+e.s*i.s,s},t.mulTVec2=function(t,e){return b.neo(t.c*e.x+t.s*e.y,-t.s*e.x+t.c*e.y)},t}(),P=function(){function t(e,i){if(!(this instanceof t))return new t(e,i);this.p=b.zero(),this.q=z.identity(),void 0!==e&&this.p.setVec2(e),void 0!==i&&this.q.setAngle(i)}return t.clone=function(e){var i=Object.create(t.prototype);return i.p=b.clone(e.p),i.q=z.clone(e.q),i},t.neo=function(e,i){var s=Object.create(t.prototype);return s.p=b.clone(e),s.q=z.clone(i),s},t.identity=function(){var e=Object.create(t.prototype);return e.p=b.zero(),e.q=z.identity(),e},t.prototype.setIdentity=function(){this.p.setZero(),this.q.setIdentity()},t.prototype.set=function(t,e){void 0===e?(this.p.set(t.p),this.q.set(t.q)):(this.p.set(t),this.q.set(e))},t.prototype.setNum=function(t,e){this.p.setVec2(t),this.q.setAngle(e)},t.prototype.setTransform=function(t){this.p.setVec2(t.p),this.q.setRot(t.q)},t.isValid=function(t){return null!=t&&b.isValid(t.p)&&z.isValid(t.q)},t.assert=function(t){},t.mul=function(e,i){if(Array.isArray(i)){for(var s=[],o=0;o<i.length;o++)s[o]=t.mul(e,i[o]);return s}return"x"in i&&"y"in i?t.mulVec2(e,i):"p"in i&&"q"in i?t.mulXf(e,i):void 0},t.mulAll=function(e,i){for(var s=[],o=0;o<i.length;o++)s[o]=t.mul(e,i[o]);return s},t.mulFn=function(e){return function(i){return t.mul(e,i)}},t.mulVec2=function(t,e){var i=t.q.c*e.x-t.q.s*e.y+t.p.x,s=t.q.s*e.x+t.q.c*e.y+t.p.y;return b.neo(i,s)},t.mulXf=function(e,i){var s=t.identity();return s.q=z.mulRot(e.q,i.q),s.p=b.add(z.mulVec2(e.q,i.p),e.p),s},t.mulT=function(e,i){return"x"in i&&"y"in i?t.mulTVec2(e,i):"p"in i&&"q"in i?t.mulTXf(e,i):void 0},t.mulTVec2=function(t,e){var i=e.x-t.p.x,s=e.y-t.p.y,o=t.q.c*i+t.q.s*s,n=-t.q.s*i+t.q.c*s;return b.neo(o,n)},t.mulTXf=function(e,i){var s=t.identity();return s.q.setRot(z.mulTRot(e.q,i.q)),s.p.setVec2(z.mulTVec2(e.q,b.sub(i.p,e.p))),s},t}(),S=function(){function t(t,e){this.localCenter=b.zero(),this.c=b.zero(),this.a=0,this.alpha0=0,this.c0=b.zero(),this.a0=0}return t.prototype.setTransform=function(t){var e=P.mulVec2(t,this.localCenter);this.c.setVec2(e),this.c0.setVec2(e),this.a=t.q.getAngle(),this.a0=t.q.getAngle()},t.prototype.setLocalCenter=function(t,e){this.localCenter.setVec2(t);var i=P.mulVec2(e,this.localCenter);this.c.setVec2(i),this.c0.setVec2(i)},t.prototype.getTransform=function(t,e){void 0===e&&(e=0),t.q.setAngle((1-e)*this.a0+e*this.a),t.p.setCombine(1-e,this.c0,e,this.c),t.p.sub(z.mulVec2(t.q,this.localCenter))},t.prototype.advance=function(t){var e=(t-this.alpha0)/(1-this.alpha0);this.c0.setCombine(e,this.c,1-e,this.c0),this.a0=e*this.a+(1-e)*this.a0,this.alpha0=t},t.prototype.forward=function(){this.a0=this.a,this.c0.setVec2(this.c)},t.prototype.normalize=function(){var t=g.mod(this.a0,-g.PI,+g.PI);this.a-=this.a0-t,this.a0=t},t.prototype.clone=function(){var e=new t;return e.localCenter.setVec2(this.localCenter),e.alpha0=this.alpha0,e.a0=this.a0,e.a=this.a,e.c0.setVec2(this.c0),e.c.setVec2(this.c),e},t.prototype.set=function(t){this.localCenter.setVec2(t.localCenter),this.alpha0=t.alpha0,this.a0=t.a0,this.a=t.a,this.c0.setVec2(t.c0),this.c.setVec2(t.c)},t}(),T=function(){this.v=b.zero(),this.w=0},L=function(){function t(){this.c=b.zero(),this.a=0}return t.prototype.getTransform=function(t,e){return t.q.setAngle(this.a),t.p.setVec2(b.sub(this.c,z.mulVec2(t.q,e))),t},t}(),F=function(){function t(){}return t.prototype._reset=function(){},t.isValid=function(t){return null!=t&&"string"==typeof t.m_type&&"number"==typeof t.m_radius},t.prototype.getRadius=function(){return this.m_radius},t.prototype.getType=function(){return this.m_type},t}(),k={userData:null,friction:.2,restitution:0,density:0,isSensor:!1,filterGroupIndex:0,filterCategoryBits:1,filterMaskBits:65535},q=function(t,e){this.aabb=new A,this.fixture=t,this.childIndex=e,this.proxyId},N=function(){function t(t,e,i){e.shape?(i=e,e=e.shape):"number"==typeof i&&(i={density:i}),i=v(i,k),this.m_body=t,this.m_friction=i.friction,this.m_restitution=i.restitution,this.m_density=i.density,this.m_isSensor=i.isSensor,this.m_filterGroupIndex=i.filterGroupIndex,this.m_filterCategoryBits=i.filterCategoryBits,this.m_filterMaskBits=i.filterMaskBits,this.m_shape=e,this.m_next=null,this.m_proxies=[],this.m_proxyCount=0;for(var s=this.m_shape.getChildCount(),o=0;o<s;++o)this.m_proxies[o]=new q(this,o);this.m_userData=i.userData}return t.prototype._reset=function(){var t=this.getBody(),e=t.m_world.m_broadPhase;this.destroyProxies(e),this.m_shape._reset&&this.m_shape._reset();for(var i=this.m_shape.getChildCount(),s=0;s<i;++s)this.m_proxies[s]=new q(this,s);this.createProxies(e,t.m_xf),t.resetMassData()},t.prototype._serialize=function(){return{friction:this.m_friction,restitution:this.m_restitution,density:this.m_density,isSensor:this.m_isSensor,filterGroupIndex:this.m_filterGroupIndex,filterCategoryBits:this.m_filterCategoryBits,filterMaskBits:this.m_filterMaskBits,shape:this.m_shape}},t._deserialize=function(e,i,s){var o=s(F,e.shape);return o&&new t(i,o,e)},t.prototype.getType=function(){return this.m_shape.getType()},t.prototype.getShape=function(){return this.m_shape},t.prototype.isSensor=function(){return this.m_isSensor},t.prototype.setSensor=function(t){t!=this.m_isSensor&&(this.m_body.setAwake(!0),this.m_isSensor=t)},t.prototype.getUserData=function(){return this.m_userData},t.prototype.setUserData=function(t){this.m_userData=t},t.prototype.getBody=function(){return this.m_body},t.prototype.getNext=function(){return this.m_next},t.prototype.getDensity=function(){return this.m_density},t.prototype.setDensity=function(t){this.m_density=t},t.prototype.getFriction=function(){return this.m_friction},t.prototype.setFriction=function(t){this.m_friction=t},t.prototype.getRestitution=function(){return this.m_restitution},t.prototype.setRestitution=function(t){this.m_restitution=t},t.prototype.testPoint=function(t){return this.m_shape.testPoint(this.m_body.getTransform(),t)},t.prototype.rayCast=function(t,e,i){return this.m_shape.rayCast(t,e,this.m_body.getTransform(),i)},t.prototype.getMassData=function(t){this.m_shape.computeMass(t,this.m_density)},t.prototype.getAABB=function(t){return this.m_proxies[t].aabb},t.prototype.createProxies=function(t,e){this.m_proxyCount=this.m_shape.getChildCount();for(var i=0;i<this.m_proxyCount;++i){var s=this.m_proxies[i];this.m_shape.computeAABB(s.aabb,e,i),s.proxyId=t.createProxy(s.aabb,s)}},t.prototype.destroyProxies=function(t){for(var e=0;e<this.m_proxyCount;++e){var i=this.m_proxies[e];t.destroyProxy(i.proxyId),i.proxyId=null}this.m_proxyCount=0},t.prototype.synchronize=function(t,e,i){for(var s=0;s<this.m_proxyCount;++s){var o=this.m_proxies[s],n=new A,r=new A;this.m_shape.computeAABB(n,e,o.childIndex),this.m_shape.computeAABB(r,i,o.childIndex),o.aabb.combine(n,r);var a=b.sub(i.p,e.p);t.moveProxy(o.proxyId,o.aabb,a)}},t.prototype.setFilterData=function(t){this.m_filterGroupIndex=t.groupIndex,this.m_filterCategoryBits=t.categoryBits,this.m_filterMaskBits=t.maskBits,this.refilter()},t.prototype.getFilterGroupIndex=function(){return this.m_filterGroupIndex},t.prototype.setFilterGroupIndex=function(t){this.m_filterGroupIndex=t},t.prototype.getFilterCategoryBits=function(){return this.m_filterCategoryBits},t.prototype.setFilterCategoryBits=function(t){this.m_filterCategoryBits=t},t.prototype.getFilterMaskBits=function(){return this.m_filterMaskBits},t.prototype.setFilterMaskBits=function(t){this.m_filterMaskBits=t},t.prototype.refilter=function(){if(null!=this.m_body){for(var t=this.m_body.getContactList();t;){var e=t.contact,i=e.getFixtureA(),s=e.getFixtureB();(i==this||s==this)&&e.flagForFiltering(),t=t.next}var o=this.m_body.getWorld();if(null!=o)for(var n=o.m_broadPhase,r=0;r<this.m_proxyCount;++r)n.touchProxy(this.m_proxies[r].proxyId)}},t.prototype.shouldCollide=function(t){if(t.m_filterGroupIndex===this.m_filterGroupIndex&&0!==t.m_filterGroupIndex)return t.m_filterGroupIndex>0;var e=(t.m_filterMaskBits&this.m_filterCategoryBits)!=0,i=(t.m_filterCategoryBits&this.m_filterMaskBits)!=0;return e&&i},t}(),R="static",j="kinematic",D="dynamic",E={type:R,position:b.zero(),angle:0,linearVelocity:b.zero(),angularVelocity:0,linearDamping:0,angularDamping:0,fixedRotation:!1,bullet:!1,gravityScale:1,allowSleep:!0,awake:!0,active:!0,userData:null},O=function(){this.mass=0,this.center=b.zero(),this.I=0},Y=function(){function t(t,e){e=v(e,E),this.m_world=t,this.m_awakeFlag=e.awake,this.m_autoSleepFlag=e.allowSleep,this.m_bulletFlag=e.bullet,this.m_fixedRotationFlag=e.fixedRotation,this.m_activeFlag=e.active,this.m_islandFlag=!1,this.m_toiFlag=!1,this.m_userData=e.userData,this.m_type=e.type,this.m_type==D?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_xf=P.identity(),this.m_xf.p=b.clone(e.position),this.m_xf.q.setAngle(e.angle),this.m_sweep=new S,this.m_sweep.setTransform(this.m_xf),this.c_velocity=new T,this.c_position=new L,this.m_force=b.zero(),this.m_torque=0,this.m_linearVelocity=b.clone(e.linearVelocity),this.m_angularVelocity=e.angularVelocity,this.m_linearDamping=e.linearDamping,this.m_angularDamping=e.angularDamping,this.m_gravityScale=e.gravityScale,this.m_sleepTime=0,this.m_jointList=null,this.m_contactList=null,this.m_fixtureList=null,this.m_prev=null,this.m_next=null,this.m_destroyed=!1}return t.prototype._serialize=function(){for(var t=[],e=this.m_fixtureList;e;e=e.m_next)t.push(e);return{type:this.m_type,bullet:this.m_bulletFlag,position:this.m_xf.p,angle:this.m_xf.q.getAngle(),linearVelocity:this.m_linearVelocity,angularVelocity:this.m_angularVelocity,fixtures:t}},t._deserialize=function(e,i,s){var o=new t(i,e);if(e.fixtures)for(var n=e.fixtures.length-1;n>=0;n--){var r=s(N,e.fixtures[n],o);o._addFixture(r)}return o},t.prototype.isWorldLocked=function(){return!!(this.m_world&&this.m_world.isLocked())},t.prototype.getWorld=function(){return this.m_world},t.prototype.getNext=function(){return this.m_next},t.prototype.setUserData=function(t){this.m_userData=t},t.prototype.getUserData=function(){return this.m_userData},t.prototype.getFixtureList=function(){return this.m_fixtureList},t.prototype.getJointList=function(){return this.m_jointList},t.prototype.getContactList=function(){return this.m_contactList},t.prototype.isStatic=function(){return this.m_type==R},t.prototype.isDynamic=function(){return this.m_type==D},t.prototype.isKinematic=function(){return this.m_type==j},t.prototype.setStatic=function(){return this.setType(R),this},t.prototype.setDynamic=function(){return this.setType(D),this},t.prototype.setKinematic=function(){return this.setType(j),this},t.prototype.getType=function(){return this.m_type},t.prototype.setType=function(t){if(!0!=this.isWorldLocked()&&this.m_type!=t){this.m_type=t,this.resetMassData(),this.m_type==R&&(this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_sweep.forward(),this.synchronizeFixtures()),this.setAwake(!0),this.m_force.setZero(),this.m_torque=0;for(var e=this.m_contactList;e;){var i=e;e=e.next,this.m_world.destroyContact(i.contact)}this.m_contactList=null;for(var s=this.m_world.m_broadPhase,o=this.m_fixtureList;o;o=o.m_next)for(var n=o.m_proxyCount,r=0;r<n;++r)s.touchProxy(o.m_proxies[r].proxyId)}},t.prototype.isBullet=function(){return this.m_bulletFlag},t.prototype.setBullet=function(t){this.m_bulletFlag=!!t},t.prototype.isSleepingAllowed=function(){return this.m_autoSleepFlag},t.prototype.setSleepingAllowed=function(t){this.m_autoSleepFlag=!!t,!1==this.m_autoSleepFlag&&this.setAwake(!0)},t.prototype.isAwake=function(){return this.m_awakeFlag},t.prototype.setAwake=function(t){t?!1==this.m_awakeFlag&&(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_force.setZero(),this.m_torque=0)},t.prototype.isActive=function(){return this.m_activeFlag},t.prototype.setActive=function(t){if(t!=this.m_activeFlag){if(this.m_activeFlag=!!t,this.m_activeFlag)for(var e=this.m_world.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.createProxies(e,this.m_xf);else{for(var e=this.m_world.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.destroyProxies(e);for(var s=this.m_contactList;s;){var o=s;s=s.next,this.m_world.destroyContact(o.contact)}this.m_contactList=null}}},t.prototype.isFixedRotation=function(){return this.m_fixedRotationFlag},t.prototype.setFixedRotation=function(t){this.m_fixedRotationFlag!=t&&(this.m_fixedRotationFlag=!!t,this.m_angularVelocity=0,this.resetMassData())},t.prototype.getTransform=function(){return this.m_xf},t.prototype.setTransform=function(t,e){if(!0!=this.isWorldLocked()){this.m_xf.setNum(t,e),this.m_sweep.setTransform(this.m_xf);for(var i=this.m_world.m_broadPhase,s=this.m_fixtureList;s;s=s.m_next)s.synchronize(i,this.m_xf,this.m_xf)}},t.prototype.synchronizeTransform=function(){this.m_sweep.getTransform(this.m_xf,1)},t.prototype.synchronizeFixtures=function(){var t=P.identity();this.m_sweep.getTransform(t,0);for(var e=this.m_world.m_broadPhase,i=this.m_fixtureList;i;i=i.m_next)i.synchronize(e,t,this.m_xf)},t.prototype.advance=function(t){this.m_sweep.advance(t),this.m_sweep.c.setVec2(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_sweep.getTransform(this.m_xf,1)},t.prototype.getPosition=function(){return this.m_xf.p},t.prototype.setPosition=function(t){this.setTransform(t,this.m_sweep.a)},t.prototype.getAngle=function(){return this.m_sweep.a},t.prototype.setAngle=function(t){this.setTransform(this.m_xf.p,t)},t.prototype.getWorldCenter=function(){return this.m_sweep.c},t.prototype.getLocalCenter=function(){return this.m_sweep.localCenter},t.prototype.getLinearVelocity=function(){return this.m_linearVelocity},t.prototype.getLinearVelocityFromWorldPoint=function(t){var e=b.sub(t,this.m_sweep.c);return b.add(this.m_linearVelocity,b.crossNumVec2(this.m_angularVelocity,e))},t.prototype.getLinearVelocityFromLocalPoint=function(t){return this.getLinearVelocityFromWorldPoint(this.getWorldPoint(t))},t.prototype.setLinearVelocity=function(t){this.m_type!=R&&(b.dot(t,t)>0&&this.setAwake(!0),this.m_linearVelocity.setVec2(t))},t.prototype.getAngularVelocity=function(){return this.m_angularVelocity},t.prototype.setAngularVelocity=function(t){this.m_type!=R&&(t*t>0&&this.setAwake(!0),this.m_angularVelocity=t)},t.prototype.getLinearDamping=function(){return this.m_linearDamping},t.prototype.setLinearDamping=function(t){this.m_linearDamping=t},t.prototype.getAngularDamping=function(){return this.m_angularDamping},t.prototype.setAngularDamping=function(t){this.m_angularDamping=t},t.prototype.getGravityScale=function(){return this.m_gravityScale},t.prototype.setGravityScale=function(t){this.m_gravityScale=t},t.prototype.getMass=function(){return this.m_mass},t.prototype.getInertia=function(){return this.m_I+this.m_mass*b.dot(this.m_sweep.localCenter,this.m_sweep.localCenter)},t.prototype.getMassData=function(t){t.mass=this.m_mass,t.I=this.getInertia(),t.center.setVec2(this.m_sweep.localCenter)},t.prototype.resetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.setZero(),this.isStatic()||this.isKinematic()){this.m_sweep.c0.setVec2(this.m_xf.p),this.m_sweep.c.setVec2(this.m_xf.p),this.m_sweep.a0=this.m_sweep.a;return}for(var t=b.zero(),e=this.m_fixtureList;e;e=e.m_next)if(0!=e.m_density){var i=new O;e.getMassData(i),this.m_mass+=i.mass,t.addMul(i.mass,i.center),this.m_I+=i.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,t.mul(this.m_invMass)):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&!1==this.m_fixedRotationFlag?(this.m_I-=this.m_mass*b.dot(t,t),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var s=b.clone(this.m_sweep.c);this.m_sweep.setLocalCenter(t,this.m_xf),this.m_linearVelocity.add(b.crossNumVec2(this.m_angularVelocity,b.sub(this.m_sweep.c,s)))},t.prototype.setMassData=function(t){if(!0!=this.isWorldLocked()&&this.m_type==D){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=t.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,t.I>0&&!1==this.m_fixedRotationFlag&&(this.m_I=t.I-this.m_mass*b.dot(t.center,t.center),this.m_invI=1/this.m_I);var e=b.clone(this.m_sweep.c);this.m_sweep.setLocalCenter(t.center,this.m_xf),this.m_linearVelocity.add(b.crossNumVec2(this.m_angularVelocity,b.sub(this.m_sweep.c,e)))}},t.prototype.applyForce=function(t,e,i){void 0===i&&(i=!0),this.m_type==D&&(i&&!1==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_force.add(t),this.m_torque+=b.crossVec2Vec2(b.sub(e,this.m_sweep.c),t)))},t.prototype.applyForceToCenter=function(t,e){void 0===e&&(e=!0),this.m_type==D&&(e&&!1==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&this.m_force.add(t))},t.prototype.applyTorque=function(t,e){void 0===e&&(e=!0),this.m_type==D&&(e&&!1==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_torque+=t))},t.prototype.applyLinearImpulse=function(t,e,i){void 0===i&&(i=!0),this.m_type==D&&(i&&!1==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.addMul(this.m_invMass,t),this.m_angularVelocity+=this.m_invI*b.crossVec2Vec2(b.sub(e,this.m_sweep.c),t)))},t.prototype.applyAngularImpulse=function(t,e){void 0===e&&(e=!0),this.m_type==D&&(e&&!1==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t))},t.prototype.shouldCollide=function(t){if(this.m_type!=D&&t.m_type!=D)return!1;for(var e=this.m_jointList;e;e=e.next)if(e.other==t&&!1==e.joint.m_collideConnected)return!1;return!0},t.prototype._addFixture=function(t){if(!0==this.isWorldLocked())return null;if(this.m_activeFlag){var e=this.m_world.m_broadPhase;t.createProxies(e,this.m_xf)}return t.m_next=this.m_fixtureList,this.m_fixtureList=t,t.m_density>0&&this.resetMassData(),this.m_world.m_newFixture=!0,t},t.prototype.createFixture=function(t,e){if(!0==this.isWorldLocked())return null;var i=new N(this,t,e);return this._addFixture(i),i},t.prototype.destroyFixture=function(t){if(!0!=this.isWorldLocked()){if(this.m_fixtureList===t)this.m_fixtureList=t.m_next;else for(var e=this.m_fixtureList;null!=e;){if(e.m_next===t){e.m_next=t.m_next;break}e=e.m_next}for(var i=this.m_contactList;i;){var s=i.contact;i=i.next;var o=s.getFixtureA(),n=s.getFixtureB();(t==o||t==n)&&this.m_world.destroyContact(s)}if(this.m_activeFlag){var r=this.m_world.m_broadPhase;t.destroyProxies(r)}t.m_body=null,t.m_next=null,this.m_world.publish("remove-fixture",t),this.resetMassData()}},t.prototype.getWorldPoint=function(t){return P.mulVec2(this.m_xf,t)},t.prototype.getWorldVector=function(t){return z.mulVec2(this.m_xf.q,t)},t.prototype.getLocalPoint=function(t){return P.mulTVec2(this.m_xf,t)},t.prototype.getLocalVector=function(t){return z.mulTVec2(this.m_xf.q,t)},t.STATIC="static",t.KINEMATIC="kinematic",t.DYNAMIC="dynamic",t}(),W=function(){function t(t,e,i,s){"object"==typeof t&&null!==t?(this.ex=b.clone(t),this.ey=b.clone(e)):"number"==typeof t?(this.ex=b.neo(t,i),this.ey=b.neo(e,s)):(this.ex=b.zero(),this.ey=b.zero())}return t.prototype.toString=function(){return JSON.stringify(this)},t.isValid=function(t){return null!=t&&b.isValid(t.ex)&&b.isValid(t.ey)},t.assert=function(t){},t.prototype.set=function(t,e,i,s){"number"==typeof t&&"number"==typeof e&&"number"==typeof i&&"number"==typeof s?(this.ex.setNum(t,i),this.ey.setNum(e,s)):"object"==typeof t&&"object"==typeof e?(this.ex.setVec2(t),this.ey.setVec2(e)):"object"==typeof t&&(this.ex.setVec2(t.ex),this.ey.setVec2(t.ey))},t.prototype.setIdentity=function(){this.ex.x=1,this.ey.x=0,this.ex.y=0,this.ey.y=1},t.prototype.setZero=function(){this.ex.x=0,this.ey.x=0,this.ex.y=0,this.ey.y=0},t.prototype.getInverse=function(){var e=this.ex.x,i=this.ey.x,s=this.ex.y,o=this.ey.y,n=e*o-i*s;0!==n&&(n=1/n);var r=new t;return r.ex.x=n*o,r.ey.x=-n*i,r.ex.y=-n*s,r.ey.y=n*e,r},t.prototype.solve=function(t){var e=this.ex.x,i=this.ey.x,s=this.ex.y,o=this.ey.y,n=e*o-i*s;0!==n&&(n=1/n);var r=b.zero();return r.x=n*(o*t.x-i*t.y),r.y=n*(e*t.y-s*t.x),r},t.mul=function(e,i){if(i&&"x"in i&&"y"in i){var s=e.ex.x*i.x+e.ey.x*i.y,o=e.ex.y*i.x+e.ey.y*i.y;return b.neo(s,o)}if(i&&"ex"in i&&"ey"in i)return new t(e.ex.x*i.ex.x+e.ey.x*i.ex.y,e.ex.x*i.ey.x+e.ey.x*i.ey.y,e.ex.y*i.ex.x+e.ey.y*i.ex.y,e.ex.y*i.ey.x+e.ey.y*i.ey.y)},t.mulVec2=function(t,e){var i=t.ex.x*e.x+t.ey.x*e.y,s=t.ex.y*e.x+t.ey.y*e.y;return b.neo(i,s)},t.mulMat22=function(e,i){return new t(e.ex.x*i.ex.x+e.ey.x*i.ex.y,e.ex.x*i.ey.x+e.ey.x*i.ey.y,e.ex.y*i.ex.x+e.ey.y*i.ex.y,e.ex.y*i.ey.x+e.ey.y*i.ey.y)},t.mulT=function(e,i){return i&&"x"in i&&"y"in i?b.neo(b.dot(i,e.ex),b.dot(i,e.ey)):i&&"ex"in i&&"ey"in i?new t(b.neo(b.dot(e.ex,i.ex),b.dot(e.ey,i.ex)),b.neo(b.dot(e.ex,i.ey),b.dot(e.ey,i.ey))):void 0},t.mulTVec2=function(t,e){return b.neo(b.dot(e,t.ex),b.dot(e,t.ey))},t.mulTMat22=function(e,i){return new t(b.neo(b.dot(e.ex,i.ex),b.dot(e.ey,i.ex)),b.neo(b.dot(e.ex,i.ey),b.dot(e.ey,i.ey)))},t.abs=function(e){return new t(b.abs(e.ex),b.abs(e.ey))},t.add=function(e,i){return new t(b.add(e.ex,i.ex),b.add(e.ey,i.ey))},t}();(e=m||(m={}))[e.e_circles=0]="e_circles",e[e.e_faceA=1]="e_faceA",e[e.e_faceB=2]="e_faceB",(i=h||(h={}))[i.e_vertex=0]="e_vertex",i[i.e_face=1]="e_face",(s=c||(c={}))[s.nullState=0]="nullState",s[s.addState=1]="addState",s[s.persistState=2]="persistState",s[s.removeState=3]="removeState";var J=function(){function t(){this.v=b.zero(),this.id=new X}return t.prototype.set=function(t){this.v.setVec2(t.v),this.id.set(t.id)},t}(),H=function(){function t(){this.localNormal=b.zero(),this.localPoint=b.zero(),this.points=[new Z,new Z],this.pointCount=0}return t.prototype.getWorldManifold=function(t,e,i,s,o){if(0!=this.pointCount){var n=(t=t||new K).normal,r=t.points,a=t.separations;switch(this.type){case m.e_circles:n=b.neo(1,0);var h=P.mulVec2(e,this.localPoint),c=P.mulVec2(s,this.points[0].localPoint),_=b.sub(c,h);b.lengthSquared(_)>g.EPSILON*g.EPSILON&&(n.setVec2(_),n.normalize());var l=h.clone().addMul(i,n),u=c.clone().addMul(-o,n);r[0]=b.mid(l,u),a[0]=b.dot(b.sub(u,l),n),r.length=1,a.length=1;break;case m.e_faceA:n=z.mulVec2(e.q,this.localNormal);for(var p=P.mulVec2(e,this.localPoint),d=0;d<this.pointCount;++d){var y=P.mulVec2(s,this.points[d].localPoint),l=b.clone(y).addMul(i-b.dot(b.sub(y,p),n),n),u=b.clone(y).subMul(o,n);r[d]=b.mid(l,u),a[d]=b.dot(b.sub(u,l),n)}r.length=this.pointCount,a.length=this.pointCount;break;case m.e_faceB:n=z.mulVec2(s.q,this.localNormal);for(var p=P.mulVec2(s,this.localPoint),d=0;d<this.pointCount;++d){var y=P.mulVec2(e,this.points[d].localPoint),u=b.combine(1,y,o-b.dot(b.sub(y,p),n),n),l=b.combine(1,y,-i,n);r[d]=b.mid(l,u),a[d]=b.dot(b.sub(l,u),n)}r.length=this.pointCount,a.length=this.pointCount,n.mul(-1)}return t.normal=n,t.points=r,t.separations=a,t}},t.clipSegmentToLine=$,t.ClipVertex=J,t.getPointStates=G,t.PointState=c,t}(),Z=function(){this.localPoint=b.zero(),this.normalImpulse=0,this.tangentImpulse=0,this.id=new X},X=function(){function t(){this.cf=new U}return Object.defineProperty(t.prototype,"key",{get:function(){return this.cf.indexA+4*this.cf.indexB+16*this.cf.typeA+64*this.cf.typeB},enumerable:!1,configurable:!0}),t.prototype.set=function(t){this.cf.set(t.cf)},t}(),U=function(){function t(){}return t.prototype.set=function(t){this.indexA=t.indexA,this.indexB=t.indexB,this.typeA=t.typeA,this.typeB=t.typeB},t}(),K=function(){this.points=[],this.separations=[]};function G(t,e,i,s){for(var o=0;o<i.pointCount;++o){var n=i.points[o].id;t[o]=c.removeState;for(var r=0;r<s.pointCount;++r)if(s.points[r].id.key==n.key){t[o]=c.persistState;break}}for(var o=0;o<s.pointCount;++o){var n=s.points[o].id;e[o]=c.addState;for(var r=0;r<i.pointCount;++r)if(i.points[r].id.key==n.key){e[o]=c.persistState;break}}}function $(t,e,i,s,o){var n=0,r=b.dot(i,e[0].v)-s,a=b.dot(i,e[1].v)-s;if(r<=0&&t[n++].set(e[0]),a<=0&&t[n++].set(e[1]),r*a<0){var m=r/(r-a);t[n].v.setCombine(1-m,e[0].v,m,e[1].v),t[n].id.cf.indexA=o,t[n].id.cf.indexB=e[0].id.cf.indexB,t[n].id.cf.typeA=h.e_vertex,t[n].id.cf.typeB=h.e_face,++n}return n}var Q={gjkCalls:0,gjkIters:0,gjkMaxIters:0,toiTime:0,toiMaxTime:0,toiCalls:0,toiIters:0,toiMaxIters:0,toiRootIters:0,toiMaxRootIters:0,toString:function(t){t="string"==typeof t?t:"\n";var e="";for(var i in this)"function"!=typeof this[i]&&"object"!=typeof this[i]&&(e+=i+": "+this[i]+t);return e}};Q.gjkCalls=0,Q.gjkIters=0,Q.gjkMaxIters=0;var tt=function(){this.proxyA=new to,this.proxyB=new to,this.transformA=null,this.transformB=null,this.useRadii=!1},te=function(){this.pointA=b.zero(),this.pointB=b.zero()},ti=function(){this.metric=0,this.indexA=[],this.indexB=[],this.count=0};function ts(t,e,i){++Q.gjkCalls;var s=i.proxyA,o=i.proxyB,n=i.transformA,r=i.transformB,a=new tr;a.readCache(e,s,n,o,r);for(var m=a.m_v,h=B.maxDistnceIterations,c=[],_=[],l=0,u=0;u<h;){l=a.m_count;for(var p=0;p<l;++p)c[p]=m[p].indexA,_[p]=m[p].indexB;if(a.solve(),3===a.m_count)break;var d=a.getClosestPoint();d.lengthSquared();var y=a.getSearchDirection();if(y.lengthSquared()<g.EPSILON*g.EPSILON)break;var f=m[a.m_count];f.indexA=s.getSupport(z.mulTVec2(n.q,b.neg(y))),f.wA=P.mulVec2(n,s.getVertex(f.indexA)),f.indexB=o.getSupport(z.mulTVec2(r.q,y)),f.wB=P.mulVec2(r,o.getVertex(f.indexB)),f.w=b.sub(f.wB,f.wA),++u,++Q.gjkIters;for(var v=!1,p=0;p<l;++p)if(f.indexA===c[p]&&f.indexB===_[p]){v=!0;break}if(v)break;++a.m_count}if(Q.gjkMaxIters=g.max(Q.gjkMaxIters,u),a.getWitnessPoints(t.pointA,t.pointB),t.distance=b.distance(t.pointA,t.pointB),t.iterations=u,a.writeCache(e),i.useRadii){var x=s.m_radius,A=o.m_radius;if(t.distance>x+A&&t.distance>g.EPSILON){t.distance-=x+A;var w=b.sub(t.pointB,t.pointA);w.normalize(),t.pointA.addMul(x,w),t.pointB.subMul(A,w)}else{var d=b.mid(t.pointA,t.pointB);t.pointA.setVec2(d),t.pointB.setVec2(d),t.distance=0}}}var to=function(){function t(){this.m_buffer=[],this.m_vertices=[],this.m_count=0,this.m_radius=0}return t.prototype.getVertexCount=function(){return this.m_count},t.prototype.getVertex=function(t){return this.m_vertices[t]},t.prototype.getSupport=function(t){for(var e=0,i=b.dot(this.m_vertices[0],t),s=0;s<this.m_count;++s){var o=b.dot(this.m_vertices[s],t);o>i&&(e=s,i=o)}return e},t.prototype.getSupportVertex=function(t){return this.m_vertices[this.getSupport(t)]},t.prototype.set=function(t,e){t.computeDistanceProxy(this,e)},t}(),tn=function(){function t(){this.wA=b.zero(),this.wB=b.zero(),this.w=b.zero()}return t.prototype.set=function(t){this.indexA=t.indexA,this.indexB=t.indexB,this.wA=b.clone(t.wA),this.wB=b.clone(t.wB),this.w=b.clone(t.w),this.a=t.a},t}(),tr=function(){function t(){this.m_v1=new tn,this.m_v2=new tn,this.m_v3=new tn,this.m_v=[this.m_v1,this.m_v2,this.m_v3],this.m_count}return t.prototype.toString=function(){return 3===this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y,this.m_v3.a,this.m_v3.wA.x,this.m_v3.wA.y,this.m_v3.wB.x,this.m_v3.wB.y].toString():2===this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y].toString():1===this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y].toString():"+"+this.m_count},t.prototype.readCache=function(t,e,i,s,o){this.m_count=t.count;for(var n=0;n<this.m_count;++n){var r=this.m_v[n];r.indexA=t.indexA[n],r.indexB=t.indexB[n];var a=e.getVertex(r.indexA),m=s.getVertex(r.indexB);r.wA=P.mulVec2(i,a),r.wB=P.mulVec2(o,m),r.w=b.sub(r.wB,r.wA),r.a=0}if(this.m_count>1){var h=t.metric,c=this.getMetric();(c<.5*h||2*h<c||c<g.EPSILON)&&(this.m_count=0)}if(0===this.m_count){var r=this.m_v[0];r.indexA=0,r.indexB=0;var a=e.getVertex(0),m=s.getVertex(0);r.wA=P.mulVec2(i,a),r.wB=P.mulVec2(o,m),r.w=b.sub(r.wB,r.wA),r.a=1,this.m_count=1}},t.prototype.writeCache=function(t){t.metric=this.getMetric(),t.count=this.m_count;for(var e=0;e<this.m_count;++e)t.indexA[e]=this.m_v[e].indexA,t.indexB[e]=this.m_v[e].indexB},t.prototype.getSearchDirection=function(){switch(this.m_count){case 1:return b.neg(this.m_v1.w);case 2:var t=b.sub(this.m_v2.w,this.m_v1.w);if(b.crossVec2Vec2(t,b.neg(this.m_v1.w))>0)return b.crossNumVec2(1,t);return b.crossVec2Num(t,1);default:return b.zero()}},t.prototype.getClosestPoint=function(){switch(this.m_count){case 0:case 3:default:return b.zero();case 1:return b.clone(this.m_v1.w);case 2:return b.combine(this.m_v1.a,this.m_v1.w,this.m_v2.a,this.m_v2.w)}},t.prototype.getWitnessPoints=function(t,e){switch(this.m_count){case 0:break;case 1:t.setVec2(this.m_v1.wA),e.setVec2(this.m_v1.wB);break;case 2:t.setCombine(this.m_v1.a,this.m_v1.wA,this.m_v2.a,this.m_v2.wA),e.setCombine(this.m_v1.a,this.m_v1.wB,this.m_v2.a,this.m_v2.wB);break;case 3:t.setCombine(this.m_v1.a,this.m_v1.wA,this.m_v2.a,this.m_v2.wA),t.addMul(this.m_v3.a,this.m_v3.wA),e.setVec2(t)}},t.prototype.getMetric=function(){switch(this.m_count){case 0:case 1:default:return 0;case 2:return b.distance(this.m_v1.w,this.m_v2.w);case 3:return b.crossVec2Vec2(b.sub(this.m_v2.w,this.m_v1.w),b.sub(this.m_v3.w,this.m_v1.w))}},t.prototype.solve=function(){switch(this.m_count){case 1:break;case 2:this.solve2();break;case 3:this.solve3()}},t.prototype.solve2=function(){var t=this.m_v1.w,e=this.m_v2.w,i=b.sub(e,t),s=-b.dot(t,i);if(s<=0){this.m_v1.a=1,this.m_count=1;return}var o=b.dot(e,i);if(o<=0){this.m_v2.a=1,this.m_count=1,this.m_v1.set(this.m_v2);return}var n=1/(o+s);this.m_v1.a=o*n,this.m_v2.a=s*n,this.m_count=2},t.prototype.solve3=function(){var t=this.m_v1.w,e=this.m_v2.w,i=this.m_v3.w,s=b.sub(e,t),o=b.dot(t,s),n=b.dot(e,s),r=-o,a=b.sub(i,t),m=b.dot(t,a),h=b.dot(i,a),c=-m,_=b.sub(i,e),l=b.dot(e,_),u=b.dot(i,_),p=-l,d=b.crossVec2Vec2(s,a),y=d*b.crossVec2Vec2(e,i),f=d*b.crossVec2Vec2(i,t),v=d*b.crossVec2Vec2(t,e);if(r<=0&&c<=0){this.m_v1.a=1,this.m_count=1;return}if(n>0&&r>0&&v<=0){var x=1/(n+r);this.m_v1.a=n*x,this.m_v2.a=r*x,this.m_count=2;return}if(h>0&&c>0&&f<=0){var g=1/(h+c);this.m_v1.a=h*g,this.m_v3.a=c*g,this.m_count=2,this.m_v2.set(this.m_v3);return}if(n<=0&&p<=0){this.m_v2.a=1,this.m_count=1,this.m_v1.set(this.m_v2);return}if(h<=0&&u<=0){this.m_v3.a=1,this.m_count=1,this.m_v1.set(this.m_v3);return}if(u>0&&p>0&&y<=0){var A=1/(u+p);this.m_v2.a=u*A,this.m_v3.a=p*A,this.m_count=2,this.m_v1.set(this.m_v3);return}var B=1/(y+f+v);this.m_v1.a=y*B,this.m_v2.a=f*B,this.m_v3.a=v*B,this.m_count=3},t}();function ta(t,e,i,s,o,n){var r=new tt;r.proxyA.set(t,e),r.proxyB.set(i,s),r.transformA=o,r.transformB=n,r.useRadii=!0;var a=new ti,m=new te;return ts(m,a,r),m.distance<10*g.EPSILON}var tm=function(t){this.contact=t},th=[],tc=function(){this.rA=b.zero(),this.rB=b.zero(),this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0},t_=function(){function t(t,e,i,s,o){var n,r,a,m;this.m_manifold=new H,this.m_prev=null,this.m_next=null,this.m_toi=1,this.m_toiCount=0,this.m_toiFlag=!1,this.m_tangentSpeed=0,this.m_enabledFlag=!0,this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_impulse=new tg(this),this.v_points=[],this.v_normal=b.zero(),this.v_normalMass=new W,this.v_K=new W,this.p_localPoints=[],this.p_localNormal=b.zero(),this.p_localPoint=b.zero(),this.p_localCenterA=b.zero(),this.p_localCenterB=b.zero(),this.m_nodeA=new tm(this),this.m_nodeB=new tm(this),this.m_fixtureA=t,this.m_fixtureB=i,this.m_indexA=e,this.m_indexB=s,this.m_evaluateFcn=o,this.m_friction=(n=this.m_fixtureA.m_friction,r=this.m_fixtureB.m_friction,g.sqrt(n*r)),this.m_restitution=(a=this.m_fixtureA.m_restitution)>(m=this.m_fixtureB.m_restitution)?a:m}return t.prototype.initConstraint=function(t){var e=this.m_fixtureA,i=this.m_fixtureB,s=e.getShape(),o=i.getShape(),n=e.getBody(),r=i.getBody(),a=this.getManifold(),m=a.pointCount;this.v_invMassA=n.m_invMass,this.v_invMassB=r.m_invMass,this.v_invIA=n.m_invI,this.v_invIB=r.m_invI,this.v_friction=this.m_friction,this.v_restitution=this.m_restitution,this.v_tangentSpeed=this.m_tangentSpeed,this.v_pointCount=m,this.v_K.setZero(),this.v_normalMass.setZero(),this.p_invMassA=n.m_invMass,this.p_invMassB=r.m_invMass,this.p_invIA=n.m_invI,this.p_invIB=r.m_invI,this.p_localCenterA=b.clone(n.m_sweep.localCenter),this.p_localCenterB=b.clone(r.m_sweep.localCenter),this.p_radiusA=s.m_radius,this.p_radiusB=o.m_radius,this.p_type=a.type,this.p_localNormal=b.clone(a.localNormal),this.p_localPoint=b.clone(a.localPoint),this.p_pointCount=m;for(var h=0;h<m;++h){var c=a.points[h],_=this.v_points[h]=new tc;t.warmStarting?(_.normalImpulse=t.dtRatio*c.normalImpulse,_.tangentImpulse=t.dtRatio*c.tangentImpulse):(_.normalImpulse=0,_.tangentImpulse=0),_.rA.setZero(),_.rB.setZero(),_.normalMass=0,_.tangentMass=0,_.velocityBias=0,this.p_localPoints[h]=b.clone(c.localPoint)}},t.prototype.getManifold=function(){return this.m_manifold},t.prototype.getWorldManifold=function(t){var e=this.m_fixtureA.getBody(),i=this.m_fixtureB.getBody(),s=this.m_fixtureA.getShape(),o=this.m_fixtureB.getShape();return this.m_manifold.getWorldManifold(t,e.getTransform(),s.m_radius,i.getTransform(),o.m_radius)},t.prototype.setEnabled=function(t){this.m_enabledFlag=!!t},t.prototype.isEnabled=function(){return this.m_enabledFlag},t.prototype.isTouching=function(){return this.m_touchingFlag},t.prototype.getNext=function(){return this.m_next},t.prototype.getFixtureA=function(){return this.m_fixtureA},t.prototype.getFixtureB=function(){return this.m_fixtureB},t.prototype.getChildIndexA=function(){return this.m_indexA},t.prototype.getChildIndexB=function(){return this.m_indexB},t.prototype.flagForFiltering=function(){this.m_filterFlag=!0},t.prototype.setFriction=function(t){this.m_friction=t},t.prototype.getFriction=function(){return this.m_friction},t.prototype.resetFriction=function(){var t,e;this.m_friction=(t=this.m_fixtureA.m_friction,e=this.m_fixtureB.m_friction,g.sqrt(t*e))},t.prototype.setRestitution=function(t){this.m_restitution=t},t.prototype.getRestitution=function(){return this.m_restitution},t.prototype.resetRestitution=function(){var t,e;this.m_restitution=(t=this.m_fixtureA.m_restitution)>(e=this.m_fixtureB.m_restitution)?t:e},t.prototype.setTangentSpeed=function(t){this.m_tangentSpeed=t},t.prototype.getTangentSpeed=function(){return this.m_tangentSpeed},t.prototype.evaluate=function(t,e,i){this.m_evaluateFcn(t,e,this.m_fixtureA,this.m_indexA,i,this.m_fixtureB,this.m_indexB)},t.prototype.update=function(t){this.m_enabledFlag=!0;var e,i=!1,s=this.m_touchingFlag,o=this.m_fixtureA.isSensor(),n=this.m_fixtureB.isSensor(),r=o||n,a=this.m_fixtureA.getBody(),m=this.m_fixtureB.getBody(),h=a.getTransform(),c=m.getTransform();if(r){var _=this.m_fixtureA.getShape(),l=this.m_fixtureB.getShape();i=ta(_,this.m_indexA,l,this.m_indexB,h,c),this.m_manifold.pointCount=0}else{e=this.m_manifold,this.m_manifold=new H,this.evaluate(this.m_manifold,h,c),i=this.m_manifold.pointCount>0;for(var u=0;u<this.m_manifold.pointCount;++u){var p=this.m_manifold.points[u];p.normalImpulse=0,p.tangentImpulse=0;for(var d=0;d<e.pointCount;++d){var y=e.points[d];if(y.id.key==p.id.key){p.normalImpulse=y.normalImpulse,p.tangentImpulse=y.tangentImpulse;break}}}i!=s&&(a.setAwake(!0),m.setAwake(!0))}this.m_touchingFlag=i,!s&&i&&t&&t.beginContact(this),s&&!i&&t&&t.endContact(this),!r&&i&&t&&t.preSolve(this,e)},t.prototype.solvePositionConstraint=function(t){return this._solvePositionConstraint(t)},t.prototype.solvePositionConstraintTOI=function(t,e,i){return this._solvePositionConstraint(t,e,i)},t.prototype._solvePositionConstraint=function(t,e,i){var s=!!e&&!!i,o=this.m_fixtureA,n=this.m_fixtureB,r=o.getBody(),a=n.getBody();r.c_velocity,a.c_velocity;var h=r.c_position,c=a.c_position,_=b.clone(this.p_localCenterA),l=b.clone(this.p_localCenterB),u=0,p=0;s&&r!=e&&r!=i||(u=this.p_invMassA,p=this.p_invIA);var d=0,y=0;s&&a!=e&&a!=i||(d=this.p_invMassB,y=this.p_invIB);for(var f=b.clone(h.c),v=h.a,x=b.clone(c.c),A=c.a,w=0,V=0;V<this.p_pointCount;++V){var C=P.identity(),M=P.identity();C.q.setAngle(v),M.q.setAngle(A),C.p=b.sub(f,z.mulVec2(C.q,_)),M.p=b.sub(x,z.mulVec2(M.q,l));var I=void 0,S=void 0,T=void 0;switch(this.p_type){case m.e_circles:var L=P.mulVec2(C,this.p_localPoint),F=P.mulVec2(M,this.p_localPoints[0]);(I=b.sub(F,L)).normalize(),S=b.combine(.5,L,.5,F),T=b.dot(b.sub(F,L),I)-this.p_radiusA-this.p_radiusB;break;case m.e_faceA:I=z.mulVec2(C.q,this.p_localNormal);var k=P.mulVec2(C,this.p_localPoint),q=P.mulVec2(M,this.p_localPoints[V]);T=b.dot(b.sub(q,k),I)-this.p_radiusA-this.p_radiusB,S=q;break;case m.e_faceB:I=z.mulVec2(M.q,this.p_localNormal);var k=P.mulVec2(M,this.p_localPoint),q=P.mulVec2(C,this.p_localPoints[V]);T=b.dot(b.sub(q,k),I)-this.p_radiusA-this.p_radiusB,S=q,I.mul(-1)}var N=b.sub(S,f),R=b.sub(S,x);w=g.min(w,T);var j=s?B.toiBaugarte:B.baumgarte,D=B.linearSlop,E=B.maxLinearCorrection,O=g.clamp(j*(T+D),-E,0),Y=b.crossVec2Vec2(N,I),W=b.crossVec2Vec2(R,I),J=u+d+p*Y*Y+y*W*W,H=J>0?-O/J:0,Z=b.mulNumVec2(H,I);f.subMul(u,Z),v-=p*b.crossVec2Vec2(N,Z),x.addMul(d,Z),A+=y*b.crossVec2Vec2(R,Z)}return h.c.setVec2(f),h.a=v,c.c.setVec2(x),c.a=A,w},t.prototype.initVelocityConstraint=function(t){var e=this.m_fixtureA,i=this.m_fixtureB,s=e.getBody(),o=i.getBody(),n=s.c_velocity,r=o.c_velocity,a=s.c_position,m=o.c_position,h=this.p_radiusA,c=this.p_radiusB,_=this.getManifold(),l=this.v_invMassA,u=this.v_invMassB,p=this.v_invIA,d=this.v_invIB,y=b.clone(this.p_localCenterA),f=b.clone(this.p_localCenterB),v=b.clone(a.c),x=a.a,g=b.clone(n.v),A=n.w,w=b.clone(m.c),V=m.a,C=b.clone(r.v),M=r.w,I=P.identity(),S=P.identity();I.q.setAngle(x),S.q.setAngle(V),I.p.setCombine(1,v,-1,z.mulVec2(I.q,y)),S.p.setCombine(1,w,-1,z.mulVec2(S.q,f));var T=_.getWorldManifold(null,I,h,S,c);this.v_normal.setVec2(T.normal);for(var L=0;L<this.v_pointCount;++L){var F=this.v_points[L];F.rA.setVec2(b.sub(T.points[L],v)),F.rB.setVec2(b.sub(T.points[L],w));var k=b.crossVec2Vec2(F.rA,this.v_normal),q=b.crossVec2Vec2(F.rB,this.v_normal),N=l+u+p*k*k+d*q*q;F.normalMass=N>0?1/N:0;var R=b.crossVec2Num(this.v_normal,1),j=b.crossVec2Vec2(F.rA,R),D=b.crossVec2Vec2(F.rB,R),E=l+u+p*j*j+d*D*D;F.tangentMass=E>0?1/E:0,F.velocityBias=0;var O=b.dot(this.v_normal,C)+b.dot(this.v_normal,b.crossNumVec2(M,F.rB))-b.dot(this.v_normal,g)-b.dot(this.v_normal,b.crossNumVec2(A,F.rA));O<-B.velocityThreshold&&(F.velocityBias=-this.v_restitution*O)}if(2==this.v_pointCount&&t.blockSolve){var Y=this.v_points[0],W=this.v_points[1],J=b.crossVec2Vec2(Y.rA,this.v_normal),H=b.crossVec2Vec2(Y.rB,this.v_normal),Z=b.crossVec2Vec2(W.rA,this.v_normal),X=b.crossVec2Vec2(W.rB,this.v_normal),U=l+u+p*J*J+d*H*H,K=l+u+p*Z*Z+d*X*X,G=l+u+p*J*Z+d*H*X;U*U<1e3*(U*K-G*G)?(this.v_K.ex.setNum(U,G),this.v_K.ey.setNum(G,K),this.v_normalMass.set(this.v_K.getInverse())):this.v_pointCount=1}a.c.setVec2(v),a.a=x,n.v.setVec2(g),n.w=A,m.c.setVec2(w),m.a=V,r.v.setVec2(C),r.w=M},t.prototype.warmStartConstraint=function(t){var e=this.m_fixtureA,i=this.m_fixtureB,s=e.getBody(),o=i.getBody(),n=s.c_velocity,r=o.c_velocity;s.c_position,o.c_position;for(var a=this.v_invMassA,m=this.v_invIA,h=this.v_invMassB,c=this.v_invIB,_=b.clone(n.v),l=n.w,u=b.clone(r.v),p=r.w,d=this.v_normal,y=b.crossVec2Num(d,1),f=0;f<this.v_pointCount;++f){var v=this.v_points[f],x=b.combine(v.normalImpulse,d,v.tangentImpulse,y);l-=m*b.crossVec2Vec2(v.rA,x),_.subMul(a,x),p+=c*b.crossVec2Vec2(v.rB,x),u.addMul(h,x)}n.v.setVec2(_),n.w=l,r.v.setVec2(u),r.w=p},t.prototype.storeConstraintImpulses=function(t){for(var e=this.m_manifold,i=0;i<this.v_pointCount;++i)e.points[i].normalImpulse=this.v_points[i].normalImpulse,e.points[i].tangentImpulse=this.v_points[i].tangentImpulse},t.prototype.solveVelocityConstraint=function(t){var e=this.m_fixtureA.m_body,i=this.m_fixtureB.m_body,s=e.c_velocity;e.c_position;var o=i.c_velocity;i.c_position;for(var n=this.v_invMassA,r=this.v_invIA,a=this.v_invMassB,m=this.v_invIB,h=b.clone(s.v),c=s.w,_=b.clone(o.v),l=o.w,u=this.v_normal,p=b.crossVec2Num(u,1),d=this.v_friction,y=0;y<this.v_pointCount;++y){var f=this.v_points[y],v=b.zero();v.addCombine(1,_,1,b.crossNumVec2(l,f.rB)),v.subCombine(1,h,1,b.crossNumVec2(c,f.rA));var x=b.dot(v,p)-this.v_tangentSpeed,A=-(f.tangentMass*x),B=d*f.normalImpulse,w=g.clamp(f.tangentImpulse+A,-B,B);A=w-f.tangentImpulse,f.tangentImpulse=w;var V=b.mulNumVec2(A,p);h.subMul(n,V),c-=r*b.crossVec2Vec2(f.rA,V),_.addMul(a,V),l+=m*b.crossVec2Vec2(f.rB,V)}if(1==this.v_pointCount||!1==t.blockSolve)for(var C=0;C<this.v_pointCount;++C){var f=this.v_points[C],v=b.zero();v.addCombine(1,_,1,b.crossNumVec2(l,f.rB)),v.subCombine(1,h,1,b.crossNumVec2(c,f.rA));var M=b.dot(v,u),A=-f.normalMass*(M-f.velocityBias),w=g.max(f.normalImpulse+A,0);A=w-f.normalImpulse,f.normalImpulse=w;var V=b.mulNumVec2(A,u);h.subMul(n,V),c-=r*b.crossVec2Vec2(f.rA,V),_.addMul(a,V),l+=m*b.crossVec2Vec2(f.rB,V)}else{var I=this.v_points[0],z=this.v_points[1],P=b.neo(I.normalImpulse,z.normalImpulse),S=b.zero().add(_).add(b.crossNumVec2(l,I.rB)).sub(h).sub(b.crossNumVec2(c,I.rA)),T=b.zero().add(_).add(b.crossNumVec2(l,z.rB)).sub(h).sub(b.crossNumVec2(c,z.rA)),L=b.dot(S,u),F=b.dot(T,u),k=b.neo(L-I.velocityBias,F-z.velocityBias);for(k.sub(W.mulVec2(this.v_K,P));;){var q=W.mulVec2(this.v_normalMass,k).neg();if(q.x>=0&&q.y>=0||(q.x=-I.normalMass*k.x,q.y=0,L=0,F=this.v_K.ex.y*q.x+k.y,q.x>=0&&F>=0)||(q.x=0,q.y=-z.normalMass*k.y,L=this.v_K.ey.x*q.y+k.x,F=0,q.y>=0&&L>=0)){var N=b.sub(q,P),R=b.mulNumVec2(N.x,u),j=b.mulNumVec2(N.y,u);h.subCombine(n,R,n,j),c-=r*(b.crossVec2Vec2(I.rA,R)+b.crossVec2Vec2(z.rA,j)),_.addCombine(a,R,a,j),l+=m*(b.crossVec2Vec2(I.rB,R)+b.crossVec2Vec2(z.rB,j)),I.normalImpulse=q.x,z.normalImpulse=q.y;break}if(q.x=0,q.y=0,L=k.x,F=k.y,L>=0&&F>=0){var N=b.sub(q,P),R=b.mulNumVec2(N.x,u),j=b.mulNumVec2(N.y,u);h.subCombine(n,R,n,j),c-=r*(b.crossVec2Vec2(I.rA,R)+b.crossVec2Vec2(z.rA,j)),_.addCombine(a,R,a,j),l+=m*(b.crossVec2Vec2(I.rB,R)+b.crossVec2Vec2(z.rB,j)),I.normalImpulse=q.x,z.normalImpulse=q.y}break}}s.v.setVec2(h),s.w=c,o.v.setVec2(_),o.w=l},t.addType=function(t,e,i){th[t]=th[t]||{},th[t][e]=i},t.create=function(e,i,s,o){var n,r,a=e.getType(),m=s.getType();if(r=th[a]&&th[a][m])n=new t(e,i,s,o,r);else{if(!(r=th[m]&&th[m][a]))return null;n=new t(s,o,e,i,r)}e=n.getFixtureA(),s=n.getFixtureB(),i=n.getChildIndexA(),o=n.getChildIndexB();var h=e.getBody(),c=s.getBody();return n.m_nodeA.contact=n,n.m_nodeA.other=c,n.m_nodeA.prev=null,n.m_nodeA.next=h.m_contactList,null!=h.m_contactList&&(h.m_contactList.prev=n.m_nodeA),h.m_contactList=n.m_nodeA,n.m_nodeB.contact=n,n.m_nodeB.other=h,n.m_nodeB.prev=null,n.m_nodeB.next=c.m_contactList,null!=c.m_contactList&&(c.m_contactList.prev=n.m_nodeB),c.m_contactList=n.m_nodeB,!1==e.isSensor()&&!1==s.isSensor()&&(h.setAwake(!0),c.setAwake(!0)),n},t.destroy=function(t,e){var i=t.m_fixtureA,s=t.m_fixtureB,o=i.getBody(),n=s.getBody();t.isTouching()&&e.endContact(t),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA==o.m_contactList&&(o.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB==n.m_contactList&&(n.m_contactList=t.m_nodeB.next),t.m_manifold.pointCount>0&&!1==i.isSensor()&&!1==s.isSensor()&&(o.setAwake(!0),n.setAwake(!0)),i.getType(),s.getType()},t}(),tl=function(){this.other=null,this.joint=null,this.prev=null,this.next=null},tu=function(){function t(t,e,i){this.m_type="unknown-joint",this.m_prev=null,this.m_next=null,this.m_edgeA=new tl,this.m_edgeB=new tl,this.m_islandFlag=!1,e="bodyA"in t?t.bodyA:e,i="bodyB"in t?t.bodyB:i,this.m_bodyA=e,this.m_bodyB=i,this.m_collideConnected=!!t.collideConnected,this.m_userData=t.userData}return t.prototype.isActive=function(){return this.m_bodyA.isActive()&&this.m_bodyB.isActive()},t.prototype.getType=function(){return this.m_type},t.prototype.getBodyA=function(){return this.m_bodyA},t.prototype.getBodyB=function(){return this.m_bodyB},t.prototype.getNext=function(){return this.m_next},t.prototype.getUserData=function(){return this.m_userData},t.prototype.setUserData=function(t){this.m_userData=t},t.prototype.getCollideConnected=function(){return this.m_collideConnected},t.prototype.shiftOrigin=function(t){},t}(),tp=function(){this.proxyA=new to,this.proxyB=new to,this.sweepA=new S,this.sweepB=new S};(o=_||(_={}))[o.e_unknown=0]="e_unknown",o[o.e_failed=1]="e_failed",o[o.e_overlapped=2]="e_overlapped",o[o.e_touching=3]="e_touching",o[o.e_separated=4]="e_separated";var td=function(){};function ty(t,e){var i=Date.now();++Q.toiCalls,t.state=_.e_unknown,t.t=e.tMax;var s=e.proxyA,o=e.proxyB,n=e.sweepA,r=e.sweepB;n.normalize(),r.normalize();var a=e.tMax,m=s.m_radius+o.m_radius,h=g.max(B.linearSlop,m-3*B.linearSlop),c=.25*B.linearSlop,l=0,u=B.maxTOIIterations,p=0,d=new ti,y=new tt;for(y.proxyA=e.proxyA,y.proxyB=e.proxyB,y.useRadii=!1;;){var f=P.identity(),v=P.identity();n.getTransform(f,l),r.getTransform(v,l),y.transformA=f,y.transformB=v;var x=new te;if(ts(x,d,y),x.distance<=0){t.state=_.e_overlapped,t.t=0;break}if(x.distance<h+c){t.state=_.e_touching,t.t=l;break}var b=new tf;b.initialize(d,s,n,o,r,l);for(var A=!1,w=a,V=0;;){var C=b.findMinSeparation(w);if(C>h+c){t.state=_.e_separated,t.t=a,A=!0;break}if(C>h-c){l=w;break}var M=b.evaluate(l);if(M<h-c){t.state=_.e_failed,t.t=l,A=!0;break}if(M<=h+c){t.state=_.e_touching,t.t=l,A=!0;break}for(var I=0,z=l,S=w;;){var T=void 0;T=1&I?z+(h-M)*(S-z)/(C-M):.5*(z+S),++I,++Q.toiRootIters;var L=b.evaluate(T);if(b.indexA,b.indexB,g.abs(L-h)<c){w=T;break}if(L>h?(z=T,M=L):(S=T,C=L),50===I)break}if(Q.toiMaxRootIters=g.max(Q.toiMaxRootIters,I),++V===B.maxPolygonVertices)break}if(++p,++Q.toiIters,A)break;if(p===u){t.state=_.e_failed,t.t=l;break}}Q.toiMaxIters=g.max(Q.toiMaxIters,p);var F=Date.now()-i;Q.toiMaxTime=g.max(Q.toiMaxTime,F),Q.toiTime+=F}Q.toiTime=0,Q.toiMaxTime=0,Q.toiCalls=0,Q.toiIters=0,Q.toiMaxIters=0,Q.toiRootIters=0,Q.toiMaxRootIters=0,(n=l||(l={}))[n.e_points=1]="e_points",n[n.e_faceA=2]="e_faceA",n[n.e_faceB=3]="e_faceB";var tf=function(){function t(){this.m_proxyA=new to,this.m_proxyB=new to,this.m_localPoint=b.zero(),this.m_axis=b.zero()}return t.prototype.initialize=function(t,e,i,s,o,n){this.m_proxyA=e,this.m_proxyB=s;var r=t.count;this.m_sweepA=i,this.m_sweepB=o;var a=P.identity(),m=P.identity();if(this.m_sweepA.getTransform(a,n),this.m_sweepB.getTransform(m,n),1===r){this.m_type=l.e_points;var h=this.m_proxyA.getVertex(t.indexA[0]),c=this.m_proxyB.getVertex(t.indexB[0]),_=P.mulVec2(a,h),u=P.mulVec2(m,c);this.m_axis.setCombine(1,u,-1,_);var p=this.m_axis.normalize();return p}if(t.indexA[0]===t.indexA[1]){this.m_type=l.e_faceB;var d=s.getVertex(t.indexB[0]),y=s.getVertex(t.indexB[1]);this.m_axis=b.crossVec2Num(b.sub(y,d),1),this.m_axis.normalize();var f=z.mulVec2(m.q,this.m_axis);this.m_localPoint=b.mid(d,y);var u=P.mulVec2(m,this.m_localPoint),h=e.getVertex(t.indexA[0]),_=P.mulVec2(a,h),p=b.dot(_,f)-b.dot(u,f);return p<0&&(this.m_axis=b.neg(this.m_axis),p=-p),p}this.m_type=l.e_faceA;var v=this.m_proxyA.getVertex(t.indexA[0]),x=this.m_proxyA.getVertex(t.indexA[1]);this.m_axis=b.crossVec2Num(b.sub(x,v),1),this.m_axis.normalize();var f=z.mulVec2(a.q,this.m_axis);this.m_localPoint=b.mid(v,x);var _=P.mulVec2(a,this.m_localPoint),c=this.m_proxyB.getVertex(t.indexB[0]),u=P.mulVec2(m,c),p=b.dot(u,f)-b.dot(_,f);return p<0&&(this.m_axis=b.neg(this.m_axis),p=-p),p},t.prototype.compute=function(t,e){var i=P.identity(),s=P.identity();switch(this.m_sweepA.getTransform(i,e),this.m_sweepB.getTransform(s,e),this.m_type){case l.e_points:if(t){var o=z.mulTVec2(i.q,this.m_axis),n=z.mulTVec2(s.q,b.neg(this.m_axis));this.indexA=this.m_proxyA.getSupport(o),this.indexB=this.m_proxyB.getSupport(n)}var r=this.m_proxyA.getVertex(this.indexA),a=this.m_proxyB.getVertex(this.indexB),m=P.mulVec2(i,r),h=P.mulVec2(s,a),c=b.dot(h,this.m_axis)-b.dot(m,this.m_axis);return c;case l.e_faceA:var _=z.mulVec2(i.q,this.m_axis),m=P.mulVec2(i,this.m_localPoint);if(t){var n=z.mulTVec2(s.q,b.neg(_));this.indexA=-1,this.indexB=this.m_proxyB.getSupport(n)}var a=this.m_proxyB.getVertex(this.indexB),h=P.mulVec2(s,a),c=b.dot(h,_)-b.dot(m,_);return c;case l.e_faceB:var _=z.mulVec2(s.q,this.m_axis),h=P.mulVec2(s,this.m_localPoint);if(t){var o=z.mulTVec2(i.q,b.neg(_));this.indexB=-1,this.indexA=this.m_proxyA.getSupport(o)}var r=this.m_proxyA.getVertex(this.indexA),m=P.mulVec2(i,r),c=b.dot(m,_)-b.dot(h,_);return c;default:return t&&(this.indexA=-1,this.indexB=-1),0}},t.prototype.findMinSeparation=function(t){return this.compute(!0,t)},t.prototype.evaluate=function(t){return this.compute(!1,t)},t}(),tv=function(){function t(){this.dt=0,this.inv_dt=0,this.velocityIterations=0,this.positionIterations=0,this.warmStarting=!1,this.blockSolve=!0,this.inv_dt0=0,this.dtRatio=1}return t.prototype.reset=function(t){this.dt>0&&(this.inv_dt0=this.inv_dt),this.dt=t,this.inv_dt=0==t?0:1/t,this.dtRatio=t*this.inv_dt0},t}(),tx=new tv,tg=function(){function t(t){this.contact=t,this.normals=[],this.tangents=[]}return Object.defineProperty(t.prototype,"normalImpulses",{get:function(){var t=this.contact,e=this.normals;e.length=0;for(var i=0;i<t.v_points.length;++i)e.push(t.v_points[i].normalImpulse);return e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tangentImpulses",{get:function(){var t=this.contact,e=this.tangents;e.length=0;for(var i=0;i<t.v_points.length;++i)e.push(t.v_points[i].tangentImpulse);return e},enumerable:!1,configurable:!0}),t}(),tb=function(){function t(t){this.m_world=t,this.m_stack=[],this.m_bodies=[],this.m_contacts=[],this.m_joints=[]}return t.prototype.clear=function(){this.m_stack.length=0,this.m_bodies.length=0,this.m_contacts.length=0,this.m_joints.length=0},t.prototype.addBody=function(t){this.m_bodies.push(t)},t.prototype.addContact=function(t){this.m_contacts.push(t)},t.prototype.addJoint=function(t){this.m_joints.push(t)},t.prototype.solveWorld=function(t){for(var e=this.m_world,i=e.m_bodyList;i;i=i.m_next)i.m_islandFlag=!1;for(var s=e.m_contactList;s;s=s.m_next)s.m_islandFlag=!1;for(var o=e.m_jointList;o;o=o.m_next)o.m_islandFlag=!1;for(var n=this.m_stack,r=e.m_bodyList;r;r=r.m_next)if(!r.m_islandFlag&&!1!=r.isAwake()&&!1!=r.isActive()&&!r.isStatic()){for(this.clear(),n.push(r),r.m_islandFlag=!0;n.length>0;){var i=n.pop();if(this.addBody(i),i.setAwake(!0),!i.isStatic()){for(var a=i.m_contactList;a;a=a.next){var m=a.contact;if(!m.m_islandFlag&&!1!=m.isEnabled()&&!1!=m.isTouching()){var h=m.m_fixtureA.m_isSensor,c=m.m_fixtureB.m_isSensor;if(!h&&!c){this.addContact(m),m.m_islandFlag=!0;var _=a.other;_.m_islandFlag||(n.push(_),_.m_islandFlag=!0)}}}for(var l=i.m_jointList;l;l=l.next)if(!0!=l.joint.m_islandFlag){var _=l.other;!1!=_.isActive()&&(this.addJoint(l.joint),l.joint.m_islandFlag=!0,_.m_islandFlag||(n.push(_),_.m_islandFlag=!0))}}}this.solveIsland(t);for(var u=0;u<this.m_bodies.length;++u){var i=this.m_bodies[u];i.isStatic()&&(i.m_islandFlag=!1)}}},t.prototype.solveIsland=function(t){for(var e=this.m_world,i=e.m_gravity,s=e.m_allowSleep,o=t.dt,n=0;n<this.m_bodies.length;++n){var r=this.m_bodies[n],a=b.clone(r.m_sweep.c),m=r.m_sweep.a,h=b.clone(r.m_linearVelocity),c=r.m_angularVelocity;r.m_sweep.c0.setVec2(r.m_sweep.c),r.m_sweep.a0=r.m_sweep.a,r.isDynamic()&&(h.addMul(o*r.m_gravityScale,i),h.addMul(o*r.m_invMass,r.m_force),c+=o*r.m_invI*r.m_torque,h.mul(1/(1+o*r.m_linearDamping)),c*=1/(1+o*r.m_angularDamping)),r.c_position.c=a,r.c_position.a=m,r.c_velocity.v=h,r.c_velocity.w=c}for(var n=0;n<this.m_contacts.length;++n){var _=this.m_contacts[n];_.initConstraint(t)}for(var n=0;n<this.m_contacts.length;++n){var _=this.m_contacts[n];_.initVelocityConstraint(t)}if(t.warmStarting)for(var n=0;n<this.m_contacts.length;++n){var _=this.m_contacts[n];_.warmStartConstraint(t)}for(var n=0;n<this.m_joints.length;++n){var l=this.m_joints[n];l.initVelocityConstraints(t)}for(var n=0;n<t.velocityIterations;++n){for(var u=0;u<this.m_joints.length;++u){var l=this.m_joints[u];l.solveVelocityConstraints(t)}for(var u=0;u<this.m_contacts.length;++u){var _=this.m_contacts[u];_.solveVelocityConstraint(t)}}for(var n=0;n<this.m_contacts.length;++n){var _=this.m_contacts[n];_.storeConstraintImpulses(t)}for(var n=0;n<this.m_bodies.length;++n){var r=this.m_bodies[n],a=b.clone(r.c_position.c),m=r.c_position.a,h=b.clone(r.c_velocity.v),c=r.c_velocity.w,p=b.mulNumVec2(o,h);if(b.lengthSquared(p)>B.maxTranslationSquared){var d=B.maxTranslation/p.length();h.mul(d)}var y=o*c;if(y*y>B.maxRotationSquared){var d=B.maxRotation/g.abs(y);c*=d}a.addMul(o,h),m+=o*c,r.c_position.c.setVec2(a),r.c_position.a=m,r.c_velocity.v.setVec2(h),r.c_velocity.w=c}for(var f=!1,n=0;n<t.positionIterations;++n){for(var v=0,u=0;u<this.m_contacts.length;++u){var _=this.m_contacts[u],x=_.solvePositionConstraint(t);v=g.min(v,x)}for(var A=v>=-3*B.linearSlop,w=!0,u=0;u<this.m_joints.length;++u){var l=this.m_joints[u],V=l.solvePositionConstraints(t);w=w&&V}if(A&&w){f=!0;break}}for(var n=0;n<this.m_bodies.length;++n){var r=this.m_bodies[n];r.m_sweep.c.setVec2(r.c_position.c),r.m_sweep.a=r.c_position.a,r.m_linearVelocity.setVec2(r.c_velocity.v),r.m_angularVelocity=r.c_velocity.w,r.synchronizeTransform()}if(this.postSolveIsland(),s){for(var C=1/0,M=B.linearSleepToleranceSqr,I=B.angularSleepToleranceSqr,n=0;n<this.m_bodies.length;++n){var r=this.m_bodies[n];r.isStatic()||(!1==r.m_autoSleepFlag||r.m_angularVelocity*r.m_angularVelocity>I||b.lengthSquared(r.m_linearVelocity)>M?(r.m_sleepTime=0,C=0):(r.m_sleepTime+=o,C=g.min(C,r.m_sleepTime)))}if(C>=B.timeToSleep&&f)for(var n=0;n<this.m_bodies.length;++n){var r=this.m_bodies[n];r.setAwake(!1)}}},t.prototype.printBodies=function(t){for(var e=0;e<this.m_bodies.length;++e){var i=this.m_bodies[e];x.debug(t,i.c_position.a,i.c_position.c.x,i.c_position.c.y,i.c_velocity.w,i.c_velocity.v.x,i.c_velocity.v.y)}},t.prototype.solveWorldTOI=function(t){var e,i,s=this.m_world;if(s.m_stepComplete){for(var e=s.m_bodyList;e;e=e.m_next)e.m_islandFlag=!1,e.m_sweep.alpha0=0;for(var i=s.m_contactList;i;i=i.m_next)i.m_toiFlag=!1,i.m_islandFlag=!1,i.m_toiCount=0,i.m_toi=1}for(;;){for(var o=null,n=1,i=s.m_contactList;i;i=i.m_next)if(!1!=i.isEnabled()&&!(i.m_toiCount>B.maxSubSteps)){var r=1;if(i.m_toiFlag)r=i.m_toi;else{var a=i.getFixtureA(),m=i.getFixtureB();if(a.isSensor()||m.isSensor())continue;var h=a.getBody(),c=m.getBody(),l=h.isAwake()&&!h.isStatic(),u=c.isAwake()&&!c.isStatic();if(!1==l&&!1==u)continue;var p=h.isBullet()||!h.isDynamic(),d=c.isBullet()||!c.isDynamic();if(!1==p&&!1==d)continue;var y=h.m_sweep.alpha0;h.m_sweep.alpha0<c.m_sweep.alpha0?(y=c.m_sweep.alpha0,h.m_sweep.advance(y)):c.m_sweep.alpha0<h.m_sweep.alpha0&&(y=h.m_sweep.alpha0,c.m_sweep.advance(y));var f=i.getChildIndexA(),v=i.getChildIndexB();h.m_sweep,c.m_sweep;var x=new tp;x.proxyA.set(a.getShape(),f),x.proxyB.set(m.getShape(),v),x.sweepA.set(h.m_sweep),x.sweepB.set(c.m_sweep),x.tMax=1;var b=new td;ty(b,x);var A=b.t;r=b.state==_.e_touching?g.min(y+(1-y)*A,1):1,i.m_toi=r,i.m_toiFlag=!0}r<n&&(o=i,n=r)}if(null==o||1-10*g.EPSILON<n){s.m_stepComplete=!0;break}var w=o.getFixtureA(),V=o.getFixtureB(),C=w.getBody(),M=V.getBody(),I=C.m_sweep.clone(),z=M.m_sweep.clone();if(C.advance(n),M.advance(n),o.update(s),o.m_toiFlag=!1,++o.m_toiCount,!1==o.isEnabled()||!1==o.isTouching()){o.setEnabled(!1),C.m_sweep.set(I),M.m_sweep.set(z),C.synchronizeTransform(),M.synchronizeTransform();continue}C.setAwake(!0),M.setAwake(!0),this.clear(),this.addBody(C),this.addBody(M),this.addContact(o),C.m_islandFlag=!0,M.m_islandFlag=!0,o.m_islandFlag=!0;for(var P=[C,M],S=0;S<P.length;++S){var T=P[S];if(T.isDynamic())for(var L=T.m_contactList;L;L=L.next){var F=L.contact;if(!F.m_islandFlag){var k=L.other;if(!k.isDynamic()||T.isBullet()||k.isBullet()){var q=F.m_fixtureA.m_isSensor,N=F.m_fixtureB.m_isSensor;if(!q&&!N){var R=k.m_sweep.clone();if(!1==k.m_islandFlag&&k.advance(n),F.update(s),!1==F.isEnabled()||!1==F.isTouching()){k.m_sweep.set(R),k.synchronizeTransform();continue}F.m_islandFlag=!0,this.addContact(F),k.m_islandFlag||(k.m_islandFlag=!0,k.isStatic()||k.setAwake(!0),this.addBody(k))}}}}}tx.reset((1-n)*t.dt),tx.dtRatio=1,tx.positionIterations=20,tx.velocityIterations=t.velocityIterations,tx.warmStarting=!1,this.solveIslandTOI(tx,C,M);for(var S=0;S<this.m_bodies.length;++S){var T=this.m_bodies[S];if(T.m_islandFlag=!1,T.isDynamic()){T.synchronizeFixtures();for(var L=T.m_contactList;L;L=L.next)L.contact.m_toiFlag=!1,L.contact.m_islandFlag=!1}}if(s.findNewContacts(),s.m_subStepping){s.m_stepComplete=!1;break}}},t.prototype.solveIslandTOI=function(t,e,i){this.m_world;for(var s,o,s=0;s<this.m_bodies.length;++s){var n=this.m_bodies[s];n.c_position.c.setVec2(n.m_sweep.c),n.c_position.a=n.m_sweep.a,n.c_velocity.v.setVec2(n.m_linearVelocity),n.c_velocity.w=n.m_angularVelocity}for(var s=0;s<this.m_contacts.length;++s){var r=this.m_contacts[s];r.initConstraint(t)}for(var s=0;s<t.positionIterations;++s){for(var a=0,m=0;m<this.m_contacts.length;++m){var r=this.m_contacts[m],h=r.solvePositionConstraintTOI(t,e,i);a=g.min(a,h)}if(a>=-1.5*B.linearSlop)break}e.m_sweep.c0.setVec2(e.c_position.c),e.m_sweep.a0=e.c_position.a,i.m_sweep.c0.setVec2(i.c_position.c),i.m_sweep.a0=i.c_position.a;for(var s=0;s<this.m_contacts.length;++s){var r=this.m_contacts[s];r.initVelocityConstraint(t)}for(var s=0;s<t.velocityIterations;++s)for(var m=0;m<this.m_contacts.length;++m){var r=this.m_contacts[m];r.solveVelocityConstraint(t)}for(var c=t.dt,s=0;s<this.m_bodies.length;++s){var n=this.m_bodies[s],o=b.clone(n.c_position.c),_=n.c_position.a,l=b.clone(n.c_velocity.v),u=n.c_velocity.w,p=b.mulNumVec2(c,l);if(b.dot(p,p)>B.maxTranslationSquared){var d=B.maxTranslation/p.length();l.mul(d)}var y=c*u;if(y*y>B.maxRotationSquared){var d=B.maxRotation/g.abs(y);u*=d}o.addMul(c,l),_+=c*u,n.c_position.c=o,n.c_position.a=_,n.c_velocity.v=l,n.c_velocity.w=u,n.m_sweep.c=o,n.m_sweep.a=_,n.m_linearVelocity=l,n.m_angularVelocity=u,n.synchronizeTransform()}this.postSolveIsland()},t.prototype.postSolveIsland=function(){for(var t=0;t<this.m_contacts.length;++t){var e=this.m_contacts[t];this.m_world.postSolve(e,e.m_impulse)}},t}(),tA={gravity:b.zero(),allowSleep:!0,warmStarting:!0,continuousPhysics:!0,subStepping:!1,blockSolve:!0,velocityIterations:8,positionIterations:3},tB=function(){function t(e){var i=this;if(this.s_step=new tv,this.createContact=function(t,e){var s=t.fixture,o=e.fixture,n=t.childIndex,r=e.childIndex,a=s.getBody(),m=o.getBody();if(a!=m){for(var h=m.getContactList();h;){if(h.other==a){var c=h.contact.getFixtureA(),_=h.contact.getFixtureB(),l=h.contact.getChildIndexA(),u=h.contact.getChildIndexB();if(c==s&&_==o&&l==n&&u==r||c==o&&_==s&&l==r&&u==n)return}h=h.next}if(!1!=m.shouldCollide(a)&&!1!=o.shouldCollide(s)){var p=t_.create(s,n,o,r);null!=p&&(p.m_prev=null,null!=i.m_contactList&&(p.m_next=i.m_contactList,i.m_contactList.m_prev=p),i.m_contactList=p,++i.m_contactCount)}}},!(this instanceof t))return new t(e);e&&b.isValid(e)&&(e={gravity:e}),e=v(e,tA),this.m_solver=new tb(this),this.m_broadPhase=new I,this.m_contactList=null,this.m_contactCount=0,this.m_bodyList=null,this.m_bodyCount=0,this.m_jointList=null,this.m_jointCount=0,this.m_stepComplete=!0,this.m_allowSleep=e.allowSleep,this.m_gravity=b.clone(e.gravity),this.m_clearForces=!0,this.m_newFixture=!1,this.m_locked=!1,this.m_warmStarting=e.warmStarting,this.m_continuousPhysics=e.continuousPhysics,this.m_subStepping=e.subStepping,this.m_blockSolve=e.blockSolve,this.m_velocityIterations=e.velocityIterations,this.m_positionIterations=e.positionIterations,this.m_t=0}return t.prototype._serialize=function(){for(var t=[],e=[],i=this.getBodyList();i;i=i.getNext())t.push(i);for(var s=this.getJointList();s;s=s.getNext())"function"==typeof s._serialize&&e.push(s);return{gravity:this.m_gravity,bodies:t,joints:e}},t._deserialize=function(e,i,s){if(!e)return new t;var o=new t(e.gravity);if(e.bodies)for(var n=e.bodies.length-1;n>=0;n-=1)o._addBody(s(Y,e.bodies[n],o));if(e.joints)for(var n=e.joints.length-1;n>=0;n--)o.createJoint(s(tu,e.joints[n],o));return o},t.prototype.getBodyList=function(){return this.m_bodyList},t.prototype.getJointList=function(){return this.m_jointList},t.prototype.getContactList=function(){return this.m_contactList},t.prototype.getBodyCount=function(){return this.m_bodyCount},t.prototype.getJointCount=function(){return this.m_jointCount},t.prototype.getContactCount=function(){return this.m_contactCount},t.prototype.setGravity=function(t){this.m_gravity=t},t.prototype.getGravity=function(){return this.m_gravity},t.prototype.isLocked=function(){return this.m_locked},t.prototype.setAllowSleeping=function(t){if(t!=this.m_allowSleep&&(this.m_allowSleep=t,!1==this.m_allowSleep))for(var e=this.m_bodyList;e;e=e.m_next)e.setAwake(!0)},t.prototype.getAllowSleeping=function(){return this.m_allowSleep},t.prototype.setWarmStarting=function(t){this.m_warmStarting=t},t.prototype.getWarmStarting=function(){return this.m_warmStarting},t.prototype.setContinuousPhysics=function(t){this.m_continuousPhysics=t},t.prototype.getContinuousPhysics=function(){return this.m_continuousPhysics},t.prototype.setSubStepping=function(t){this.m_subStepping=t},t.prototype.getSubStepping=function(){return this.m_subStepping},t.prototype.setAutoClearForces=function(t){this.m_clearForces=t},t.prototype.getAutoClearForces=function(){return this.m_clearForces},t.prototype.clearForces=function(){for(var t=this.m_bodyList;t;t=t.getNext())t.m_force.setZero(),t.m_torque=0},t.prototype.queryAABB=function(t,e){var i=this.m_broadPhase;this.m_broadPhase.query(t,function(t){return e(i.getUserData(t).fixture)})},t.prototype.rayCast=function(t,e,i){var s=this.m_broadPhase;this.m_broadPhase.rayCast({maxFraction:1,p1:t,p2:e},function(t,e){var o=s.getUserData(e),n=o.fixture,r=o.childIndex,a={};if(n.rayCast(a,t,r)){var m=a.fraction;return i(n,b.add(b.mulNumVec2(1-m,t.p1),b.mulNumVec2(m,t.p2)),a.normal,m)}return t.maxFraction})},t.prototype.getProxyCount=function(){return this.m_broadPhase.getProxyCount()},t.prototype.getTreeHeight=function(){return this.m_broadPhase.getTreeHeight()},t.prototype.getTreeBalance=function(){return this.m_broadPhase.getTreeBalance()},t.prototype.getTreeQuality=function(){return this.m_broadPhase.getTreeQuality()},t.prototype.shiftOrigin=function(t){if(!this.m_locked){for(var e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.sub(t),e.m_sweep.c0.sub(t),e.m_sweep.c.sub(t);for(var i=this.m_jointList;i;i=i.m_next)i.shiftOrigin(t);this.m_broadPhase.shiftOrigin(t)}},t.prototype._addBody=function(t){!this.isLocked()&&(t.m_prev=null,t.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=t),this.m_bodyList=t,++this.m_bodyCount)},t.prototype.createBody=function(t,e){if(this.isLocked())return null;var i={};t&&(b.isValid(t)?i={position:t,angle:e}:"object"==typeof t&&(i=t));var s=new Y(this,i);return this._addBody(s),s},t.prototype.createDynamicBody=function(t,e){var i={};return t&&(b.isValid(t)?i={position:t,angle:e}:"object"==typeof t&&(i=t)),i.type="dynamic",this.createBody(i)},t.prototype.createKinematicBody=function(t,e){var i={};return t&&(b.isValid(t)?i={position:t,angle:e}:"object"==typeof t&&(i=t)),i.type="kinematic",this.createBody(i)},t.prototype.destroyBody=function(t){if(!this.isLocked()){if(t.m_destroyed)return!1;for(var e=t.m_jointList;e;){var i=e;e=e.next,this.publish("remove-joint",i.joint),this.destroyJoint(i.joint),t.m_jointList=e}t.m_jointList=null;for(var s=t.m_contactList;s;){var o=s;s=s.next,this.destroyContact(o.contact),t.m_contactList=s}t.m_contactList=null;for(var n=t.m_fixtureList;n;){var r=n;n=n.m_next,this.publish("remove-fixture",r),r.destroyProxies(this.m_broadPhase),t.m_fixtureList=n}return t.m_fixtureList=null,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_bodyList&&(this.m_bodyList=t.m_next),t.m_destroyed=!0,--this.m_bodyCount,this.publish("remove-body",t),!0}},t.prototype.createJoint=function(t){if(this.isLocked())return null;if(t.m_prev=null,t.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=t),this.m_jointList=t,++this.m_jointCount,t.m_edgeA.joint=t,t.m_edgeA.other=t.m_bodyB,t.m_edgeA.prev=null,t.m_edgeA.next=t.m_bodyA.m_jointList,t.m_bodyA.m_jointList&&(t.m_bodyA.m_jointList.prev=t.m_edgeA),t.m_bodyA.m_jointList=t.m_edgeA,t.m_edgeB.joint=t,t.m_edgeB.other=t.m_bodyA,t.m_edgeB.prev=null,t.m_edgeB.next=t.m_bodyB.m_jointList,t.m_bodyB.m_jointList&&(t.m_bodyB.m_jointList.prev=t.m_edgeB),t.m_bodyB.m_jointList=t.m_edgeB,!1==t.m_collideConnected)for(var e=t.m_bodyB.getContactList();e;e=e.next)e.other==t.m_bodyA&&e.contact.flagForFiltering();return t},t.prototype.destroyJoint=function(t){if(!this.isLocked()){t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_jointList&&(this.m_jointList=t.m_next);var e=t.m_bodyA,i=t.m_bodyB;if(e.setAwake(!0),i.setAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA==e.m_jointList&&(e.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB==i.m_jointList&&(i.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,--this.m_jointCount,!1==t.m_collideConnected)for(var s=i.getContactList();s;)s.other==e&&s.contact.flagForFiltering(),s=s.next;this.publish("remove-joint",t)}},t.prototype.step=function(t,e,i){if(this.publish("pre-step",t),(0|e)!==e&&(e=0),e=e||this.m_velocityIterations,i=i||this.m_positionIterations,this.m_newFixture&&(this.findNewContacts(),this.m_newFixture=!1),this.m_locked=!0,this.s_step.reset(t),this.s_step.velocityIterations=e,this.s_step.positionIterations=i,this.s_step.warmStarting=this.m_warmStarting,this.s_step.blockSolve=this.m_blockSolve,this.updateContacts(),this.m_stepComplete&&t>0){this.m_solver.solveWorld(this.s_step);for(var s=this.m_bodyList;s;s=s.getNext())!1!=s.m_islandFlag&&(s.isStatic()||s.synchronizeFixtures());this.findNewContacts()}this.m_continuousPhysics&&t>0&&this.m_solver.solveWorldTOI(this.s_step),this.m_clearForces&&this.clearForces(),this.m_locked=!1,this.publish("post-step",t)},t.prototype.findNewContacts=function(){this.m_broadPhase.updatePairs(this.createContact)},t.prototype.updateContacts=function(){for(var t,e=this.m_contactList;t=e;){e=t.getNext();var i=t.getFixtureA(),s=t.getFixtureB(),o=t.getChildIndexA(),n=t.getChildIndexB(),r=i.getBody(),a=s.getBody();if(t.m_filterFlag){if(!1==a.shouldCollide(r)||!1==s.shouldCollide(i)){this.destroyContact(t);continue}t.m_filterFlag=!1}var m=r.isAwake()&&!r.isStatic(),h=a.isAwake()&&!a.isStatic();if(!1!=m||!1!=h){var c=i.m_proxies[o].proxyId,_=s.m_proxies[n].proxyId;if(!1==this.m_broadPhase.testOverlap(c,_)){this.destroyContact(t);continue}t.update(this)}}},t.prototype.destroyContact=function(t){t_.destroy(t,this),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_contactList&&(this.m_contactList=t.m_next),--this.m_contactCount},t.prototype.on=function(t,e){return"string"!=typeof t||"function"!=typeof e||(this._listeners||(this._listeners={}),this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push(e)),this},t.prototype.off=function(t,e){if("string"!=typeof t||"function"!=typeof e)return this;var i=this._listeners&&this._listeners[t];if(!i||!i.length)return this;var s=i.indexOf(e);return s>=0&&i.splice(s,1),this},t.prototype.publish=function(t,e,i,s){var o=this._listeners&&this._listeners[t];if(!o||!o.length)return 0;for(var n=0;n<o.length;n++)o[n].call(this,e,i,s);return o.length},t.prototype.beginContact=function(t){this.publish("begin-contact",t)},t.prototype.endContact=function(t){this.publish("end-contact",t)},t.prototype.preSolve=function(t,e){this.publish("pre-solve",t,e)},t.prototype.postSolve=function(t,e){this.publish("post-solve",t,e)},t}(),tw=function(){function t(e,i,s){if(!(this instanceof t))return new t(e,i,s);void 0===e?(this.x=0,this.y=0,this.z=0):"object"==typeof e?(this.x=e.x,this.y=e.y,this.z=e.z):(this.x=e,this.y=i,this.z=s)}return t.prototype._serialize=function(){return{x:this.x,y:this.y,z:this.z}},t._deserialize=function(e){var i=Object.create(t.prototype);return i.x=e.x,i.y=e.y,i.z=e.z,i},t.neo=function(e,i,s){var o=Object.create(t.prototype);return o.x=e,o.y=i,o.z=s,o},t.zero=function(){var e=Object.create(t.prototype);return e.x=0,e.y=0,e.z=0,e},t.clone=function(e){return t.neo(e.x,e.y,e.z)},t.prototype.toString=function(){return JSON.stringify(this)},t.isValid=function(t){return null!=t&&g.isFinite(t.x)&&g.isFinite(t.y)&&g.isFinite(t.z)},t.assert=function(t){},t.prototype.setZero=function(){return this.x=0,this.y=0,this.z=0,this},t.prototype.set=function(t,e,i){return this.x=t,this.y=e,this.z=i,this},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},t.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},t.prototype.mul=function(t){return this.x*=t,this.y*=t,this.z*=t,this},t.areEqual=function(t,e){return t===e||"object"==typeof t&&null!==t&&"object"==typeof e&&null!==e&&t.x===e.x&&t.y===e.y&&t.z===e.z},t.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},t.cross=function(e,i){return new t(e.y*i.z-e.z*i.y,e.z*i.x-e.x*i.z,e.x*i.y-e.y*i.x)},t.add=function(e,i){return new t(e.x+i.x,e.y+i.y,e.z+i.z)},t.sub=function(e,i){return new t(e.x-i.x,e.y-i.y,e.z-i.z)},t.mul=function(e,i){return new t(i*e.x,i*e.y,i*e.z)},t.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},t.neg=function(e){return new t(-e.x,-e.y,-e.z)},t}(),tV=function(t){function e(i,s){var o=this;return o instanceof e?((o=t.call(this)||this).m_type=e.TYPE,o.m_radius=B.polygonRadius,o.m_vertex1=i?b.clone(i):b.zero(),o.m_vertex2=s?b.clone(s):b.zero(),o.m_vertex0=b.zero(),o.m_vertex3=b.zero(),o.m_hasVertex0=!1,o.m_hasVertex3=!1,o):new e(i,s)}return y(e,t),e.prototype._serialize=function(){return{type:this.m_type,vertex1:this.m_vertex1,vertex2:this.m_vertex2,vertex0:this.m_vertex0,vertex3:this.m_vertex3,hasVertex0:this.m_hasVertex0,hasVertex3:this.m_hasVertex3}},e._deserialize=function(t){var i=new e(t.vertex1,t.vertex2);return i.m_hasVertex0&&i.setPrevVertex(t.vertex0),i.m_hasVertex3&&i.setNextVertex(t.vertex3),i},e.prototype.setNext=function(t){return this.setNextVertex(t)},e.prototype.setNextVertex=function(t){return t?(this.m_vertex3.setVec2(t),this.m_hasVertex3=!0):(this.m_vertex3.setZero(),this.m_hasVertex3=!1),this},e.prototype.getNextVertex=function(){return this.m_vertex3},e.prototype.setPrev=function(t){return this.setPrevVertex(t)},e.prototype.setPrevVertex=function(t){return t?(this.m_vertex0.setVec2(t),this.m_hasVertex0=!0):(this.m_vertex0.setZero(),this.m_hasVertex0=!1),this},e.prototype.getPrevVertex=function(){return this.m_vertex0},e.prototype._set=function(t,e){return this.m_vertex1.setVec2(t),this.m_vertex2.setVec2(e),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this},e.prototype._clone=function(){var t=new e;return t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_vertex1.setVec2(this.m_vertex1),t.m_vertex2.setVec2(this.m_vertex2),t.m_vertex0.setVec2(this.m_vertex0),t.m_vertex3.setVec2(this.m_vertex3),t.m_hasVertex0=this.m_hasVertex0,t.m_hasVertex3=this.m_hasVertex3,t},e.prototype.getChildCount=function(){return 1},e.prototype.testPoint=function(t,e){return!1},e.prototype.rayCast=function(t,e,i,s){var o=z.mulTVec2(i.q,b.sub(e.p1,i.p)),n=z.mulTVec2(i.q,b.sub(e.p2,i.p)),r=b.sub(n,o),a=this.m_vertex1,m=this.m_vertex2,h=b.sub(m,a),c=b.neo(h.y,-h.x);c.normalize();var _=b.dot(c,b.sub(a,o)),l=b.dot(c,r);if(0==l)return!1;var u=_/l;if(u<0||e.maxFraction<u)return!1;var p=b.add(o,b.mulNumVec2(u,r)),d=b.sub(m,a),y=b.dot(d,d);if(0==y)return!1;var f=b.dot(b.sub(p,a),d)/y;return!(f<0)&&!(1<f)&&(t.fraction=u,_>0?t.normal=z.mulVec2(i.q,c).neg():t.normal=z.mulVec2(i.q,c),!0)},e.prototype.computeAABB=function(t,e,i){var s=P.mulVec2(e,this.m_vertex1),o=P.mulVec2(e,this.m_vertex2);t.combinePoints(s,o),t.extend(this.m_radius)},e.prototype.computeMass=function(t,e){t.mass=0,t.center.setCombine(.5,this.m_vertex1,.5,this.m_vertex2),t.I=0},e.prototype.computeDistanceProxy=function(t){t.m_vertices.push(this.m_vertex1),t.m_vertices.push(this.m_vertex2),t.m_count=2,t.m_radius=this.m_radius},e.TYPE="edge",e}(F),tC=function(t){function e(i,s){var o=this;return o instanceof e?((o=t.call(this)||this).m_type=e.TYPE,o.m_radius=B.polygonRadius,o.m_vertices=[],o.m_count=0,o.m_prevVertex=null,o.m_nextVertex=null,o.m_hasPrevVertex=!1,o.m_hasNextVertex=!1,o.m_isLoop=!!s,i&&i.length&&(s?o._createLoop(i):o._createChain(i)),o):new e(i,s)}return y(e,t),e.prototype._serialize=function(){var t={type:this.m_type,vertices:this.m_vertices,isLoop:this.m_isLoop,hasPrevVertex:this.m_hasPrevVertex,hasNextVertex:this.m_hasNextVertex,prevVertex:null,nextVertex:null};return this.m_prevVertex&&(t.prevVertex=this.m_prevVertex),this.m_nextVertex&&(t.nextVertex=this.m_nextVertex),t},e._deserialize=function(t,i,s){var o=[];if(t.vertices)for(var n=0;n<t.vertices.length;n++)o.push(s(b,t.vertices[n]));var r=new e(o,t.isLoop);return t.prevVertex&&r.setPrevVertex(t.prevVertex),t.nextVertex&&r.setNextVertex(t.nextVertex),r},e.prototype._createLoop=function(t){for(var e=1;e<t.length;++e)t[e-1],t[e];this.m_vertices=[],this.m_count=t.length+1;for(var e=0;e<t.length;++e)this.m_vertices[e]=b.clone(t[e]);return this.m_vertices[t.length]=b.clone(t[0]),this.m_prevVertex=this.m_vertices[this.m_count-2],this.m_nextVertex=this.m_vertices[1],this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this},e.prototype._createChain=function(t){for(var e=1;e<t.length;++e)t[e-1],t[e];this.m_count=t.length;for(var e=0;e<t.length;++e)this.m_vertices[e]=b.clone(t[e]);return this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_prevVertex=null,this.m_nextVertex=null,this},e.prototype._reset=function(){this.m_isLoop?this._createLoop(this.m_vertices):this._createChain(this.m_vertices)},e.prototype.setPrevVertex=function(t){this.m_prevVertex=t,this.m_hasPrevVertex=!0},e.prototype.getPrevVertex=function(){return this.m_prevVertex},e.prototype.setNextVertex=function(t){this.m_nextVertex=t,this.m_hasNextVertex=!0},e.prototype.getNextVertex=function(){return this.m_nextVertex},e.prototype._clone=function(){var t=new e;return t._createChain(this.m_vertices),t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_prevVertex=this.m_prevVertex,t.m_nextVertex=this.m_nextVertex,t.m_hasPrevVertex=this.m_hasPrevVertex,t.m_hasNextVertex=this.m_hasNextVertex,t},e.prototype.getChildCount=function(){return this.m_count-1},e.prototype.getChildEdge=function(t,e){t.m_type=tV.TYPE,t.m_radius=this.m_radius,t.m_vertex1=this.m_vertices[e],t.m_vertex2=this.m_vertices[e+1],e>0?(t.m_vertex0=this.m_vertices[e-1],t.m_hasVertex0=!0):(t.m_vertex0=this.m_prevVertex,t.m_hasVertex0=this.m_hasPrevVertex),e<this.m_count-2?(t.m_vertex3=this.m_vertices[e+2],t.m_hasVertex3=!0):(t.m_vertex3=this.m_nextVertex,t.m_hasVertex3=this.m_hasNextVertex)},e.prototype.getVertex=function(t){return t<this.m_count?this.m_vertices[t]:this.m_vertices[0]},e.prototype.isLoop=function(){return this.m_isLoop},e.prototype.testPoint=function(t,e){return!1},e.prototype.rayCast=function(t,e,i,s){return new tV(this.getVertex(s),this.getVertex(s+1)).rayCast(t,e,i,0)},e.prototype.computeAABB=function(t,e,i){var s=P.mulVec2(e,this.getVertex(i)),o=P.mulVec2(e,this.getVertex(i+1));t.combinePoints(s,o)},e.prototype.computeMass=function(t,e){t.mass=0,t.center=b.zero(),t.I=0},e.prototype.computeDistanceProxy=function(t,e){t.m_buffer[0]=this.getVertex(e),t.m_buffer[1]=this.getVertex(e+1),t.m_vertices=t.m_buffer,t.m_count=2,t.m_radius=this.m_radius},e.TYPE="chain",e}(F),tM=function(t){function e(i){var s=this;return s instanceof e?((s=t.call(this)||this).m_type=e.TYPE,s.m_radius=B.polygonRadius,s.m_centroid=b.zero(),s.m_vertices=[],s.m_normals=[],s.m_count=0,i&&i.length&&s._set(i),s):new e(i)}return y(e,t),e.prototype._serialize=function(){return{type:this.m_type,vertices:this.m_vertices}},e._deserialize=function(t,i,s){var o=[];if(t.vertices)for(var n=0;n<t.vertices.length;n++)o.push(s(b,t.vertices[n]));return new e(o)},e.prototype.getVertex=function(t){return this.m_vertices[t]},e.prototype._clone=function(){var t=new e;t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_count=this.m_count,t.m_centroid.setVec2(this.m_centroid);for(var i=0;i<this.m_count;i++)t.m_vertices.push(this.m_vertices[i].clone());for(var i=0;i<this.m_normals.length;i++)t.m_normals.push(this.m_normals[i].clone());return t},e.prototype.getChildCount=function(){return 1},e.prototype._reset=function(){this._set(this.m_vertices)},e.prototype._set=function(t){if(t.length<3){this._setAsBox(1,1);return}for(var e=g.min(t.length,B.maxPolygonVertices),i=[],s=0;s<e;++s){for(var o=t[s],n=!0,r=0;r<i.length;++r)if(b.distanceSquared(o,i[r])<.25*B.linearSlopSquared){n=!1;break}n&&i.push(o)}if((e=i.length)<3){this._setAsBox(1,1);return}for(var a=0,m=i[0].x,s=1;s<e;++s){var h=i[s].x;(h>m||h===m&&i[s].y<i[a].y)&&(a=s,m=h)}for(var c=[],_=0,l=a;;){c[_]=l;for(var u=0,r=1;r<e;++r){if(u===l){u=r;continue}var p=b.sub(i[u],i[c[_]]),o=b.sub(i[r],i[c[_]]),d=b.crossVec2Vec2(p,o);d<0&&(u=r),0===d&&o.lengthSquared()>p.lengthSquared()&&(u=r)}if(++_,l=u,u===a)break}if(_<3){this._setAsBox(1,1);return}this.m_count=_,this.m_vertices=[];for(var s=0;s<_;++s)this.m_vertices[s]=i[c[s]];for(var s=0;s<_;++s){var y=s,f=s+1<_?s+1:0,v=b.sub(this.m_vertices[f],this.m_vertices[y]);this.m_normals[s]=b.crossVec2Num(v,1),this.m_normals[s].normalize()}this.m_centroid=function(t,e){for(var i,s=b.zero(),o=0,n=b.zero(),r=1/3,i=0;i<e;++i){var a=t[i],m=i+1<e?t[i+1]:t[0],h=b.sub(a,n),c=b.sub(m,n),_=.5*b.crossVec2Vec2(h,c);o+=_,s.addMul(_*r,n),s.addMul(_*r,a),s.addMul(_*r,m)}return s.mul(1/o),s}(this.m_vertices,_)},e.prototype._setAsBox=function(t,e,i,s){if(this.m_vertices[0]=b.neo(t,-e),this.m_vertices[1]=b.neo(t,e),this.m_vertices[2]=b.neo(-t,e),this.m_vertices[3]=b.neo(-t,-e),this.m_normals[0]=b.neo(1,0),this.m_normals[1]=b.neo(0,1),this.m_normals[2]=b.neo(-1,0),this.m_normals[3]=b.neo(0,-1),this.m_count=4,b.isValid(i)){s=s||0,this.m_centroid.setVec2(i);var o=P.identity();o.p.setVec2(i),o.q.setAngle(s);for(var n=0;n<this.m_count;++n)this.m_vertices[n]=P.mulVec2(o,this.m_vertices[n]),this.m_normals[n]=z.mulVec2(o.q,this.m_normals[n])}},e.prototype.testPoint=function(t,e){for(var i=z.mulTVec2(t.q,b.sub(e,t.p)),s=0;s<this.m_count;++s)if(b.dot(this.m_normals[s],b.sub(i,this.m_vertices[s]))>0)return!1;return!0},e.prototype.rayCast=function(t,e,i,s){for(var o=z.mulTVec2(i.q,b.sub(e.p1,i.p)),n=z.mulTVec2(i.q,b.sub(e.p2,i.p)),r=b.sub(n,o),a=0,m=e.maxFraction,h=-1,c=0;c<this.m_count;++c){var _=b.dot(this.m_normals[c],b.sub(this.m_vertices[c],o)),l=b.dot(this.m_normals[c],r);if(0==l){if(_<0)return!1}else l<0&&_<a*l?(a=_/l,h=c):l>0&&_<m*l&&(m=_/l);if(m<a)return!1}return h>=0&&(t.fraction=a,t.normal=z.mulVec2(i.q,this.m_normals[h]),!0)},e.prototype.computeAABB=function(t,e,i){for(var s=1/0,o=1/0,n=-1/0,r=-1/0,a=0;a<this.m_count;++a){var m=P.mulVec2(e,this.m_vertices[a]);s=g.min(s,m.x),n=g.max(n,m.x),o=g.min(o,m.y),r=g.max(r,m.y)}t.lowerBound.setNum(s,o),t.upperBound.setNum(n,r),t.extend(this.m_radius)},e.prototype.computeMass=function(t,e){for(var i=b.zero(),s=0,o=0,n=b.zero(),r=0;r<this.m_count;++r)n.add(this.m_vertices[r]);n.mul(1/this.m_count);for(var a=1/3,r=0;r<this.m_count;++r){var m=b.sub(this.m_vertices[r],n),h=r+1<this.m_count?b.sub(this.m_vertices[r+1],n):b.sub(this.m_vertices[0],n),c=b.crossVec2Vec2(m,h),_=.5*c;s+=_,i.addCombine(_*a,m,_*a,h);var l=m.x,u=m.y,p=h.x,d=h.y;o+=.25*a*c*(l*l+p*l+p*p+(u*u+d*u+d*d))}t.mass=e*s,i.mul(1/s),t.center.setCombine(1,i,1,n),t.I=e*o,t.I+=t.mass*(b.dot(t.center,t.center)-b.dot(i,i))},e.prototype.validate=function(){for(var t=0;t<this.m_count;++t)for(var e=t,i=t<this.m_count-1?e+1:0,s=this.m_vertices[e],o=b.sub(this.m_vertices[i],s),n=0;n<this.m_count;++n)if(n!=e&&n!=i){var r=b.sub(this.m_vertices[n],s);if(0>b.crossVec2Vec2(o,r))return!1}return!0},e.prototype.computeDistanceProxy=function(t){t.m_vertices=this.m_vertices,t.m_count=this.m_count,t.m_radius=this.m_radius},e.TYPE="polygon",e}(F),tI=function(t){function e(i,s,o,n){var r=this;return r instanceof e?((r=t.call(this)||this)._setAsBox(i,s,o,n),r):new e(i,s,o,n)}return y(e,t),e.TYPE="polygon",e}(tM),tz=function(t){function e(i,s){var o=this;return o instanceof e?((o=t.call(this)||this).m_type=e.TYPE,o.m_p=b.zero(),o.m_radius=1,"object"==typeof i&&b.isValid(i)?(o.m_p.setVec2(i),"number"==typeof s&&(o.m_radius=s)):"number"==typeof i&&(o.m_radius=i),o):new e(i,s)}return y(e,t),e.prototype._serialize=function(){return{type:this.m_type,p:this.m_p,radius:this.m_radius}},e._deserialize=function(t){return new e(t.p,t.radius)},e.prototype.getRadius=function(){return this.m_radius},e.prototype.getCenter=function(){return this.m_p},e.prototype.getVertex=function(t){return this.m_p},e.prototype._clone=function(){var t=new e;return t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_p=this.m_p.clone(),t},e.prototype.getChildCount=function(){return 1},e.prototype.testPoint=function(t,e){var i=b.add(t.p,z.mulVec2(t.q,this.m_p)),s=b.sub(e,i);return b.dot(s,s)<=this.m_radius*this.m_radius},e.prototype.rayCast=function(t,e,i,s){var o=b.add(i.p,z.mulVec2(i.q,this.m_p)),n=b.sub(e.p1,o),r=b.dot(n,n)-this.m_radius*this.m_radius,a=b.sub(e.p2,e.p1),m=b.dot(n,a),h=b.dot(a,a),c=m*m-h*r;if(c<0||h<g.EPSILON)return!1;var _=-(m+g.sqrt(c));return 0<=_&&_<=e.maxFraction*h&&(_/=h,t.fraction=_,t.normal=b.add(n,b.mulNumVec2(_,a)),t.normal.normalize(),!0)},e.prototype.computeAABB=function(t,e,i){var s=b.add(e.p,z.mulVec2(e.q,this.m_p));t.lowerBound.setNum(s.x-this.m_radius,s.y-this.m_radius),t.upperBound.setNum(s.x+this.m_radius,s.y+this.m_radius)},e.prototype.computeMass=function(t,e){t.mass=e*g.PI*this.m_radius*this.m_radius,t.center=this.m_p,t.I=t.mass*(.5*this.m_radius*this.m_radius+b.dot(this.m_p,this.m_p))},e.prototype.computeDistanceProxy=function(t){t.m_vertices.push(this.m_p),t.m_count=1,t.m_radius=this.m_radius},e.TYPE="circle",e}(F),tP={frequencyHz:0,dampingRatio:0},tS=function(t){function e(i,s,o,n,r){var a=this;if(!(a instanceof e))return new e(i,s,o,n,r);if(o&&n&&"m_type"in n&&"x"in o&&"y"in o){var m=o;o=n,n=m}return i=v(i,tP),s=(a=t.call(this,i,s,o)||this).m_bodyA,o=a.m_bodyB,a.m_type=e.TYPE,a.m_localAnchorA=b.clone(n?s.getLocalPoint(n):i.localAnchorA||b.zero()),a.m_localAnchorB=b.clone(r?o.getLocalPoint(r):i.localAnchorB||b.zero()),a.m_length=g.isFinite(i.length)?i.length:b.distance(s.getWorldPoint(a.m_localAnchorA),o.getWorldPoint(a.m_localAnchorB)),a.m_frequencyHz=i.frequencyHz,a.m_dampingRatio=i.dampingRatio,a.m_impulse=0,a.m_gamma=0,a.m_bias=0,a}return y(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,length:this.m_length,impulse:this.m_impulse,gamma:this.m_gamma,bias:this.m_bias}},e._deserialize=function(t,i,s){return(t=f({},t)).bodyA=s(Y,t.bodyA,i),t.bodyB=s(Y,t.bodyB,i),new e(t)},e.prototype._setAnchors=function(t){t.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.setVec2(t.localAnchorA),t.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.setVec2(t.localAnchorB),t.length>0?this.m_length=+t.length:t.length<0||(t.anchorA||t.anchorA||t.anchorA||t.anchorA)&&(this.m_length=b.distance(this.m_bodyA.getWorldPoint(this.m_localAnchorA),this.m_bodyB.getWorldPoint(this.m_localAnchorB)))},e.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.setLength=function(t){this.m_length=t},e.prototype.getLength=function(){return this.m_length},e.prototype.setFrequency=function(t){this.m_frequencyHz=t},e.prototype.getFrequency=function(){return this.m_frequencyHz},e.prototype.setDampingRatio=function(t){this.m_dampingRatio=t},e.prototype.getDampingRatio=function(){return this.m_dampingRatio},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return b.mulNumVec2(this.m_impulse,this.m_u).mul(t)},e.prototype.getReactionTorque=function(t){return 0},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,a=this.m_bodyB.c_velocity.v,m=this.m_bodyB.c_velocity.w,h=z.neo(i),c=z.neo(r);this.m_rA=z.mulVec2(h,b.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=z.mulVec2(c,b.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_u=b.sub(b.add(n,this.m_rB),b.add(e,this.m_rA));var _=this.m_u.length();_>B.linearSlop?this.m_u.mul(1/_):this.m_u.setNum(0,0);var l=b.crossVec2Vec2(this.m_rA,this.m_u),u=b.crossVec2Vec2(this.m_rB,this.m_u),p=this.m_invMassA+this.m_invIA*l*l+this.m_invMassB+this.m_invIB*u*u;if(this.m_mass=0!=p?1/p:0,this.m_frequencyHz>0){var d=_-this.m_length,y=2*g.PI*this.m_frequencyHz,f=2*this.m_mass*this.m_dampingRatio*y,v=this.m_mass*y*y,x=t.dt;this.m_gamma=x*(f+x*v),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=d*x*v*this.m_gamma,p+=this.m_gamma,this.m_mass=0!=p?1/p:0}else this.m_gamma=0,this.m_bias=0;if(t.warmStarting){this.m_impulse*=t.dtRatio;var A=b.mulNumVec2(this.m_impulse,this.m_u);s.subMul(this.m_invMassA,A),o-=this.m_invIA*b.crossVec2Vec2(this.m_rA,A),a.addMul(this.m_invMassB,A),m+=this.m_invIB*b.crossVec2Vec2(this.m_rB,A)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.setVec2(s),this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v.setVec2(a),this.m_bodyB.c_velocity.w=m},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=b.add(e,b.crossNumVec2(i,this.m_rA)),r=b.add(s,b.crossNumVec2(o,this.m_rB)),a=b.dot(this.m_u,r)-b.dot(this.m_u,n),m=-this.m_mass*(a+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=m;var h=b.mulNumVec2(m,this.m_u);e.subMul(this.m_invMassA,h),i-=this.m_invIA*b.crossVec2Vec2(this.m_rA,h),s.addMul(this.m_invMassB,h),o+=this.m_invIB*b.crossVec2Vec2(this.m_rB,h),this.m_bodyA.c_velocity.v.setVec2(e),this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v.setVec2(s),this.m_bodyB.c_velocity.w=o},e.prototype.solvePositionConstraints=function(t){if(this.m_frequencyHz>0)return!0;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyB.c_position.c,o=this.m_bodyB.c_position.a,n=z.neo(i),r=z.neo(o),a=z.mulSub(n,this.m_localAnchorA,this.m_localCenterA),m=z.mulSub(r,this.m_localAnchorB,this.m_localCenterB),h=b.sub(b.add(s,m),b.add(e,a)),c=h.normalize()-this.m_length;c=g.clamp(c,-B.maxLinearCorrection,B.maxLinearCorrection);var _=-this.m_mass*c,l=b.mulNumVec2(_,h);return e.subMul(this.m_invMassA,l),i-=this.m_invIA*b.crossVec2Vec2(a,l),s.addMul(this.m_invMassB,l),o+=this.m_invIB*b.crossVec2Vec2(m,l),this.m_bodyA.c_position.c.setVec2(e),this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c.setVec2(s),this.m_bodyB.c_position.a=o,g.abs(c)<B.linearSlop},e.TYPE="distance-joint",e}(tu),tT={maxForce:0,maxTorque:0},tL=function(t){function e(i,s,o,n){var r=this;return r instanceof e?(i=v(i,tT),s=(r=t.call(this,i,s,o)||this).m_bodyA,o=r.m_bodyB,r.m_type=e.TYPE,r.m_localAnchorA=b.clone(n?s.getLocalPoint(n):i.localAnchorA||b.zero()),r.m_localAnchorB=b.clone(n?o.getLocalPoint(n):i.localAnchorB||b.zero()),r.m_linearImpulse=b.zero(),r.m_angularImpulse=0,r.m_maxForce=i.maxForce,r.m_maxTorque=i.maxTorque,r):new e(i,s,o,n)}return y(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,maxForce:this.m_maxForce,maxTorque:this.m_maxTorque,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB}},e._deserialize=function(t,i,s){return(t=f({},t)).bodyA=s(Y,t.bodyA,i),t.bodyB=s(Y,t.bodyB,i),new e(t)},e.prototype._setAnchors=function(t){t.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.setVec2(t.localAnchorA),t.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.setVec2(t.localAnchorB)},e.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.setMaxForce=function(t){this.m_maxForce=t},e.prototype.getMaxForce=function(){return this.m_maxForce},e.prototype.setMaxTorque=function(t){this.m_maxTorque=t},e.prototype.getMaxTorque=function(){return this.m_maxTorque},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return b.mulNumVec2(t,this.m_linearImpulse)},e.prototype.getReactionTorque=function(t){return t*this.m_angularImpulse},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,a=z.neo(e),m=z.neo(o);this.m_rA=z.mulVec2(a,b.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=z.mulVec2(m,b.sub(this.m_localAnchorB,this.m_localCenterB));var h=this.m_invMassA,c=this.m_invMassB,_=this.m_invIA,l=this.m_invIB,u=new W;if(u.ex.x=h+c+_*this.m_rA.y*this.m_rA.y+l*this.m_rB.y*this.m_rB.y,u.ex.y=-_*this.m_rA.x*this.m_rA.y-l*this.m_rB.x*this.m_rB.y,u.ey.x=u.ex.y,u.ey.y=h+c+_*this.m_rA.x*this.m_rA.x+l*this.m_rB.x*this.m_rB.x,this.m_linearMass=u.getInverse(),this.m_angularMass=_+l,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.warmStarting){this.m_linearImpulse.mul(t.dtRatio),this.m_angularImpulse*=t.dtRatio;var p=b.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);i.subMul(h,p),s-=_*(b.crossVec2Vec2(this.m_rA,p)+this.m_angularImpulse),n.addMul(c,p),r+=l*(b.crossVec2Vec2(this.m_rB,p)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=r},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,a=this.m_invIA,m=this.m_invIB,h=t.dt,c=o-i,_=-this.m_angularMass*c,l=this.m_angularImpulse,u=h*this.m_maxTorque;this.m_angularImpulse=g.clamp(this.m_angularImpulse+_,-u,u),i-=a*(_=this.m_angularImpulse-l),o+=m*_;var c=b.sub(b.add(s,b.crossNumVec2(o,this.m_rB)),b.add(e,b.crossNumVec2(i,this.m_rA))),_=b.neg(W.mulVec2(this.m_linearMass,c)),l=this.m_linearImpulse;this.m_linearImpulse.add(_);var u=h*this.m_maxForce;this.m_linearImpulse.lengthSquared()>u*u&&(this.m_linearImpulse.normalize(),this.m_linearImpulse.mul(u)),_=b.sub(this.m_linearImpulse,l),e.subMul(n,_),i-=a*b.crossVec2Vec2(this.m_rA,_),s.addMul(r,_),o+=m*b.crossVec2Vec2(this.m_rB,_),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o},e.prototype.solvePositionConstraints=function(t){return!0},e.TYPE="friction-joint",e}(tu),tF=function(){function t(t,e,i){"object"==typeof t&&null!==t?(this.ex=tw.clone(t),this.ey=tw.clone(e),this.ez=tw.clone(i)):(this.ex=tw.zero(),this.ey=tw.zero(),this.ez=tw.zero())}return t.prototype.toString=function(){return JSON.stringify(this)},t.isValid=function(t){return null!=t&&tw.isValid(t.ex)&&tw.isValid(t.ey)&&tw.isValid(t.ez)},t.assert=function(t){},t.prototype.setZero=function(){return this.ex.setZero(),this.ey.setZero(),this.ez.setZero(),this},t.prototype.solve33=function(t){var e=tw.dot(this.ex,tw.cross(this.ey,this.ez));0!==e&&(e=1/e);var i=new tw;return i.x=e*tw.dot(t,tw.cross(this.ey,this.ez)),i.y=e*tw.dot(this.ex,tw.cross(t,this.ez)),i.z=e*tw.dot(this.ex,tw.cross(this.ey,t)),i},t.prototype.solve22=function(t){var e=this.ex.x,i=this.ey.x,s=this.ex.y,o=this.ey.y,n=e*o-i*s;0!==n&&(n=1/n);var r=b.zero();return r.x=n*(o*t.x-i*t.y),r.y=n*(e*t.y-s*t.x),r},t.prototype.getInverse22=function(t){var e=this.ex.x,i=this.ey.x,s=this.ex.y,o=this.ey.y,n=e*o-i*s;0!==n&&(n=1/n),t.ex.x=n*o,t.ey.x=-n*i,t.ex.z=0,t.ex.y=-n*s,t.ey.y=n*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0},t.prototype.getSymInverse33=function(t){var e=tw.dot(this.ex,tw.cross(this.ey,this.ez));0!==e&&(e=1/e);var i=this.ex.x,s=this.ey.x,o=this.ez.x,n=this.ey.y,r=this.ez.y,a=this.ez.z;t.ex.x=e*(n*a-r*r),t.ex.y=e*(o*r-s*a),t.ex.z=e*(s*r-o*n),t.ey.x=t.ex.y,t.ey.y=e*(i*a-o*o),t.ey.z=e*(o*s-i*r),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(i*n-s*s)},t.mul=function(t,e){if(e&&"z"in e&&"y"in e&&"x"in e){var i=t.ex.x*e.x+t.ey.x*e.y+t.ez.x*e.z,s=t.ex.y*e.x+t.ey.y*e.y+t.ez.y*e.z;return new tw(i,s,t.ex.z*e.x+t.ey.z*e.y+t.ez.z*e.z)}if(e&&"y"in e&&"x"in e){var i=t.ex.x*e.x+t.ey.x*e.y,s=t.ex.y*e.x+t.ey.y*e.y;return b.neo(i,s)}},t.mulVec3=function(t,e){return new tw(t.ex.x*e.x+t.ey.x*e.y+t.ez.x*e.z,t.ex.y*e.x+t.ey.y*e.y+t.ez.y*e.z,t.ex.z*e.x+t.ey.z*e.y+t.ez.z*e.z)},t.mulVec2=function(t,e){var i=t.ex.x*e.x+t.ey.x*e.y,s=t.ex.y*e.x+t.ey.y*e.y;return b.neo(i,s)},t.add=function(e,i){return new t(tw.add(e.ex,i.ex),tw.add(e.ey,i.ey),tw.add(e.ez,i.ez))},t}(),tk={lowerAngle:0,upperAngle:0,maxMotorTorque:0,motorSpeed:0,enableLimit:!1,enableMotor:!1},tq=function(t){function e(i,s,o,n){var r=this;return r instanceof e?(i=v(i,tk),(r=t.call(this,i,s,o)||this).m_mass=new tF,r.m_limitState=0,s=r.m_bodyA,o=r.m_bodyB,r.m_type=e.TYPE,r.m_localAnchorA=b.clone(n?s.getLocalPoint(n):i.localAnchorA||b.zero()),r.m_localAnchorB=b.clone(n?o.getLocalPoint(n):i.localAnchorB||b.zero()),r.m_referenceAngle=g.isFinite(i.referenceAngle)?i.referenceAngle:o.getAngle()-s.getAngle(),r.m_impulse=new tw,r.m_motorImpulse=0,r.m_lowerAngle=i.lowerAngle,r.m_upperAngle=i.upperAngle,r.m_maxMotorTorque=i.maxMotorTorque,r.m_motorSpeed=i.motorSpeed,r.m_enableLimit=i.enableLimit,r.m_enableMotor=i.enableMotor,r):new e(i,s,o,n)}return y(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,lowerAngle:this.m_lowerAngle,upperAngle:this.m_upperAngle,maxMotorTorque:this.m_maxMotorTorque,motorSpeed:this.m_motorSpeed,enableLimit:this.m_enableLimit,enableMotor:this.m_enableMotor,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,referenceAngle:this.m_referenceAngle}},e._deserialize=function(t,i,s){return(t=f({},t)).bodyA=s(Y,t.bodyA,i),t.bodyB=s(Y,t.bodyB,i),new e(t)},e.prototype._setAnchors=function(t){t.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.setVec2(t.localAnchorA),t.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.setVec2(t.localAnchorB)},e.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.getReferenceAngle=function(){return this.m_referenceAngle},e.prototype.getJointAngle=function(){var t=this.m_bodyA;return this.m_bodyB.m_sweep.a-t.m_sweep.a-this.m_referenceAngle},e.prototype.getJointSpeed=function(){var t=this.m_bodyA;return this.m_bodyB.m_angularVelocity-t.m_angularVelocity},e.prototype.isMotorEnabled=function(){return this.m_enableMotor},e.prototype.enableMotor=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t},e.prototype.getMotorTorque=function(t){return t*this.m_motorImpulse},e.prototype.setMotorSpeed=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t},e.prototype.getMotorSpeed=function(){return this.m_motorSpeed},e.prototype.setMaxMotorTorque=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=t},e.prototype.getMaxMotorTorque=function(){return this.m_maxMotorTorque},e.prototype.isLimitEnabled=function(){return this.m_enableLimit},e.prototype.enableLimit=function(t){t!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},e.prototype.getLowerLimit=function(){return this.m_lowerAngle},e.prototype.getUpperLimit=function(){return this.m_upperAngle},e.prototype.setLimits=function(t,e){(t!=this.m_lowerAngle||e!=this.m_upperAngle)&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=t,this.m_upperAngle=e)},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return b.neo(this.m_impulse.x,this.m_impulse.y).mul(t)},e.prototype.getReactionTorque=function(t){return t*this.m_impulse.z},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,a=z.neo(e),m=z.neo(o);this.m_rA=z.mulVec2(a,b.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=z.mulVec2(m,b.sub(this.m_localAnchorB,this.m_localCenterB));var h=this.m_invMassA,c=this.m_invMassB,_=this.m_invIA,l=this.m_invIB,u=_+l===0;if(this.m_mass.ex.x=h+c+this.m_rA.y*this.m_rA.y*_+this.m_rB.y*this.m_rB.y*l,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*_-this.m_rB.y*this.m_rB.x*l,this.m_mass.ez.x=-this.m_rA.y*_-this.m_rB.y*l,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=h+c+this.m_rA.x*this.m_rA.x*_+this.m_rB.x*this.m_rB.x*l,this.m_mass.ez.y=this.m_rA.x*_+this.m_rB.x*l,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=_+l,this.m_motorMass=_+l,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),(!1==this.m_enableMotor||u)&&(this.m_motorImpulse=0),this.m_enableLimit&&!1==u){var p=o-e-this.m_referenceAngle;g.abs(this.m_upperAngle-this.m_lowerAngle)<2*B.angularSlop?this.m_limitState=3:p<=this.m_lowerAngle?(1!=this.m_limitState&&(this.m_impulse.z=0),this.m_limitState=1):p>=this.m_upperAngle?(2!=this.m_limitState&&(this.m_impulse.z=0),this.m_limitState=2):(this.m_limitState=0,this.m_impulse.z=0)}else this.m_limitState=0;if(t.warmStarting){this.m_impulse.mul(t.dtRatio),this.m_motorImpulse*=t.dtRatio;var d=b.neo(this.m_impulse.x,this.m_impulse.y);i.subMul(h,d),s-=_*(b.crossVec2Vec2(this.m_rA,d)+this.m_motorImpulse+this.m_impulse.z),n.addMul(c,d),r+=l*(b.crossVec2Vec2(this.m_rB,d)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=r},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,a=this.m_invIA,m=this.m_invIB,h=a+m===0;if(this.m_enableMotor&&3!=this.m_limitState&&!1==h){var c=o-i-this.m_motorSpeed,_=-this.m_motorMass*c,l=this.m_motorImpulse,u=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=g.clamp(this.m_motorImpulse+_,-u,u),i-=a*(_=this.m_motorImpulse-l),o+=m*_}if(this.m_enableLimit&&0!=this.m_limitState&&!1==h){var p=b.zero();p.addCombine(1,s,1,b.crossNumVec2(o,this.m_rB)),p.subCombine(1,e,1,b.crossNumVec2(i,this.m_rA));var d=o-i,c=new tw(p.x,p.y,d),_=tw.neg(this.m_mass.solve33(c));if(3==this.m_limitState)this.m_impulse.add(_);else if(1==this.m_limitState){var y=this.m_impulse.z+_.z;if(y<0){var f=b.combine(-1,p,this.m_impulse.z,b.neo(this.m_mass.ez.x,this.m_mass.ez.y)),v=this.m_mass.solve22(f);_.x=v.x,_.y=v.y,_.z=-this.m_impulse.z,this.m_impulse.x+=v.x,this.m_impulse.y+=v.y,this.m_impulse.z=0}else this.m_impulse.add(_)}else if(2==this.m_limitState){var y=this.m_impulse.z+_.z;if(y>0){var f=b.combine(-1,p,this.m_impulse.z,b.neo(this.m_mass.ez.x,this.m_mass.ez.y)),v=this.m_mass.solve22(f);_.x=v.x,_.y=v.y,_.z=-this.m_impulse.z,this.m_impulse.x+=v.x,this.m_impulse.y+=v.y,this.m_impulse.z=0}else this.m_impulse.add(_)}var x=b.neo(_.x,_.y);e.subMul(n,x),i-=a*(b.crossVec2Vec2(this.m_rA,x)+_.z),s.addMul(r,x),o+=m*(b.crossVec2Vec2(this.m_rB,x)+_.z)}else{var c=b.zero();c.addCombine(1,s,1,b.crossNumVec2(o,this.m_rB)),c.subCombine(1,e,1,b.crossNumVec2(i,this.m_rA));var _=this.m_mass.solve22(b.neg(c));this.m_impulse.x+=_.x,this.m_impulse.y+=_.y,e.subMul(n,_),i-=a*b.crossVec2Vec2(this.m_rA,_),s.addMul(r,_),o+=m*b.crossVec2Vec2(this.m_rB,_)}this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o},e.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyB.c_position.c,o=this.m_bodyB.c_position.a,n=z.neo(i),r=z.neo(o),a=0,m=0,h=this.m_invIA+this.m_invIB==0;if(this.m_enableLimit&&0!=this.m_limitState&&!1==h){var c=o-i-this.m_referenceAngle,_=0;if(3==this.m_limitState){var l=g.clamp(c-this.m_lowerAngle,-B.maxAngularCorrection,B.maxAngularCorrection);_=-this.m_motorMass*l,a=g.abs(l)}else if(1==this.m_limitState){var l=c-this.m_lowerAngle;a=-l,l=g.clamp(l+B.angularSlop,-B.maxAngularCorrection,0),_=-this.m_motorMass*l}else if(2==this.m_limitState){var l=c-this.m_upperAngle;a=l,l=g.clamp(l-B.angularSlop,0,B.maxAngularCorrection),_=-this.m_motorMass*l}i-=this.m_invIA*_,o+=this.m_invIB*_}n.setAngle(i),r.setAngle(o);var u=z.mulVec2(n,b.sub(this.m_localAnchorA,this.m_localCenterA)),p=z.mulVec2(r,b.sub(this.m_localAnchorB,this.m_localCenterB)),l=b.zero();l.addCombine(1,s,1,p),l.subCombine(1,e,1,u),m=l.length();var d=this.m_invMassA,y=this.m_invMassB,f=this.m_invIA,v=this.m_invIB,x=new W;x.ex.x=d+y+f*u.y*u.y+v*p.y*p.y,x.ex.y=-f*u.x*u.y-v*p.x*p.y,x.ey.x=x.ex.y,x.ey.y=d+y+f*u.x*u.x+v*p.x*p.x;var A=b.neg(x.solve(l));return e.subMul(d,A),i-=f*b.crossVec2Vec2(u,A),s.addMul(y,A),o+=v*b.crossVec2Vec2(p,A),this.m_bodyA.c_position.c.setVec2(e),this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c.setVec2(s),this.m_bodyB.c_position.a=o,m<=B.linearSlop&&a<=B.angularSlop},e.TYPE="revolute-joint",e}(tu),tN={enableLimit:!1,lowerTranslation:0,upperTranslation:0,enableMotor:!1,maxMotorForce:0,motorSpeed:0},tR=function(t){function e(i,s,o,n,r){var a=this;return a instanceof e?(i=v(i,tN),s=(a=t.call(this,i,s,o)||this).m_bodyA,o=a.m_bodyB,a.m_type=e.TYPE,a.m_localAnchorA=b.clone(n?s.getLocalPoint(n):i.localAnchorA||b.zero()),a.m_localAnchorB=b.clone(n?o.getLocalPoint(n):i.localAnchorB||b.zero()),a.m_localXAxisA=b.clone(r?s.getLocalVector(r):i.localAxisA||b.neo(1,0)),a.m_localXAxisA.normalize(),a.m_localYAxisA=b.crossNumVec2(1,a.m_localXAxisA),a.m_referenceAngle=g.isFinite(i.referenceAngle)?i.referenceAngle:o.getAngle()-s.getAngle(),a.m_impulse=new tw,a.m_motorMass=0,a.m_motorImpulse=0,a.m_lowerTranslation=i.lowerTranslation,a.m_upperTranslation=i.upperTranslation,a.m_maxMotorForce=i.maxMotorForce,a.m_motorSpeed=i.motorSpeed,a.m_enableLimit=i.enableLimit,a.m_enableMotor=i.enableMotor,a.m_limitState=0,a.m_axis=b.zero(),a.m_perp=b.zero(),a.m_K=new tF,a):new e(i,s,o,n,r)}return y(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,lowerTranslation:this.m_lowerTranslation,upperTranslation:this.m_upperTranslation,maxMotorForce:this.m_maxMotorForce,motorSpeed:this.m_motorSpeed,enableLimit:this.m_enableLimit,enableMotor:this.m_enableMotor,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,localAxisA:this.m_localXAxisA,referenceAngle:this.m_referenceAngle}},e._deserialize=function(t,i,s){return(t=f({},t)).bodyA=s(Y,t.bodyA,i),t.bodyB=s(Y,t.bodyB,i),t.localAxisA=b.clone(t.localAxisA),new e(t)},e.prototype._setAnchors=function(t){t.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.setVec2(t.localAnchorA),t.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.setVec2(t.localAnchorB),t.localAxisA&&(this.m_localXAxisA.setVec2(t.localAxisA),this.m_localYAxisA.setVec2(b.crossNumVec2(1,t.localAxisA)))},e.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.getLocalAxisA=function(){return this.m_localXAxisA},e.prototype.getReferenceAngle=function(){return this.m_referenceAngle},e.prototype.getJointTranslation=function(){var t=this.m_bodyA.getWorldPoint(this.m_localAnchorA),e=this.m_bodyB.getWorldPoint(this.m_localAnchorB),i=b.sub(e,t),s=this.m_bodyA.getWorldVector(this.m_localXAxisA);return b.dot(i,s)},e.prototype.getJointSpeed=function(){var t=this.m_bodyA,e=this.m_bodyB,i=z.mulVec2(t.m_xf.q,b.sub(this.m_localAnchorA,t.m_sweep.localCenter)),s=z.mulVec2(e.m_xf.q,b.sub(this.m_localAnchorB,e.m_sweep.localCenter)),o=b.add(t.m_sweep.c,i),n=b.add(e.m_sweep.c,s),r=b.sub(n,o),a=z.mulVec2(t.m_xf.q,this.m_localXAxisA),m=t.m_linearVelocity,h=e.m_linearVelocity,c=t.m_angularVelocity,_=e.m_angularVelocity;return b.dot(r,b.crossNumVec2(c,a))+b.dot(a,b.sub(b.addCrossNumVec2(h,_,s),b.addCrossNumVec2(m,c,i)))},e.prototype.isLimitEnabled=function(){return this.m_enableLimit},e.prototype.enableLimit=function(t){t!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},e.prototype.getLowerLimit=function(){return this.m_lowerTranslation},e.prototype.getUpperLimit=function(){return this.m_upperTranslation},e.prototype.setLimits=function(t,e){(t!=this.m_lowerTranslation||e!=this.m_upperTranslation)&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e,this.m_impulse.z=0)},e.prototype.isMotorEnabled=function(){return this.m_enableMotor},e.prototype.enableMotor=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t},e.prototype.setMotorSpeed=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t},e.prototype.setMaxMotorForce=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorForce=t},e.prototype.getMaxMotorForce=function(){return this.m_maxMotorForce},e.prototype.getMotorSpeed=function(){return this.m_motorSpeed},e.prototype.getMotorForce=function(t){return t*this.m_motorImpulse},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return b.combine(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis).mul(t)},e.prototype.getReactionTorque=function(t){return t*this.m_impulse.y},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,a=this.m_bodyB.c_velocity.v,m=this.m_bodyB.c_velocity.w,h=z.neo(i),c=z.neo(r),_=z.mulVec2(h,b.sub(this.m_localAnchorA,this.m_localCenterA)),l=z.mulVec2(c,b.sub(this.m_localAnchorB,this.m_localCenterB)),u=b.zero();u.addCombine(1,n,1,l),u.subCombine(1,e,1,_);var p=this.m_invMassA,d=this.m_invMassB,y=this.m_invIA,f=this.m_invIB;this.m_axis=z.mulVec2(h,this.m_localXAxisA),this.m_a1=b.crossVec2Vec2(b.add(u,_),this.m_axis),this.m_a2=b.crossVec2Vec2(l,this.m_axis),this.m_motorMass=p+d+y*this.m_a1*this.m_a1+f*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),this.m_perp=z.mulVec2(h,this.m_localYAxisA),this.m_s1=b.crossVec2Vec2(b.add(u,_),this.m_perp),this.m_s2=b.crossVec2Vec2(l,this.m_perp),b.crossVec2Vec2(_,this.m_perp);var v=p+d+y*this.m_s1*this.m_s1+f*this.m_s2*this.m_s2,x=y*this.m_s1+f*this.m_s2,A=y*this.m_s1*this.m_a1+f*this.m_s2*this.m_a2,w=y+f;0==w&&(w=1);var V=y*this.m_a1+f*this.m_a2,C=p+d+y*this.m_a1*this.m_a1+f*this.m_a2*this.m_a2;if(this.m_K.ex.set(v,x,A),this.m_K.ey.set(x,w,V),this.m_K.ez.set(A,V,C),this.m_enableLimit){var M=b.dot(this.m_axis,u);g.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*B.linearSlop?this.m_limitState=3:M<=this.m_lowerTranslation?1!=this.m_limitState&&(this.m_limitState=1,this.m_impulse.z=0):M>=this.m_upperTranslation?2!=this.m_limitState&&(this.m_limitState=2,this.m_impulse.z=0):(this.m_limitState=0,this.m_impulse.z=0)}else this.m_limitState=0,this.m_impulse.z=0;if(!1==this.m_enableMotor&&(this.m_motorImpulse=0),t.warmStarting){this.m_impulse.mul(t.dtRatio),this.m_motorImpulse*=t.dtRatio;var I=b.combine(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis),P=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,S=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;s.subMul(p,I),o-=y*P,a.addMul(d,I),m+=f*S}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.setVec2(s),this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v.setVec2(a),this.m_bodyB.c_velocity.w=m},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,a=this.m_invIA,m=this.m_invIB;if(this.m_enableMotor&&3!=this.m_limitState){var h=b.dot(this.m_axis,b.sub(s,e))+this.m_a2*o-this.m_a1*i,c=this.m_motorMass*(this.m_motorSpeed-h),_=this.m_motorImpulse,l=t.dt*this.m_maxMotorForce;this.m_motorImpulse=g.clamp(this.m_motorImpulse+c,-l,l),c=this.m_motorImpulse-_;var u=b.mulNumVec2(c,this.m_axis),p=c*this.m_a1,d=c*this.m_a2;e.subMul(n,u),i-=a*p,s.addMul(r,u),o+=m*d}var y=b.zero();if(y.x+=b.dot(this.m_perp,s)+this.m_s2*o,y.x-=b.dot(this.m_perp,e)+this.m_s1*i,y.y=o-i,this.m_enableLimit&&0!=this.m_limitState){f=0+(b.dot(this.m_axis,s)+this.m_a2*o)-(b.dot(this.m_axis,e)+this.m_a1*i);var f,h=new tw(y.x,y.y,f),v=tw.clone(this.m_impulse),x=this.m_K.solve33(tw.neg(h));this.m_impulse.add(x),1==this.m_limitState?this.m_impulse.z=g.max(this.m_impulse.z,0):2==this.m_limitState&&(this.m_impulse.z=g.min(this.m_impulse.z,0));var A=b.combine(-1,y,-(this.m_impulse.z-v.z),b.neo(this.m_K.ez.x,this.m_K.ez.y)),B=b.add(this.m_K.solve22(A),b.neo(v.x,v.y));this.m_impulse.x=B.x,this.m_impulse.y=B.y,x=tw.sub(this.m_impulse,v);var u=b.combine(x.x,this.m_perp,x.z,this.m_axis),p=x.x*this.m_s1+x.y+x.z*this.m_a1,d=x.x*this.m_s2+x.y+x.z*this.m_a2;e.subMul(n,u),i-=a*p,s.addMul(r,u),o+=m*d}else{var x=this.m_K.solve22(b.neg(y));this.m_impulse.x+=x.x,this.m_impulse.y+=x.y;var u=b.mulNumVec2(x.x,this.m_perp),p=x.x*this.m_s1+x.y,d=x.x*this.m_s2+x.y;e.subMul(n,u),i-=a*p,s.addMul(r,u),o+=m*d}this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o},e.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyB.c_position.c,o=this.m_bodyB.c_position.a,n=z.neo(i),r=z.neo(o),a=this.m_invMassA,m=this.m_invMassB,h=this.m_invIA,c=this.m_invIB,_=z.mulVec2(n,b.sub(this.m_localAnchorA,this.m_localCenterA)),l=z.mulVec2(r,b.sub(this.m_localAnchorB,this.m_localCenterB)),u=b.sub(b.add(s,l),b.add(e,_)),p=z.mulVec2(n,this.m_localXAxisA),d=b.crossVec2Vec2(b.add(u,_),p),y=b.crossVec2Vec2(l,p),f=z.mulVec2(n,this.m_localYAxisA),v=b.crossVec2Vec2(b.add(u,_),f),x=b.crossVec2Vec2(l,f),A=new tw,w=b.zero();w.x=b.dot(f,u),w.y=o-i-this.m_referenceAngle;var V=g.abs(w.x),C=g.abs(w.y),M=B.linearSlop,I=B.maxLinearCorrection,P=!1,S=0;if(this.m_enableLimit){var T=b.dot(p,u);g.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*M?(S=g.clamp(T,-I,I),V=g.max(V,g.abs(T)),P=!0):T<=this.m_lowerTranslation?(S=g.clamp(T-this.m_lowerTranslation+M,-I,0),V=g.max(V,this.m_lowerTranslation-T),P=!0):T>=this.m_upperTranslation&&(S=g.clamp(T-this.m_upperTranslation-M,0,I),V=g.max(V,T-this.m_upperTranslation),P=!0)}if(P){var L=a+m+h*v*v+c*x*x,F=h*v+c*x,k=h*v*d+c*x*y,q=h+c;0==q&&(q=1);var N=h*d+c*y,R=new tF;R.ex.set(L,F,k),R.ey.set(F,q,N),R.ez.set(k,N,a+m+h*d*d+c*y*y);var j=new tw;j.x=w.x,j.y=w.y,j.z=S,A=R.solve33(tw.neg(j))}else{var L=a+m+h*v*v+c*x*x,F=h*v+c*x,q=h+c;0==q&&(q=1);var R=new W;R.ex.setNum(L,F),R.ey.setNum(F,q);var D=R.solve(b.neg(w));A.x=D.x,A.y=D.y,A.z=0}var E=b.combine(A.x,f,A.z,p),O=A.x*v+A.y+A.z*d,Y=A.x*x+A.y+A.z*y;return e.subMul(a,E),i-=h*O,s.addMul(m,E),o+=c*Y,this.m_bodyA.c_position.c=e,this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c=s,this.m_bodyB.c_position.a=o,V<=B.linearSlop&&C<=B.angularSlop},e.TYPE="prismatic-joint",e}(tu),tj={ratio:1},tD=function(t){function e(i,s,o,n,r,a){var m,h,c=this;if(!(c instanceof e))return new e(i,s,o,n,r,a);i=v(i,tj),s=(c=t.call(this,i,s,o)||this).m_bodyA,o=c.m_bodyB,c.m_type=e.TYPE,c.m_joint1=n||i.joint1,c.m_joint2=r||i.joint2,c.m_ratio=g.isFinite(a)?a:i.ratio,c.m_type1=c.m_joint1.getType(),c.m_type2=c.m_joint2.getType(),c.m_bodyC=c.m_joint1.getBodyA(),c.m_bodyA=c.m_joint1.getBodyB();var _=c.m_bodyA.m_xf,l=c.m_bodyA.m_sweep.a,u=c.m_bodyC.m_xf,p=c.m_bodyC.m_sweep.a;if(c.m_type1===tq.TYPE){var d=c.m_joint1;c.m_localAnchorC=d.m_localAnchorA,c.m_localAnchorA=d.m_localAnchorB,c.m_referenceAngleA=d.m_referenceAngle,c.m_localAxisC=b.zero(),m=l-p-c.m_referenceAngleA}else{var y=c.m_joint1;c.m_localAnchorC=y.m_localAnchorA,c.m_localAnchorA=y.m_localAnchorB,c.m_referenceAngleA=y.m_referenceAngle,c.m_localAxisC=y.m_localXAxisA;var f=c.m_localAnchorC,x=z.mulTVec2(u.q,b.add(z.mulVec2(_.q,c.m_localAnchorA),b.sub(_.p,u.p)));m=b.dot(x,c.m_localAxisC)-b.dot(f,c.m_localAxisC)}c.m_bodyD=c.m_joint2.getBodyA(),c.m_bodyB=c.m_joint2.getBodyB();var A=c.m_bodyB.m_xf,B=c.m_bodyB.m_sweep.a,w=c.m_bodyD.m_xf,V=c.m_bodyD.m_sweep.a;if(c.m_type2===tq.TYPE){var d=c.m_joint2;c.m_localAnchorD=d.m_localAnchorA,c.m_localAnchorB=d.m_localAnchorB,c.m_referenceAngleB=d.m_referenceAngle,c.m_localAxisD=b.zero(),h=B-V-c.m_referenceAngleB}else{var y=c.m_joint2;c.m_localAnchorD=y.m_localAnchorA,c.m_localAnchorB=y.m_localAnchorB,c.m_referenceAngleB=y.m_referenceAngle,c.m_localAxisD=y.m_localXAxisA;var C=c.m_localAnchorD,M=z.mulTVec2(w.q,b.add(z.mulVec2(A.q,c.m_localAnchorB),b.sub(A.p,w.p)));h=b.dot(M,c.m_localAxisD)-b.dot(C,c.m_localAxisD)}return c.m_constant=m+c.m_ratio*h,c.m_impulse=0,c}return y(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,joint1:this.m_joint1,joint2:this.m_joint2,ratio:this.m_ratio}},e._deserialize=function(t,i,s){return(t=f({},t)).bodyA=s(Y,t.bodyA,i),t.bodyB=s(Y,t.bodyB,i),t.joint1=s(tu,t.joint1,i),t.joint2=s(tu,t.joint2,i),new e(t)},e.prototype.getJoint1=function(){return this.m_joint1},e.prototype.getJoint2=function(){return this.m_joint2},e.prototype.setRatio=function(t){this.m_ratio=t},e.prototype.getRatio=function(){return this.m_ratio},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return b.mulNumVec2(this.m_impulse,this.m_JvAC).mul(t)},e.prototype.getReactionTorque=function(t){return this.m_impulse*this.m_JwA*t},e.prototype.initVelocityConstraints=function(t){this.m_lcA=this.m_bodyA.m_sweep.localCenter,this.m_lcB=this.m_bodyB.m_sweep.localCenter,this.m_lcC=this.m_bodyC.m_sweep.localCenter,this.m_lcD=this.m_bodyD.m_sweep.localCenter,this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,a=this.m_bodyC.c_position.a,m=this.m_bodyC.c_velocity.v,h=this.m_bodyC.c_velocity.w,c=this.m_bodyD.c_position.a,_=this.m_bodyD.c_velocity.v,l=this.m_bodyD.c_velocity.w,u=z.neo(e),p=z.neo(o),d=z.neo(a),y=z.neo(c);if(this.m_mass=0,this.m_type1==tq.TYPE)this.m_JvAC=b.zero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var f=z.mulVec2(d,this.m_localAxisC),v=z.mulSub(d,this.m_localAnchorC,this.m_lcC),x=z.mulSub(u,this.m_localAnchorA,this.m_lcA);this.m_JvAC=f,this.m_JwC=b.crossVec2Vec2(v,f),this.m_JwA=b.crossVec2Vec2(x,f),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_type2==tq.TYPE)this.m_JvBD=b.zero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{var f=z.mulVec2(y,this.m_localAxisD),g=z.mulSub(y,this.m_localAnchorD,this.m_lcD),A=z.mulSub(p,this.m_localAnchorB,this.m_lcB);this.m_JvBD=b.mulNumVec2(this.m_ratio,f),this.m_JwD=this.m_ratio*b.crossVec2Vec2(g,f),this.m_JwB=this.m_ratio*b.crossVec2Vec2(A,f),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,t.warmStarting?(i.addMul(this.m_mA*this.m_impulse,this.m_JvAC),s+=this.m_iA*this.m_impulse*this.m_JwA,n.addMul(this.m_mB*this.m_impulse,this.m_JvBD),r+=this.m_iB*this.m_impulse*this.m_JwB,m.subMul(this.m_mC*this.m_impulse,this.m_JvAC),h-=this.m_iC*this.m_impulse*this.m_JwC,_.subMul(this.m_mD*this.m_impulse,this.m_JvBD),l-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,this.m_bodyA.c_velocity.v.setVec2(i),this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v.setVec2(n),this.m_bodyB.c_velocity.w=r,this.m_bodyC.c_velocity.v.setVec2(m),this.m_bodyC.c_velocity.w=h,this.m_bodyD.c_velocity.v.setVec2(_),this.m_bodyD.c_velocity.w=l},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=this.m_bodyC.c_velocity.v,r=this.m_bodyC.c_velocity.w,a=this.m_bodyD.c_velocity.v,m=this.m_bodyD.c_velocity.w,h=b.dot(this.m_JvAC,e)-b.dot(this.m_JvAC,n)+b.dot(this.m_JvBD,s)-b.dot(this.m_JvBD,a);h+=this.m_JwA*i-this.m_JwC*r+(this.m_JwB*o-this.m_JwD*m);var c=-this.m_mass*h;this.m_impulse+=c,e.addMul(this.m_mA*c,this.m_JvAC),i+=this.m_iA*c*this.m_JwA,s.addMul(this.m_mB*c,this.m_JvBD),o+=this.m_iB*c*this.m_JwB,n.subMul(this.m_mC*c,this.m_JvAC),r-=this.m_iC*c*this.m_JwC,a.subMul(this.m_mD*c,this.m_JvBD),m-=this.m_iD*c*this.m_JwD,this.m_bodyA.c_velocity.v.setVec2(e),this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v.setVec2(s),this.m_bodyB.c_velocity.w=o,this.m_bodyC.c_velocity.v.setVec2(n),this.m_bodyC.c_velocity.w=r,this.m_bodyD.c_velocity.v.setVec2(a),this.m_bodyD.c_velocity.w=m},e.prototype.solvePositionConstraints=function(t){var e,i,s,o,n,r,a,m,h=this.m_bodyA.c_position.c,c=this.m_bodyA.c_position.a,_=this.m_bodyB.c_position.c,l=this.m_bodyB.c_position.a,u=this.m_bodyC.c_position.c,p=this.m_bodyC.c_position.a,d=this.m_bodyD.c_position.c,y=this.m_bodyD.c_position.a,f=z.neo(c),v=z.neo(l),x=z.neo(p),g=z.neo(y),A=0;if(this.m_type1==tq.TYPE)s=b.zero(),n=1,a=1,A+=this.m_iA+this.m_iC,e=c-p-this.m_referenceAngleA;else{var w=z.mulVec2(x,this.m_localAxisC),V=z.mulSub(x,this.m_localAnchorC,this.m_lcC),C=z.mulSub(f,this.m_localAnchorA,this.m_lcA);s=w,a=b.crossVec2Vec2(V,w),n=b.crossVec2Vec2(C,w),A+=this.m_mC+this.m_mA+this.m_iC*a*a+this.m_iA*n*n;var M=b.sub(this.m_localAnchorC,this.m_lcC),I=z.mulTVec2(x,b.add(C,b.sub(h,u)));e=b.dot(b.sub(I,M),this.m_localAxisC)}if(this.m_type2==tq.TYPE)o=b.zero(),r=this.m_ratio,m=this.m_ratio,A+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),i=l-y-this.m_referenceAngleB;else{var w=z.mulVec2(g,this.m_localAxisD),P=z.mulSub(g,this.m_localAnchorD,this.m_lcD),S=z.mulSub(v,this.m_localAnchorB,this.m_lcB);o=b.mulNumVec2(this.m_ratio,w),m=this.m_ratio*b.crossVec2Vec2(P,w),r=this.m_ratio*b.crossVec2Vec2(S,w),A+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*m*m+this.m_iB*r*r;var T=b.sub(this.m_localAnchorD,this.m_lcD),L=z.mulTVec2(g,b.add(S,b.sub(_,d)));i=b.dot(L,this.m_localAxisD)-b.dot(T,this.m_localAxisD)}var F=e+this.m_ratio*i-this.m_constant,k=0;return A>0&&(k=-F/A),h.addMul(this.m_mA*k,s),c+=this.m_iA*k*n,_.addMul(this.m_mB*k,o),l+=this.m_iB*k*r,u.subMul(this.m_mC*k,s),p-=this.m_iC*k*a,d.subMul(this.m_mD*k,o),y-=this.m_iD*k*m,this.m_bodyA.c_position.c.setVec2(h),this.m_bodyA.c_position.a=c,this.m_bodyB.c_position.c.setVec2(_),this.m_bodyB.c_position.a=l,this.m_bodyC.c_position.c.setVec2(u),this.m_bodyC.c_position.a=p,this.m_bodyD.c_position.c.setVec2(d),this.m_bodyD.c_position.a=y,0<B.linearSlop},e.TYPE="gear-joint",e}(tu),tE={maxForce:1,maxTorque:1,correctionFactor:.3},tO=function(t){function e(i,s,o){var n=this;return n instanceof e?(i=v(i,tE),s=(n=t.call(this,i,s,o)||this).m_bodyA,o=n.m_bodyB,n.m_type=e.TYPE,n.m_linearOffset=g.isFinite(i.linearOffset)?i.linearOffset:s.getLocalPoint(o.getPosition()),n.m_angularOffset=g.isFinite(i.angularOffset)?i.angularOffset:o.getAngle()-s.getAngle(),n.m_linearImpulse=b.zero(),n.m_angularImpulse=0,n.m_maxForce=i.maxForce,n.m_maxTorque=i.maxTorque,n.m_correctionFactor=i.correctionFactor,n):new e(i,s,o)}return y(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,maxForce:this.m_maxForce,maxTorque:this.m_maxTorque,correctionFactor:this.m_correctionFactor,linearOffset:this.m_linearOffset,angularOffset:this.m_angularOffset}},e._deserialize=function(t,i,s){return(t=f({},t)).bodyA=s(Y,t.bodyA,i),t.bodyB=s(Y,t.bodyB,i),new e(t)},e.prototype._setAnchors=function(t){},e.prototype.setMaxForce=function(t){this.m_maxForce=t},e.prototype.getMaxForce=function(){return this.m_maxForce},e.prototype.setMaxTorque=function(t){this.m_maxTorque=t},e.prototype.getMaxTorque=function(){return this.m_maxTorque},e.prototype.setCorrectionFactor=function(t){this.m_correctionFactor=t},e.prototype.getCorrectionFactor=function(){return this.m_correctionFactor},e.prototype.setLinearOffset=function(t){(t.x!=this.m_linearOffset.x||t.y!=this.m_linearOffset.y)&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_linearOffset=t)},e.prototype.getLinearOffset=function(){return this.m_linearOffset},e.prototype.setAngularOffset=function(t){t!=this.m_angularOffset&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_angularOffset=t)},e.prototype.getAngularOffset=function(){return this.m_angularOffset},e.prototype.getAnchorA=function(){return this.m_bodyA.getPosition()},e.prototype.getAnchorB=function(){return this.m_bodyB.getPosition()},e.prototype.getReactionForce=function(t){return b.mulNumVec2(t,this.m_linearImpulse)},e.prototype.getReactionTorque=function(t){return t*this.m_angularImpulse},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,a=this.m_bodyB.c_velocity.v,m=this.m_bodyB.c_velocity.w,h=z.neo(i),c=z.neo(r);this.m_rA=z.mulVec2(h,b.neg(this.m_localCenterA)),this.m_rB=z.mulVec2(c,b.neg(this.m_localCenterB));var _=this.m_invMassA,l=this.m_invMassB,u=this.m_invIA,p=this.m_invIB,d=new W;if(d.ex.x=_+l+u*this.m_rA.y*this.m_rA.y+p*this.m_rB.y*this.m_rB.y,d.ex.y=-u*this.m_rA.x*this.m_rA.y-p*this.m_rB.x*this.m_rB.y,d.ey.x=d.ex.y,d.ey.y=_+l+u*this.m_rA.x*this.m_rA.x+p*this.m_rB.x*this.m_rB.x,this.m_linearMass=d.getInverse(),this.m_angularMass=u+p,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),this.m_linearError=b.zero(),this.m_linearError.addCombine(1,n,1,this.m_rB),this.m_linearError.subCombine(1,e,1,this.m_rA),this.m_linearError.sub(z.mulVec2(h,this.m_linearOffset)),this.m_angularError=r-i-this.m_angularOffset,t.warmStarting){this.m_linearImpulse.mul(t.dtRatio),this.m_angularImpulse*=t.dtRatio;var y=b.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);s.subMul(_,y),o-=u*(b.crossVec2Vec2(this.m_rA,y)+this.m_angularImpulse),a.addMul(l,y),m+=p*(b.crossVec2Vec2(this.m_rB,y)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=s,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=a,this.m_bodyB.c_velocity.w=m},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,a=this.m_invIA,m=this.m_invIB,h=t.dt,c=t.inv_dt,_=o-i+c*this.m_correctionFactor*this.m_angularError,l=-this.m_angularMass*_,u=this.m_angularImpulse,p=h*this.m_maxTorque;this.m_angularImpulse=g.clamp(this.m_angularImpulse+l,-p,p),i-=a*(l=this.m_angularImpulse-u),o+=m*l;var _=b.zero();_.addCombine(1,s,1,b.crossNumVec2(o,this.m_rB)),_.subCombine(1,e,1,b.crossNumVec2(i,this.m_rA)),_.addMul(c*this.m_correctionFactor,this.m_linearError);var l=b.neg(W.mulVec2(this.m_linearMass,_)),u=b.clone(this.m_linearImpulse);this.m_linearImpulse.add(l);var p=h*this.m_maxForce;this.m_linearImpulse.clamp(p),l=b.sub(this.m_linearImpulse,u),e.subMul(n,l),i-=a*b.crossVec2Vec2(this.m_rA,l),s.addMul(r,l),o+=m*b.crossVec2Vec2(this.m_rB,l),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o},e.prototype.solvePositionConstraints=function(t){return!0},e.TYPE="motor-joint",e}(tu),tY={maxForce:0,frequencyHz:5,dampingRatio:.7},tW=function(t){function e(i,s,o,n){var r=this;return r instanceof e?(i=v(i,tY),s=(r=t.call(this,i,s,o)||this).m_bodyA,o=r.m_bodyB,r.m_type=e.TYPE,r.m_targetA=n?b.clone(n):i.target||b.zero(),r.m_localAnchorB=P.mulTVec2(o.getTransform(),r.m_targetA),r.m_maxForce=i.maxForce,r.m_impulse=b.zero(),r.m_frequencyHz=i.frequencyHz,r.m_dampingRatio=i.dampingRatio,r.m_beta=0,r.m_gamma=0,r.m_rB=b.zero(),r.m_localCenterB=b.zero(),r.m_invMassB=0,r.m_invIB=0,r.m_mass=new W,r.m_C=b.zero(),r):new e(i,s,o,n)}return y(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,target:this.m_targetA,maxForce:this.m_maxForce,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,_localAnchorB:this.m_localAnchorB}},e._deserialize=function(t,i,s){(t=f({},t)).bodyA=s(Y,t.bodyA,i),t.bodyB=s(Y,t.bodyB,i),t.target=b.clone(t.target);var o=new e(t);return t._localAnchorB&&(o.m_localAnchorB=t._localAnchorB),o},e.prototype.setTarget=function(t){!1==this.m_bodyB.isAwake()&&this.m_bodyB.setAwake(!0),this.m_targetA=b.clone(t)},e.prototype.getTarget=function(){return this.m_targetA},e.prototype.setMaxForce=function(t){this.m_maxForce=t},e.prototype.getMaxForce=function(){return this.m_maxForce},e.prototype.setFrequency=function(t){this.m_frequencyHz=t},e.prototype.getFrequency=function(){return this.m_frequencyHz},e.prototype.setDampingRatio=function(t){this.m_dampingRatio=t},e.prototype.getDampingRatio=function(){return this.m_dampingRatio},e.prototype.getAnchorA=function(){return b.clone(this.m_targetA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return b.mulNumVec2(t,this.m_impulse)},e.prototype.getReactionTorque=function(t){return 0*t},e.prototype.shiftOrigin=function(t){this.m_targetA.sub(t)},e.prototype.initVelocityConstraints=function(t){this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyB.c_position,i=this.m_bodyB.c_velocity,s=e.c,o=e.a,n=i.v,r=i.w,a=z.neo(o),m=this.m_bodyB.getMass(),h=2*g.PI*this.m_frequencyHz,c=2*m*this.m_dampingRatio*h,_=h*h*m,l=t.dt;this.m_gamma=l*(c+l*_),0!=this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=l*_*this.m_gamma,this.m_rB=z.mulVec2(a,b.sub(this.m_localAnchorB,this.m_localCenterB));var u=new W;u.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,u.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,u.ey.x=u.ex.y,u.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,this.m_mass=u.getInverse(),this.m_C.setVec2(s),this.m_C.addCombine(1,this.m_rB,-1,this.m_targetA),this.m_C.mul(this.m_beta),r*=.98,t.warmStarting?(this.m_impulse.mul(t.dtRatio),n.addMul(this.m_invMassB,this.m_impulse),r+=this.m_invIB*b.crossVec2Vec2(this.m_rB,this.m_impulse)):this.m_impulse.setZero(),i.v.setVec2(n),i.w=r},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyB.c_velocity,i=b.clone(e.v),s=e.w,o=b.crossNumVec2(s,this.m_rB);o.add(i),o.addCombine(1,this.m_C,this.m_gamma,this.m_impulse),o.neg();var n=W.mulVec2(this.m_mass,o),r=b.clone(this.m_impulse);this.m_impulse.add(n);var a=t.dt*this.m_maxForce;this.m_impulse.clamp(a),n=b.sub(this.m_impulse,r),i.addMul(this.m_invMassB,n),s+=this.m_invIB*b.crossVec2Vec2(this.m_rB,n),e.v.setVec2(i),e.w=s},e.prototype.solvePositionConstraints=function(t){return!0},e.TYPE="mouse-joint",e}(tu),tJ={collideConnected:!0},tH=function(t){function e(i,s,o,n,r,a,m,h){var c=this;return c instanceof e?(i=v(i,tJ),s=(c=t.call(this,i,s,o)||this).m_bodyA,o=c.m_bodyB,c.m_type=e.TYPE,c.m_groundAnchorA=n||i.groundAnchorA||b.neo(-1,1),c.m_groundAnchorB=r||i.groundAnchorB||b.neo(1,1),c.m_localAnchorA=a?s.getLocalPoint(a):i.localAnchorA||b.neo(-1,0),c.m_localAnchorB=m?o.getLocalPoint(m):i.localAnchorB||b.neo(1,0),c.m_lengthA=g.isFinite(i.lengthA)?i.lengthA:b.distance(a,n),c.m_lengthB=g.isFinite(i.lengthB)?i.lengthB:b.distance(m,r),c.m_ratio=g.isFinite(h)?h:i.ratio,c.m_constant=c.m_lengthA+c.m_ratio*c.m_lengthB,c.m_impulse=0,c):new e(i,s,o,n,r,a,m,h)}return y(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,groundAnchorA:this.m_groundAnchorA,groundAnchorB:this.m_groundAnchorB,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,lengthA:this.m_lengthA,lengthB:this.m_lengthB,ratio:this.m_ratio}},e._deserialize=function(t,i,s){return(t=f({},t)).bodyA=s(Y,t.bodyA,i),t.bodyB=s(Y,t.bodyB,i),new e(t)},e.prototype.getGroundAnchorA=function(){return this.m_groundAnchorA},e.prototype.getGroundAnchorB=function(){return this.m_groundAnchorB},e.prototype.getLengthA=function(){return this.m_lengthA},e.prototype.getLengthB=function(){return this.m_lengthB},e.prototype.getRatio=function(){return this.m_ratio},e.prototype.getCurrentLengthA=function(){var t=this.m_bodyA.getWorldPoint(this.m_localAnchorA),e=this.m_groundAnchorA;return b.distance(t,e)},e.prototype.getCurrentLengthB=function(){var t=this.m_bodyB.getWorldPoint(this.m_localAnchorB),e=this.m_groundAnchorB;return b.distance(t,e)},e.prototype.shiftOrigin=function(t){this.m_groundAnchorA.sub(t),this.m_groundAnchorB.sub(t)},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return b.mulNumVec2(this.m_impulse,this.m_uB).mul(t)},e.prototype.getReactionTorque=function(t){return 0},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,a=this.m_bodyB.c_velocity.v,m=this.m_bodyB.c_velocity.w,h=z.neo(i),c=z.neo(r);this.m_rA=z.mulVec2(h,b.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=z.mulVec2(c,b.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_uA=b.sub(b.add(e,this.m_rA),this.m_groundAnchorA),this.m_uB=b.sub(b.add(n,this.m_rB),this.m_groundAnchorB);var _=this.m_uA.length(),l=this.m_uB.length();_>10*B.linearSlop?this.m_uA.mul(1/_):this.m_uA.setZero(),l>10*B.linearSlop?this.m_uB.mul(1/l):this.m_uB.setZero();var u=b.crossVec2Vec2(this.m_rA,this.m_uA),p=b.crossVec2Vec2(this.m_rB,this.m_uB),d=this.m_invMassA+this.m_invIA*u*u,y=this.m_invMassB+this.m_invIB*p*p;if(this.m_mass=d+this.m_ratio*this.m_ratio*y,this.m_mass>0&&(this.m_mass=1/this.m_mass),t.warmStarting){this.m_impulse*=t.dtRatio;var f=b.mulNumVec2(-this.m_impulse,this.m_uA),v=b.mulNumVec2(-this.m_ratio*this.m_impulse,this.m_uB);s.addMul(this.m_invMassA,f),o+=this.m_invIA*b.crossVec2Vec2(this.m_rA,f),a.addMul(this.m_invMassB,v),m+=this.m_invIB*b.crossVec2Vec2(this.m_rB,v)}else this.m_impulse=0;this.m_bodyA.c_velocity.v=s,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=a,this.m_bodyB.c_velocity.w=m},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=b.add(e,b.crossNumVec2(i,this.m_rA)),r=b.add(s,b.crossNumVec2(o,this.m_rB)),a=-b.dot(this.m_uA,n)-this.m_ratio*b.dot(this.m_uB,r),m=-this.m_mass*a;this.m_impulse+=m;var h=b.mulNumVec2(-m,this.m_uA),c=b.mulNumVec2(-this.m_ratio*m,this.m_uB);e.addMul(this.m_invMassA,h),i+=this.m_invIA*b.crossVec2Vec2(this.m_rA,h),s.addMul(this.m_invMassB,c),o+=this.m_invIB*b.crossVec2Vec2(this.m_rB,c),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o},e.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyB.c_position.c,o=this.m_bodyB.c_position.a,n=z.neo(i),r=z.neo(o),a=z.mulVec2(n,b.sub(this.m_localAnchorA,this.m_localCenterA)),m=z.mulVec2(r,b.sub(this.m_localAnchorB,this.m_localCenterB)),h=b.sub(b.add(e,this.m_rA),this.m_groundAnchorA),c=b.sub(b.add(s,this.m_rB),this.m_groundAnchorB),_=h.length(),l=c.length();_>10*B.linearSlop?h.mul(1/_):h.setZero(),l>10*B.linearSlop?c.mul(1/l):c.setZero();var u=b.crossVec2Vec2(a,h),p=b.crossVec2Vec2(m,c),d=this.m_invMassA+this.m_invIA*u*u,y=this.m_invMassB+this.m_invIB*p*p,f=d+this.m_ratio*this.m_ratio*y;f>0&&(f=1/f);var v=this.m_constant-_-this.m_ratio*l,x=g.abs(v),A=-f*v,w=b.mulNumVec2(-A,h),V=b.mulNumVec2(-this.m_ratio*A,c);return e.addMul(this.m_invMassA,w),i+=this.m_invIA*b.crossVec2Vec2(a,w),s.addMul(this.m_invMassB,V),o+=this.m_invIB*b.crossVec2Vec2(m,V),this.m_bodyA.c_position.c=e,this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c=s,this.m_bodyB.c_position.a=o,x<B.linearSlop},e.TYPE="pulley-joint",e}(tu),tZ={maxLength:0},tX=function(t){function e(i,s,o,n){var r=this;return r instanceof e?(i=v(i,tZ),s=(r=t.call(this,i,s,o)||this).m_bodyA,o=r.m_bodyB,r.m_type=e.TYPE,r.m_localAnchorA=n?s.getLocalPoint(n):i.localAnchorA||b.neo(-1,0),r.m_localAnchorB=n?o.getLocalPoint(n):i.localAnchorB||b.neo(1,0),r.m_maxLength=i.maxLength,r.m_mass=0,r.m_impulse=0,r.m_length=0,r.m_state=0,r):new e(i,s,o,n)}return y(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,maxLength:this.m_maxLength}},e._deserialize=function(t,i,s){return(t=f({},t)).bodyA=s(Y,t.bodyA,i),t.bodyB=s(Y,t.bodyB,i),new e(t)},e.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.setMaxLength=function(t){this.m_maxLength=t},e.prototype.getMaxLength=function(){return this.m_maxLength},e.prototype.getLimitState=function(){return this.m_state},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return b.mulNumVec2(this.m_impulse,this.m_u).mul(t)},e.prototype.getReactionTorque=function(t){return 0},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v,o=this.m_bodyA.c_velocity.w,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,a=this.m_bodyB.c_velocity.v,m=this.m_bodyB.c_velocity.w,h=z.neo(i),c=z.neo(r);if(this.m_rA=z.mulSub(h,this.m_localAnchorA,this.m_localCenterA),this.m_rB=z.mulSub(c,this.m_localAnchorB,this.m_localCenterB),this.m_u=b.zero(),this.m_u.addCombine(1,n,1,this.m_rB),this.m_u.subCombine(1,e,1,this.m_rA),this.m_length=this.m_u.length(),this.m_length-this.m_maxLength>0?this.m_state=2:this.m_state=0,this.m_length>B.linearSlop)this.m_u.mul(1/this.m_length);else{this.m_u.setZero(),this.m_mass=0,this.m_impulse=0;return}var _=b.crossVec2Vec2(this.m_rA,this.m_u),l=b.crossVec2Vec2(this.m_rB,this.m_u),u=this.m_invMassA+this.m_invIA*_*_+this.m_invMassB+this.m_invIB*l*l;if(this.m_mass=0!=u?1/u:0,t.warmStarting){this.m_impulse*=t.dtRatio;var p=b.mulNumVec2(this.m_impulse,this.m_u);s.subMul(this.m_invMassA,p),o-=this.m_invIA*b.crossVec2Vec2(this.m_rA,p),a.addMul(this.m_invMassB,p),m+=this.m_invIB*b.crossVec2Vec2(this.m_rB,p)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.setVec2(s),this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v.setVec2(a),this.m_bodyB.c_velocity.w=m},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=b.addCrossNumVec2(e,i,this.m_rA),r=b.addCrossNumVec2(s,o,this.m_rB),a=this.m_length-this.m_maxLength,m=b.dot(this.m_u,b.sub(r,n));a<0&&(m+=t.inv_dt*a);var h=-this.m_mass*m,c=this.m_impulse;this.m_impulse=g.min(0,this.m_impulse+h),h=this.m_impulse-c;var _=b.mulNumVec2(h,this.m_u);e.subMul(this.m_invMassA,_),i-=this.m_invIA*b.crossVec2Vec2(this.m_rA,_),s.addMul(this.m_invMassB,_),o+=this.m_invIB*b.crossVec2Vec2(this.m_rB,_),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o},e.prototype.solvePositionConstraints=function(t){var e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyB.c_position.c,o=this.m_bodyB.c_position.a,n=z.neo(i),r=z.neo(o),a=z.mulSub(n,this.m_localAnchorA,this.m_localCenterA),m=z.mulSub(r,this.m_localAnchorB,this.m_localCenterB),h=b.zero();h.addCombine(1,s,1,m),h.subCombine(1,e,1,a);var c=h.normalize(),_=c-this.m_maxLength;_=g.clamp(_,0,B.maxLinearCorrection);var l=-this.m_mass*_,u=b.mulNumVec2(l,h);return e.subMul(this.m_invMassA,u),i-=this.m_invIA*b.crossVec2Vec2(a,u),s.addMul(this.m_invMassB,u),o+=this.m_invIB*b.crossVec2Vec2(m,u),this.m_bodyA.c_position.c.setVec2(e),this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c.setVec2(s),this.m_bodyB.c_position.a=o,c-this.m_maxLength<B.linearSlop},e.TYPE="rope-joint",e}(tu),tU={frequencyHz:0,dampingRatio:0},tK=function(t){function e(i,s,o,n){var r=this;return r instanceof e?(i=v(i,tU),s=(r=t.call(this,i,s,o)||this).m_bodyA,o=r.m_bodyB,r.m_type=e.TYPE,r.m_localAnchorA=b.clone(n?s.getLocalPoint(n):i.localAnchorA||b.zero()),r.m_localAnchorB=b.clone(n?o.getLocalPoint(n):i.localAnchorB||b.zero()),r.m_referenceAngle=g.isFinite(i.referenceAngle)?i.referenceAngle:o.getAngle()-s.getAngle(),r.m_frequencyHz=i.frequencyHz,r.m_dampingRatio=i.dampingRatio,r.m_impulse=new tw,r.m_bias=0,r.m_gamma=0,r.m_rA,r.m_rB,r.m_localCenterA,r.m_localCenterB,r.m_invMassA,r.m_invMassB,r.m_invIA,r.m_invIB,r.m_mass=new tF,r):new e(i,s,o,n)}return y(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,referenceAngle:this.m_referenceAngle}},e._deserialize=function(t,i,s){return(t=f({},t)).bodyA=s(Y,t.bodyA,i),t.bodyB=s(Y,t.bodyB,i),new e(t)},e.prototype._setAnchors=function(t){t.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.setVec2(t.localAnchorA),t.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.setVec2(t.localAnchorB)},e.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.getReferenceAngle=function(){return this.m_referenceAngle},e.prototype.setFrequency=function(t){this.m_frequencyHz=t},e.prototype.getFrequency=function(){return this.m_frequencyHz},e.prototype.setDampingRatio=function(t){this.m_dampingRatio=t},e.prototype.getDampingRatio=function(){return this.m_dampingRatio},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return b.neo(this.m_impulse.x,this.m_impulse.y).mul(t)},e.prototype.getReactionTorque=function(t){return t*this.m_impulse.z},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v,s=this.m_bodyA.c_velocity.w,o=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v,r=this.m_bodyB.c_velocity.w,a=z.neo(e),m=z.neo(o);this.m_rA=z.mulVec2(a,b.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=z.mulVec2(m,b.sub(this.m_localAnchorB,this.m_localCenterB));var h=this.m_invMassA,c=this.m_invMassB,_=this.m_invIA,l=this.m_invIB,u=new tF;if(u.ex.x=h+c+this.m_rA.y*this.m_rA.y*_+this.m_rB.y*this.m_rB.y*l,u.ey.x=-this.m_rA.y*this.m_rA.x*_-this.m_rB.y*this.m_rB.x*l,u.ez.x=-this.m_rA.y*_-this.m_rB.y*l,u.ex.y=u.ey.x,u.ey.y=h+c+this.m_rA.x*this.m_rA.x*_+this.m_rB.x*this.m_rB.x*l,u.ez.y=this.m_rA.x*_+this.m_rB.x*l,u.ex.z=u.ez.x,u.ey.z=u.ez.y,u.ez.z=_+l,this.m_frequencyHz>0){u.getInverse22(this.m_mass);var p=_+l,d=p>0?1/p:0,y=o-e-this.m_referenceAngle,f=2*g.PI*this.m_frequencyHz,v=2*d*this.m_dampingRatio*f,x=d*f*f,A=t.dt;this.m_gamma=A*(v+A*x),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=y*A*x*this.m_gamma,p+=this.m_gamma,this.m_mass.ez.z=0!=p?1/p:0}else 0==u.ez.z?u.getInverse22(this.m_mass):u.getSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0;if(t.warmStarting){this.m_impulse.mul(t.dtRatio);var B=b.neo(this.m_impulse.x,this.m_impulse.y);i.subMul(h,B),s-=_*(b.crossVec2Vec2(this.m_rA,B)+this.m_impulse.z),n.addMul(c,B),r+=l*(b.crossVec2Vec2(this.m_rB,B)+this.m_impulse.z)}else this.m_impulse.setZero();this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=r},e.prototype.solveVelocityConstraints=function(t){var e=this.m_bodyA.c_velocity.v,i=this.m_bodyA.c_velocity.w,s=this.m_bodyB.c_velocity.v,o=this.m_bodyB.c_velocity.w,n=this.m_invMassA,r=this.m_invMassB,a=this.m_invIA,m=this.m_invIB;if(this.m_frequencyHz>0){var h=o-i,c=-this.m_mass.ez.z*(h+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=c,i-=a*c,o+=m*c;var _=b.zero();_.addCombine(1,s,1,b.crossNumVec2(o,this.m_rB)),_.subCombine(1,e,1,b.crossNumVec2(i,this.m_rA));var l=b.neg(tF.mulVec2(this.m_mass,_));this.m_impulse.x+=l.x,this.m_impulse.y+=l.y;var u=b.clone(l);e.subMul(n,u),i-=a*b.crossVec2Vec2(this.m_rA,u),s.addMul(r,u),o+=m*b.crossVec2Vec2(this.m_rB,u)}else{var _=b.zero();_.addCombine(1,s,1,b.crossNumVec2(o,this.m_rB)),_.subCombine(1,e,1,b.crossNumVec2(i,this.m_rA));var h=o-i,p=new tw(_.x,_.y,h),d=tw.neg(tF.mulVec3(this.m_mass,p));this.m_impulse.add(d);var u=b.neo(d.x,d.y);e.subMul(n,u),i-=a*(b.crossVec2Vec2(this.m_rA,u)+d.z),s.addMul(r,u),o+=m*(b.crossVec2Vec2(this.m_rB,u)+d.z)}this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o},e.prototype.solvePositionConstraints=function(t){var e,i,s=this.m_bodyA.c_position.c,o=this.m_bodyA.c_position.a,n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,a=z.neo(o),m=z.neo(r),h=this.m_invMassA,c=this.m_invMassB,_=this.m_invIA,l=this.m_invIB,u=z.mulVec2(a,b.sub(this.m_localAnchorA,this.m_localCenterA)),p=z.mulVec2(m,b.sub(this.m_localAnchorB,this.m_localCenterB)),d=new tF;if(d.ex.x=h+c+u.y*u.y*_+p.y*p.y*l,d.ey.x=-u.y*u.x*_-p.y*p.x*l,d.ez.x=-u.y*_-p.y*l,d.ex.y=d.ey.x,d.ey.y=h+c+u.x*u.x*_+p.x*p.x*l,d.ez.y=u.x*_+p.x*l,d.ex.z=d.ez.x,d.ey.z=d.ez.y,d.ez.z=_+l,this.m_frequencyHz>0){var y=b.zero();y.addCombine(1,n,1,p),y.subCombine(1,s,1,u),e=y.length(),i=0;var f=b.neg(d.solve22(y));s.subMul(h,f),o-=_*b.crossVec2Vec2(u,f),n.addMul(c,f),r+=l*b.crossVec2Vec2(p,f)}else{var y=b.zero();y.addCombine(1,n,1,p),y.subCombine(1,s,1,u);var v=r-o-this.m_referenceAngle;e=y.length(),i=g.abs(v);var x=new tw(y.x,y.y,v),A=new tw;if(d.ez.z>0)A=tw.neg(d.solve33(x));else{var w=b.neg(d.solve22(y));A.set(w.x,w.y,0)}var f=b.neo(A.x,A.y);s.subMul(h,f),o-=_*(b.crossVec2Vec2(u,f)+A.z),n.addMul(c,f),r+=l*(b.crossVec2Vec2(p,f)+A.z)}return this.m_bodyA.c_position.c=s,this.m_bodyA.c_position.a=o,this.m_bodyB.c_position.c=n,this.m_bodyB.c_position.a=r,e<=B.linearSlop&&i<=B.angularSlop},e.TYPE="weld-joint",e}(tu),tG={enableMotor:!1,maxMotorTorque:0,motorSpeed:0,frequencyHz:2,dampingRatio:.7},t$=function(t){function e(i,s,o,n,r){var a=this;return a instanceof e?(i=v(i,tG),(a=t.call(this,i,s,o)||this).m_ax=b.zero(),a.m_ay=b.zero(),s=a.m_bodyA,o=a.m_bodyB,a.m_type=e.TYPE,a.m_localAnchorA=b.clone(n?s.getLocalPoint(n):i.localAnchorA||b.zero()),a.m_localAnchorB=b.clone(n?o.getLocalPoint(n):i.localAnchorB||b.zero()),a.m_localXAxisA=b.clone(r?s.getLocalVector(r):i.localAxisA||i.localAxis||b.neo(1,0)),a.m_localYAxisA=b.crossNumVec2(1,a.m_localXAxisA),a.m_mass=0,a.m_impulse=0,a.m_motorMass=0,a.m_motorImpulse=0,a.m_springMass=0,a.m_springImpulse=0,a.m_maxMotorTorque=i.maxMotorTorque,a.m_motorSpeed=i.motorSpeed,a.m_enableMotor=i.enableMotor,a.m_frequencyHz=i.frequencyHz,a.m_dampingRatio=i.dampingRatio,a.m_bias=0,a.m_gamma=0,a):new e(i,s,o,n,r)}return y(e,t),e.prototype._serialize=function(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,enableMotor:this.m_enableMotor,maxMotorTorque:this.m_maxMotorTorque,motorSpeed:this.m_motorSpeed,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,localAxisA:this.m_localXAxisA}},e._deserialize=function(t,i,s){return(t=f({},t)).bodyA=s(Y,t.bodyA,i),t.bodyB=s(Y,t.bodyB,i),new e(t)},e.prototype._setAnchors=function(t){t.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.setVec2(t.localAnchorA),t.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.setVec2(t.localAnchorB),t.localAxisA&&(this.m_localXAxisA.setVec2(t.localAxisA),this.m_localYAxisA.setVec2(b.crossNumVec2(1,t.localAxisA)))},e.prototype.getLocalAnchorA=function(){return this.m_localAnchorA},e.prototype.getLocalAnchorB=function(){return this.m_localAnchorB},e.prototype.getLocalAxisA=function(){return this.m_localXAxisA},e.prototype.getJointTranslation=function(){var t=this.m_bodyA,e=this.m_bodyB,i=t.getWorldPoint(this.m_localAnchorA),s=e.getWorldPoint(this.m_localAnchorB),o=b.sub(s,i),n=t.getWorldVector(this.m_localXAxisA);return b.dot(o,n)},e.prototype.getJointSpeed=function(){var t=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-t},e.prototype.isMotorEnabled=function(){return this.m_enableMotor},e.prototype.enableMotor=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t},e.prototype.setMotorSpeed=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t},e.prototype.getMotorSpeed=function(){return this.m_motorSpeed},e.prototype.setMaxMotorTorque=function(t){this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=t},e.prototype.getMaxMotorTorque=function(){return this.m_maxMotorTorque},e.prototype.getMotorTorque=function(t){return t*this.m_motorImpulse},e.prototype.setSpringFrequencyHz=function(t){this.m_frequencyHz=t},e.prototype.getSpringFrequencyHz=function(){return this.m_frequencyHz},e.prototype.setSpringDampingRatio=function(t){this.m_dampingRatio=t},e.prototype.getSpringDampingRatio=function(){return this.m_dampingRatio},e.prototype.getAnchorA=function(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)},e.prototype.getAnchorB=function(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)},e.prototype.getReactionForce=function(t){return b.combine(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax).mul(t)},e.prototype.getReactionTorque=function(t){return t*this.m_motorImpulse},e.prototype.initVelocityConstraints=function(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_invMassA,i=this.m_invMassB,s=this.m_invIA,o=this.m_invIB,n=this.m_bodyA.c_position.c,r=this.m_bodyA.c_position.a,a=this.m_bodyA.c_velocity.v,m=this.m_bodyA.c_velocity.w,h=this.m_bodyB.c_position.c,c=this.m_bodyB.c_position.a,_=this.m_bodyB.c_velocity.v,l=this.m_bodyB.c_velocity.w,u=z.neo(r),p=z.neo(c),d=z.mulVec2(u,b.sub(this.m_localAnchorA,this.m_localCenterA)),y=z.mulVec2(p,b.sub(this.m_localAnchorB,this.m_localCenterB)),f=b.zero();if(f.addCombine(1,h,1,y),f.subCombine(1,n,1,d),this.m_ay=z.mulVec2(u,this.m_localYAxisA),this.m_sAy=b.crossVec2Vec2(b.add(f,d),this.m_ay),this.m_sBy=b.crossVec2Vec2(y,this.m_ay),this.m_mass=e+i+s*this.m_sAy*this.m_sAy+o*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){this.m_ax=z.mulVec2(u,this.m_localXAxisA),this.m_sAx=b.crossVec2Vec2(b.add(f,d),this.m_ax),this.m_sBx=b.crossVec2Vec2(y,this.m_ax);var v=e+i+s*this.m_sAx*this.m_sAx+o*this.m_sBx*this.m_sBx;if(v>0){this.m_springMass=1/v;var x=b.dot(f,this.m_ax),A=2*g.PI*this.m_frequencyHz,B=2*this.m_springMass*this.m_dampingRatio*A,w=this.m_springMass*A*A,V=t.dt;this.m_gamma=V*(B+V*w),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=x*V*w*this.m_gamma,this.m_springMass=v+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=s+o,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),t.warmStarting){this.m_impulse*=t.dtRatio,this.m_springImpulse*=t.dtRatio,this.m_motorImpulse*=t.dtRatio;var C=b.combine(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax),M=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,I=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;a.subMul(this.m_invMassA,C),m-=this.m_invIA*M,_.addMul(this.m_invMassB,C),l+=this.m_invIB*I}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.setVec2(a),this.m_bodyA.c_velocity.w=m,this.m_bodyB.c_velocity.v.setVec2(_),this.m_bodyB.c_velocity.w=l},e.prototype.solveVelocityConstraints=function(t){var e=this.m_invMassA,i=this.m_invMassB,s=this.m_invIA,o=this.m_invIB,n=this.m_bodyA.c_velocity.v,r=this.m_bodyA.c_velocity.w,a=this.m_bodyB.c_velocity.v,m=this.m_bodyB.c_velocity.w,h=b.dot(this.m_ax,a)-b.dot(this.m_ax,n)+this.m_sBx*m-this.m_sAx*r,c=-this.m_springMass*(h+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=c;var _=b.mulNumVec2(c,this.m_ax),l=c*this.m_sAx,u=c*this.m_sBx;n.subMul(e,_),r-=s*l,a.addMul(i,_);var h=(m+=o*u)-r-this.m_motorSpeed,c=-this.m_motorMass*h,p=this.m_motorImpulse,d=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=g.clamp(this.m_motorImpulse+c,-d,d),r-=s*(c=this.m_motorImpulse-p),m+=o*c;var h=b.dot(this.m_ay,a)-b.dot(this.m_ay,n)+this.m_sBy*m-this.m_sAy*r,c=-this.m_mass*h;this.m_impulse+=c;var _=b.mulNumVec2(c,this.m_ay),l=c*this.m_sAy,u=c*this.m_sBy;n.subMul(e,_),r-=s*l,a.addMul(i,_),m+=o*u,this.m_bodyA.c_velocity.v.setVec2(n),this.m_bodyA.c_velocity.w=r,this.m_bodyB.c_velocity.v.setVec2(a),this.m_bodyB.c_velocity.w=m},e.prototype.solvePositionConstraints=function(t){var e,i=this.m_bodyA.c_position.c,s=this.m_bodyA.c_position.a,o=this.m_bodyB.c_position.c,n=this.m_bodyB.c_position.a,r=z.neo(s),a=z.neo(n),m=z.mulVec2(r,b.sub(this.m_localAnchorA,this.m_localCenterA)),h=z.mulVec2(a,b.sub(this.m_localAnchorB,this.m_localCenterB)),c=b.zero();c.addCombine(1,o,1,h),c.subCombine(1,i,1,m);var _=z.mulVec2(r,this.m_localYAxisA),l=b.crossVec2Vec2(b.add(c,m),_),u=b.crossVec2Vec2(h,_),p=b.dot(c,_),d=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy;e=0!=d?-p/d:0;var y=b.mulNumVec2(e,_),f=e*l,v=e*u;return i.subMul(this.m_invMassA,y),s-=this.m_invIA*f,o.addMul(this.m_invMassB,y),n+=this.m_invIB*v,this.m_bodyA.c_position.c.setVec2(i),this.m_bodyA.c_position.a=s,this.m_bodyB.c_position.c.setVec2(o),this.m_bodyB.c_position.a=n,g.abs(p)<=B.linearSlop},e.TYPE="wheel-joint",e}(tu),tQ=0;function t0(t){var e,i=(t=t||{}).rootClass||tB,s=t.preSerialize||function(t){return t},o=t.postSerialize||function(t,e){return t},n=t.preDeserialize||function(t){return t},r=t.postDeserialize||function(t,e){return t},a={World:tB,Body:Y,Joint:tu,Fixture:N,Shape:F},m=f({Vec2:b,Vec3:tw},a),h=((e={})[Y.STATIC]=Y,e[Y.DYNAMIC]=Y,e[Y.KINEMATIC]=Y,e[tC.TYPE]=tC,e[tI.TYPE]=tI,e[tV.TYPE]=tV,e[tM.TYPE]=tM,e[tz.TYPE]=tz,e[tS.TYPE]=tS,e[tL.TYPE]=tL,e[tD.TYPE]=tD,e[tO.TYPE]=tO,e[tW.TYPE]=tW,e[tR.TYPE]=tR,e[tH.TYPE]=tH,e[tq.TYPE]=tq,e[tX.TYPE]=tX,e[tK.TYPE]=tK,e[t$.TYPE]=t$,e);this.toJson=function(t){for(var e=[],i=[t],n={};i.length;){var r=i.shift(),m=function t(r,m){if("object"!=typeof r||null===r)return r;if("function"==typeof r._serialize){var h;if(r!==m){for(var c in a)if(r instanceof a[c])return function(t,s){if(t.__sid=t.__sid||++tQ,!n[t.__sid]){i.push(t);var o=e.length+i.length;n[t.__sid]={refIndex:o,refType:s}}return n[t.__sid]}(r,c)}r=o((h=s(h=r))._serialize(),h)}if(Array.isArray(r)){for(var _=[],l=0;l<r.length;l++)_[l]=t(r[l]);r=_}else{var _={};for(var l in r)r.hasOwnProperty(l)&&(_[l]=t(r[l]));r=_}return r}(r,r);e.push(m)}return e},this.fromJson=function(t){var e={};function s(t,e,i){var s,a,m=(s=e,(a=t)&&a._deserialize||(a=h[s.type]),a&&a._deserialize);if(m)return r(m(e=n(e),i,o),e)}function o(i,o,n){if(!o.refIndex)return i&&i._deserialize&&s(i,o,n);i=m[o.refType]||i;var r=o.refIndex;if(!e[r]){var a=s(i,t[r],n);e[r]=a}return e[r]}return i._deserialize(t[0],null,o)}}var t1=new t0;function t2(t,e,i,s,o){t.pointCount=0;var n=P.mulVec2(i,e.m_p),r=P.mulVec2(o,s.m_p),a=b.distanceSquared(r,n),c=e.m_radius+s.m_radius;a>c*c||(t.type=m.e_circles,t.localPoint.setVec2(e.m_p),t.localNormal.setZero(),t.pointCount=1,t.points[0].localPoint.setVec2(s.m_p),t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=h.e_vertex,t.points[0].id.cf.indexB=0,t.points[0].id.cf.typeB=h.e_vertex)}function t5(t,e,i,s,o){t.pointCount=0;var n=P.mulTVec2(i,P.mulVec2(o,s.m_p)),r=e.m_vertex1,a=e.m_vertex2,c=b.sub(a,r),_=b.dot(c,b.sub(a,n)),l=b.dot(c,b.sub(n,r)),u=e.m_radius+s.m_radius;if(l<=0){var p=b.clone(r),d=b.sub(n,p);if(b.dot(d,d)>u*u)return;if(e.m_hasVertex0){var y=e.m_vertex0,f=b.sub(r,y);if(b.dot(f,b.sub(r,n))>0)return}t.type=m.e_circles,t.localNormal.setZero(),t.localPoint.setVec2(p),t.pointCount=1,t.points[0].localPoint.setVec2(s.m_p),t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=h.e_vertex,t.points[0].id.cf.indexB=0,t.points[0].id.cf.typeB=h.e_vertex;return}if(_<=0){var v=b.clone(a),x=b.sub(n,v);if(b.dot(x,x)>u*u)return;if(e.m_hasVertex3){var g=e.m_vertex3,A=b.sub(g,a);if(b.dot(A,b.sub(n,a))>0)return}t.type=m.e_circles,t.localNormal.setZero(),t.localPoint.setVec2(v),t.pointCount=1,t.points[0].localPoint.setVec2(s.m_p),t.points[0].id.cf.indexA=1,t.points[0].id.cf.typeA=h.e_vertex,t.points[0].id.cf.indexB=0,t.points[0].id.cf.typeB=h.e_vertex;return}var B=b.dot(c,c),w=b.combine(_/B,r,l/B,a),V=b.sub(n,w);if(!(b.dot(V,V)>u*u)){var C=b.neo(-c.y,c.x);0>b.dot(C,b.sub(n,r))&&C.setNum(-C.x,-C.y),C.normalize(),t.type=m.e_faceA,t.localNormal=C,t.localPoint.setVec2(r),t.pointCount=1,t.points[0].localPoint.setVec2(s.m_p),t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=h.e_face,t.points[0].id.cf.indexB=0,t.points[0].id.cf.typeB=h.e_vertex}}function t3(t,e,i,s,o){for(var n=t.m_count,r=i.m_count,a=t.m_normals,m=t.m_vertices,h=i.m_vertices,c=P.mulTXf(s,e),_=0,l=-1/0,u=0;u<n;++u){for(var p=z.mulVec2(c.q,a[u]),d=P.mulVec2(c,m[u]),y=1/0,f=0;f<r;++f){var v=b.dot(p,h[f])-b.dot(p,d);v<y&&(y=v)}y>l&&(l=y,_=u)}o.maxSeparation=l,o.bestIndex=_}t0.toJson=t1.toJson,t0.fromJson=t1.fromJson,t_.addType(tz.TYPE,tz.TYPE,function(t,e,i,s,o,n,r){t2(t,i.getShape(),e,n.getShape(),o)}),t_.addType(tV.TYPE,tz.TYPE,function(t,e,i,s,o,n,r){t5(t,i.getShape(),e,n.getShape(),o)}),t_.addType(tC.TYPE,tz.TYPE,function(t,e,i,s,o,n,r){var a=i.getShape(),m=new tV;a.getChildEdge(m,s),t5(t,m,e,n.getShape(),o)}),t_.addType(tM.TYPE,tM.TYPE,function(t,e,i,s,o,n,r){t6(t,i.getShape(),e,n.getShape(),o)});var t4={maxSeparation:0,bestIndex:0};function t6(t,e,i,s,o){t.pointCount=0;var n,r,a,c,_,l,u=e.m_radius+s.m_radius;t3(e,i,s,o,t4);var p=t4.bestIndex,d=t4.maxSeparation;if(!(d>u)){t3(s,o,e,i,t4);var y=t4.bestIndex,f=t4.maxSeparation;if(!(f>u)){f>d+.1*B.linearSlop?(n=s,r=e,a=o,c=i,_=y,t.type=m.e_faceB,l=1):(n=e,r=s,a=i,c=o,_=p,t.type=m.e_faceA,l=0);var v=[new J,new J];!function(t,e,i,s,o,n){for(var r=e.m_normals,a=o.m_count,m=o.m_vertices,c=o.m_normals,_=z.mulTVec2(n.q,z.mulVec2(i.q,r[s])),l=0,u=1/0,p=0;p<a;++p){var d=b.dot(_,c[p]);d<u&&(u=d,l=p)}var y=l,f=y+1<a?y+1:0;t[0].v=P.mulVec2(n,m[y]),t[0].id.cf.indexA=s,t[0].id.cf.indexB=y,t[0].id.cf.typeA=h.e_face,t[0].id.cf.typeB=h.e_vertex,t[1].v=P.mulVec2(n,m[f]),t[1].id.cf.indexA=s,t[1].id.cf.indexB=f,t[1].id.cf.typeA=h.e_face,t[1].id.cf.typeB=h.e_vertex}(v,n,a,_,r,c);var x=n.m_count,g=n.m_vertices,A=_,w=_+1<x?_+1:0,V=g[A],C=g[w],M=b.sub(C,V);M.normalize();var I=b.crossVec2Num(M,1),S=b.combine(.5,V,.5,C),T=z.mulVec2(a.q,M),L=b.crossVec2Num(T,1);V=P.mulVec2(a,V),C=P.mulVec2(a,C);var F=b.dot(L,V),k=-b.dot(T,V)+u,q=b.dot(T,C)+u,N=[new J,new J],R=[new J,new J];if(!(2>$(N,v,b.neg(T),k,A))&&!(2>$(R,N,T,q,w))){t.localNormal=I,t.localPoint=S;for(var j=0,D=0;D<R.length;++D)if(b.dot(L,R[D].v)-F<=u){var E=t.points[j];if(E.localPoint.setVec2(P.mulTVec2(c,R[D].v)),E.id=R[D].id,l){var O=E.id.cf,Y=O.indexA,W=O.indexB,H=O.typeA,Z=O.typeB;O.indexA=W,O.indexB=Y,O.typeA=Z,O.typeB=H}++j}t.pointCount=j}}}}function t9(t,e,i,s,o){t.pointCount=0;for(var n=P.mulVec2(o,s.m_p),r=P.mulTVec2(i,n),a=0,c=-1/0,_=e.m_radius+s.m_radius,l=e.m_count,u=e.m_vertices,p=e.m_normals,d=0;d<l;++d){var y=b.dot(p[d],b.sub(r,u[d]));if(y>_)return;y>c&&(c=y,a=d)}var f=a,v=u[f],x=u[f+1<l?f+1:0];if(c<g.EPSILON){t.pointCount=1,t.type=m.e_faceA,t.localNormal.setVec2(p[a]),t.localPoint.setCombine(.5,v,.5,x),t.points[0].localPoint=s.m_p,t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=h.e_vertex,t.points[0].id.cf.indexB=0,t.points[0].id.cf.typeB=h.e_vertex;return}var A=b.dot(b.sub(r,v),b.sub(x,v)),B=b.dot(b.sub(r,x),b.sub(v,x));if(A<=0){if(b.distanceSquared(r,v)>_*_)return;t.pointCount=1,t.type=m.e_faceA,t.localNormal.setCombine(1,r,-1,v),t.localNormal.normalize(),t.localPoint=v,t.points[0].localPoint.setVec2(s.m_p),t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=h.e_vertex,t.points[0].id.cf.indexB=0,t.points[0].id.cf.typeB=h.e_vertex}else if(B<=0){if(b.distanceSquared(r,x)>_*_)return;t.pointCount=1,t.type=m.e_faceA,t.localNormal.setCombine(1,r,-1,x),t.localNormal.normalize(),t.localPoint.setVec2(x),t.points[0].localPoint.setVec2(s.m_p),t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=h.e_vertex,t.points[0].id.cf.indexB=0,t.points[0].id.cf.typeB=h.e_vertex}else{var w=b.mid(v,x);if(b.dot(r,p[f])-b.dot(w,p[f])>_)return;t.pointCount=1,t.type=m.e_faceA,t.localNormal.setVec2(p[f]),t.localPoint.setVec2(w),t.points[0].localPoint.setVec2(s.m_p),t.points[0].id.cf.indexA=0,t.points[0].id.cf.typeA=h.e_vertex,t.points[0].id.cf.indexB=0,t.points[0].id.cf.typeB=h.e_vertex}}t_.addType(tM.TYPE,tz.TYPE,function(t,e,i,s,o,n,r){t9(t,i.getShape(),e,n.getShape(),o)}),t_.addType(tV.TYPE,tM.TYPE,function(t,e,i,s,o,n,r){es(t,i.getShape(),e,n.getShape(),o)}),t_.addType(tC.TYPE,tM.TYPE,function(t,e,i,s,o,n,r){var a=i.getShape(),m=new tV;a.getChildEdge(m,s),es(t,m,e,n.getShape(),o)}),(r=u||(u={}))[r.e_unknown=-1]="e_unknown",r[r.e_edgeA=1]="e_edgeA",r[r.e_edgeB=2]="e_edgeB",(a=p||(p={}))[a.e_isolated=0]="e_isolated",a[a.e_concave=1]="e_concave",a[a.e_convex=2]="e_convex";var t7=function(){},t8=new t7,et=new t7,ee=new function(){this.vertices=[],this.normals=[],this.count=0},ei=new function(){this.normal=b.zero(),this.sideNormal1=b.zero(),this.sideNormal2=b.zero()};function es(t,e,i,s,o){var n,r,a,c,_=P.mulTXf(i,o),l=P.mulVec2(_,s.m_centroid),p=e.m_vertex0,d=e.m_vertex1,y=e.m_vertex2,f=e.m_vertex3,v=e.m_hasVertex0,x=e.m_hasVertex3,A=b.sub(y,d);A.normalize();var w=b.neo(A.y,-A.x),V=b.dot(w,b.sub(l,d)),C=0,M=0,I=!1,S=!1;if(v){var T=b.sub(d,p);T.normalize(),n=b.neo(T.y,-T.x),I=b.crossVec2Vec2(T,A)>=0,C=b.dot(n,l)-b.dot(n,p)}if(x){var L=b.sub(f,y);L.normalize(),r=b.neo(L.y,-L.x),S=b.crossVec2Vec2(A,L)>0,M=b.dot(r,l)-b.dot(r,y)}var F=b.zero(),k=b.zero(),q=b.zero();v&&x?I&&S?(a=C>=0||V>=0||M>=0)?(F.setVec2(w),k.setVec2(n),q.setVec2(r)):(F.setMul(-1,w),k.setMul(-1,w),q.setMul(-1,w)):I?(a=C>=0||V>=0&&M>=0)?(F.setVec2(w),k.setVec2(n),q.setVec2(w)):(F.setMul(-1,w),k.setMul(-1,r),q.setMul(-1,w)):S?(a=M>=0||C>=0&&V>=0)?(F.setVec2(w),k.setVec2(w),q.setVec2(r)):(F.setMul(-1,w),k.setMul(-1,w),q.setMul(-1,n)):(a=C>=0&&V>=0&&M>=0)?(F.setVec2(w),k.setVec2(w),q.setVec2(w)):(F.setMul(-1,w),k.setMul(-1,r),q.setMul(-1,n)):v?I?((a=C>=0||V>=0)?(F.setVec2(w),k.setVec2(n)):(F.setMul(-1,w),k.setVec2(w)),q.setMul(-1,w)):(a=C>=0&&V>=0)?(F.setVec2(w),k.setVec2(w),q.setMul(-1,w)):(F.setMul(-1,w),k.setVec2(w),q.setMul(-1,n)):x?S?(a=V>=0||M>=0)?(F.setVec2(w),k.setMul(-1,w),q.setVec2(r)):(F.setMul(-1,w),k.setMul(-1,w),q.setVec2(w)):((a=V>=0&&M>=0)?(F.setVec2(w),k.setMul(-1,w)):(F.setMul(-1,w),k.setMul(-1,r)),q.setVec2(w)):(a=V>=0)?(F.setVec2(w),k.setMul(-1,w),q.setMul(-1,w)):(F.setMul(-1,w),k.setVec2(w),q.setVec2(w)),ee.count=s.m_count;for(var N=0;N<s.m_count;++N)ee.vertices[N]=P.mulVec2(_,s.m_vertices[N]),ee.normals[N]=z.mulVec2(_.q,s.m_normals[N]);var R=2*B.polygonRadius;t.pointCount=0,t8.type=u.e_edgeA,t8.index=a?0:1,t8.separation=1/0;for(var N=0;N<ee.count;++N){var j=b.dot(F,b.sub(ee.vertices[N],d));j<t8.separation&&(t8.separation=j)}if(t8.type!=u.e_unknown&&!(t8.separation>R)){et.type=u.e_unknown,et.index=-1,et.separation=-1/0;for(var D=b.neo(-F.y,F.x),N=0;N<ee.count;++N){var E=b.neg(ee.normals[N]),O=b.dot(E,b.sub(ee.vertices[N],d)),Y=b.dot(E,b.sub(ee.vertices[N],y)),j=g.min(O,Y);if(j>R){et.type=u.e_edgeB,et.index=N,et.separation=j;break}if(b.dot(E,D)>=0){if(b.dot(b.sub(E,q),F)<-B.angularSlop)continue}else if(b.dot(b.sub(E,k),F)<-B.angularSlop)continue;j>et.separation&&(et.type=u.e_edgeB,et.index=N,et.separation=j)}if(et.type==u.e_unknown||!(et.separation>R)){c=et.type==u.e_unknown?t8:et.separation>.98*t8.separation+.001?et:t8;var W=[new J,new J];if(c.type==u.e_edgeA){t.type=m.e_faceA;for(var H=0,Z=b.dot(F,ee.normals[0]),N=1;N<ee.count;++N){var X=b.dot(F,ee.normals[N]);X<Z&&(Z=X,H=N)}var U=H,K=U+1<ee.count?U+1:0;W[0].v=ee.vertices[U],W[0].id.cf.indexA=0,W[0].id.cf.indexB=U,W[0].id.cf.typeA=h.e_face,W[0].id.cf.typeB=h.e_vertex,W[1].v=ee.vertices[K],W[1].id.cf.indexA=0,W[1].id.cf.indexB=K,W[1].id.cf.typeA=h.e_face,W[1].id.cf.typeB=h.e_vertex,a?(ei.i1=0,ei.i2=1,ei.v1=d,ei.v2=y,ei.normal.setVec2(w)):(ei.i1=1,ei.i2=0,ei.v1=y,ei.v2=d,ei.normal.setMul(-1,w))}else t.type=m.e_faceB,W[0].v=d,W[0].id.cf.indexA=0,W[0].id.cf.indexB=c.index,W[0].id.cf.typeA=h.e_vertex,W[0].id.cf.typeB=h.e_face,W[1].v=y,W[1].id.cf.indexA=0,W[1].id.cf.indexB=c.index,W[1].id.cf.typeA=h.e_vertex,W[1].id.cf.typeB=h.e_face,ei.i1=c.index,ei.i2=ei.i1+1<ee.count?ei.i1+1:0,ei.v1=ee.vertices[ei.i1],ei.v2=ee.vertices[ei.i2],ei.normal.setVec2(ee.normals[ei.i1]);ei.sideNormal1.setNum(ei.normal.y,-ei.normal.x),ei.sideNormal2.setMul(-1,ei.sideNormal1),ei.sideOffset1=b.dot(ei.sideNormal1,ei.v1),ei.sideOffset2=b.dot(ei.sideNormal2,ei.v2);var G=[new J,new J],Q=[new J,new J];if(!($(G,W,ei.sideNormal1,ei.sideOffset1,ei.i1)<B.maxManifoldPoints)&&!($(Q,G,ei.sideNormal2,ei.sideOffset2,ei.i2)<B.maxManifoldPoints)){c.type==u.e_edgeA?(t.localNormal=b.clone(ei.normal),t.localPoint=b.clone(ei.v1)):(t.localNormal=b.clone(s.m_normals[ei.i1]),t.localPoint=b.clone(s.m_vertices[ei.i1]));for(var tt=0,N=0;N<B.maxManifoldPoints;++N)if(b.dot(ei.normal,b.sub(Q[N].v,ei.v1))<=R){var te=t.points[tt];c.type==u.e_edgeA?(te.localPoint=P.mulTVec2(_,Q[N].v),te.id=Q[N].id):(te.localPoint=Q[N].v,te.id.cf.typeA=Q[N].id.cf.typeB,te.id.cf.typeB=Q[N].id.cf.typeA,te.id.cf.indexA=Q[N].id.cf.indexB,te.id.cf.indexB=Q[N].id.cf.indexA),++tt}t.pointCount=tt}}}}var eo={};eo.CollidePolygons=t6,eo.Settings=B,eo.Sweep=S,eo.Manifold=H,eo.Distance=ts,eo.TimeOfImpact=ty,eo.DynamicTree=C,eo.stats=Q,tb.TimeStep=tv,ts.testOverlap=ta,ts.Input=tt,ts.Output=te,ts.Proxy=to,ts.Cache=ti,ty.Input=tp,ty.Output=td,t.AABB=A,t.Body=Y,t.Box=tI,t.Chain=tC,t.Circle=tz,t.CollideCircles=t2,t.CollideEdgeCircle=t5,t.CollideEdgePolygon=es,t.CollidePolygonCircle=t9,t.CollidePolygons=t6,t.Contact=t_,t.Distance=ts,t.DistanceJoint=tS,t.DynamicTree=C,t.Edge=tV,t.Fixture=N,t.FrictionJoint=tL,t.GearJoint=tD,t.Joint=tu,t.Manifold=H,t.Mat22=W,t.Mat33=tF,t.Math=g,t.MotorJoint=tO,t.MouseJoint=tW,t.Polygon=tM,t.PrismaticJoint=tR,t.PulleyJoint=tH,t.RevoluteJoint=tq,t.RopeJoint=tX,t.Rot=z,t.Serializer=t0,t.Settings=B,t.Shape=F,t.Sweep=S,t.TimeOfImpact=ty,t.Transform=P,t.Vec2=b,t.Vec3=tw,t.WeldJoint=tK,t.WheelJoint=t$,t.World=tB,t.internal=eo,Object.defineProperty(t,"__esModule",{value:!0})}(s),(i=e||(e={}))[i.None=0]="None",i[i.Impact=1]="Impact";const a=new class{constructor(){this.useSkills=!0,this.winningRank=0,this.autoRecording=!0}};class m{get position(){return this.body.getPosition()}get x(){return this.position.x}set x(t){this.position.x=t}get y(){return this.position.y}set y(t){this.position.y=t}constructor(t,i,o,n,r=1){this.type="marble",this.name="",this.size=.5,this.color="red",this.hue=0,this.impact=0,this.weight=1,this.skill=e.None,this._skillRate=5e-4,this._coolTime=5e3,this._maxCoolTime=5e3,this._stuckTime=0,this.lastPosition=(0,s.Vec2)(0,0),this.name=n||`M${i}`,this.body=t.createBody({type:"dynamic",allowSleep:!1,awake:!0,active:!1,linearDamping:0,angularDamping:.01,linearVelocity:new s.Vec2(0,0)}),this.weight=r,this._maxCoolTime=1e3+(1-this.weight)*4e3,this._coolTime=this._maxCoolTime*Math.random(),this._skillRate=.2*this.weight;let a=Math.ceil(o/10),m=Math.floor(i/10),h=-Math.max(0,Math.ceil(a-5));this.hue=360/o*i,this.color=`hsl(${this.hue} 100% 70%)`;let c=s.Circle(new s.Vec2(0,0),this.size/2);this.body.createFixture({shape:c,density:Math.random()+1,restitution:.2}),this.body.setPosition(new s.Vec2(10.25+i%10*.6,a-m+h)),this.body.setUserData(this)}update(t){this.body.isActive()&&.001>this.lastPosition.sub(this.position).length()?(this._stuckTime+=t,this._stuckTime>1e3&&this.body.applyForceToCenter((0,s.Vec2)(10*Math.random()-5,10*Math.random()-5),!0)):this._stuckTime=0,this.lastPosition=this.position.clone(),this.skill=e.None,this.impact&&(this.impact=Math.max(0,this.impact-t)),this.body.isActive()&&a.useSkills&&this._updateSkillInformation(t)}_updateSkillInformation(t){this._coolTime>0&&(this._coolTime-=t),this._coolTime<=0&&(this.skill=Math.random()<this._skillRate?e.Impact:e.None,this._coolTime=this._maxCoolTime)}render(t,e,i,s=!1){t.save(),s?this._renderMinimap(t):this._renderNormal(t,e,i),t.restore()}_renderMinimap(t){t.fillStyle=this.color,this._drawMarbleBody(t,!0)}_drawMarbleBody(t,e){t.beginPath(),t.arc(this.x,this.y,e?this.size:this.size/2,0,2*Math.PI),t.fill()}_renderNormal(t,e,i){t.shadowColor=this.color,t.shadowBlur=e/2,t.fillStyle=`hsl(${this.hue} 100% ${70+25*Math.min(1,this.impact/500)}%`,this._drawMarbleBody(t,!1),this._drawName(t,e),i&&this._drawOutline(t,2/e),a.useSkills&&this._renderCooltime(t,e)}_drawName(t,e){t.save(),t.translate(this.x,this.y+.25),t.scale(1/e,1/e),t.font="12pt sans-serif",t.strokeStyle="black",t.lineWidth=2,t.fillStyle=this.color,t.shadowBlur=0,t.strokeText(this.name,0,0),t.fillText(this.name,0,0),t.restore()}_drawOutline(t,e){t.save(),t.beginPath(),t.strokeStyle="white",t.lineWidth=e,t.arc(this.x,this.y,this.size/2,0,2*Math.PI),t.stroke(),t.restore()}_renderCooltime(t,e){t.strokeStyle="red",t.lineWidth=1/e,t.beginPath(),t.arc(this.x,this.y,this.size/2+2/e,o(270),o(270+360*this._coolTime/this._maxCoolTime)),t.stroke()}}class h{constructor(t,e){this._elapsed=0,this.position=new s.Vec2,this.force=new s.Vec2,this.color="",this.isDestroy=!1,this.position=new s.Vec2(t,e);let i=250*Math.random(),n=o(90*Math.random()-180),r=Math.cos(n)*i,a=Math.sin(n)*i;this.color=`hsl(${360*Math.random()} 50% 50%)`,this.force.set(r,a)}update(t){this._elapsed+=t;let e=this.force.clone().mul(t/100);this.position.add(e),this.force.y+=10*t/100,this._elapsed>3e3&&(this.isDestroy=!0)}render(t){t.save(),t.globalAlpha=1-Math.pow(this._elapsed/3e3,2),t.fillStyle=this.color,t.fillRect(this.position.x,this.position.y,20,20),t.restore()}}class c{update(t){this._particles.forEach(e=>{e.update(t)}),this._particles=this._particles.filter(t=>!t.isDestroy)}render(t){this._particles.forEach(e=>e.render(t))}shot(t,e){for(let i=0;i<200;i++)this._particles.push(new h(t,e))}constructor(){this._particles=[]}}const _=[{title:"Wheel of fortune",goalY:111,zoomY:106.75,walls:[[[16.5,-300],[9.25,-300],[9.25,8.5],[2,19.25],[2,26],[9.75,30],[9.75,33.5],[1.25,41],[1.25,53.75],[8.25,58.75],[8.25,63],[9.25,64],[8.25,65],[8.25,99.25],[15.1,106.75],[15.1,111.75]],[[16.5,-300],[16.5,9.25],[9.5,20],[9.5,22.5],[17.5,26],[17.5,33.5],[24,38.5],[19,45.5],[19,55.5],[24,59.25],[24,63],[23,64],[24,65],[24,100.5],[16,106.75],[16,111.75]],[[12.75,37.5],[7,43.5],[7,49.75],[12.75,53.75],[12.75,37.5]],[[14.75,37.5],[14.75,43],[17.5,40.25],[14.75,37.5]]],boxes:[[15.5,30,-45,.2,.2],[15.5,32,-45,.2,.2],[15.5,28,-45,.2,.2],[12.5,30,-45,.2,.2],[12.5,32,-45,.2,.2],[12.5,28,-45,.2,.2],[9.4,66.6,45,.6,.1],[11.3,66.6,45,.6,.1],[13.2,66.6,45,.6,.1],[15.1,66.6,45,.6,.1],[17,66.6,45,.6,.1],[18.9,66.6,45,.6,.1],[20.699999999999996,66.6,45,.6,.1],[22.7,66.6,45,.6,.1],[9.4,69.1,-45,.6,.1],[11.3,69.1,-45,.6,.1],[13.2,69.1,-45,.6,.1],[15.1,69.1,-45,.6,.1],[17,69.1,-45,.6,.1],[18.9,69.1,-45,.6,.1],[20.699999999999996,69.1,-45,.6,.1],[22.7,69.1,-45,.6,.1],[9.5,92,o(45),.25,.25],[12.75,92,o(45),.25,.25],[16,92,o(45),.25,.25],[19.25,92,o(45),.25,.25],[22.5,92,o(45),.25,.25],[11,95,o(45),.25,.25],[14.25,95,o(45),.25,.25],[17.5,95,o(45),.25,.25],[20.75,95,o(45),.25,.25],[9.5,98,o(45),.25,.25],[12.75,98,o(45),.25,.25],[16,98,o(45),.25,.25],[19.25,98,o(45),.25,.25],[22.5,98,o(45),.25,.25]],wheels:[[8,75,3.5],[12,75,-3.5],[16,75,3.5],[20,75,-3.5],[24,75,3.5],[14,106.75,-1.2]]},{title:"BubblePop",goalY:83,zoomY:78,walls:[[[16.5,-300],[9.25,-300],[9.25,0],[9.25,43],[4.25,50],[9.25,53],[9.25,75],[12,80],[12,83]],[[16.5,-300],[16.5,50],[19.5,54],[18.5,56],[19.5,58],[16.5,61],[16.5,75],[13,80],[13,83]],[[16.5,52.5],[17.5,54],[16.5,56],[17.5,58],[16.5,59],[15.5,56],[16.5,52.5]],[[9.25,45.5],[6.25,49.5],[9.25,51],[14.5,50.5],[9.25,45.5]],[[9.25,26],[11.0625,27.5]],[[16.5,26],[14.6875,27.5]],[[11.0625,30],[12.875,28.5],[14.6875,30]],[[9.25,31],[11.0625,32.5]],[[16.5,31],[14.6875,32.5]],[[11.0625,35],[12.875,33.5],[14.6875,35]]],wheels:[[10.7,10,10,0,0,.5],[14.7,10,-10,0,0,.5],[12.7,10,10,0,0,.5],[10.7,14,-3],[14.7,14,3],[11.2,44,-5,0,0,.5],[10.3,75,8,0,0,1],[15.2,75,-8,0,0,1]],boxes:[[9.25,18,o(45),.15,.15],[11.25,18,o(45),.15,.15],[13.25,18,o(45),.15,.15],[15.25,18,o(45),.15,.15],[10.5,19,o(45),.15,.15],[12.5,19,o(45),.15,.15],[14.5,19,o(45),.15,.15],[16.5,19,o(45),.15,.15],[9.25,20,o(45),.15,.15],[11.25,20,o(45),.15,.15],[13.25,20,o(45),.15,.15],[15.25,20,o(45),.15,.15],[10.5,21,o(45),.15,.15],[12.5,21,o(45),.15,.15],[14.5,21,o(45),.15,.15],[16.5,21,o(45),.15,.15],[9.25,22,o(45),.15,.15],[11.25,22,o(45),.15,.15],[13.25,22,o(45),.15,.15],[15.25,22,o(45),.15,.15],[10.5,23,o(45),.15,.15],[12.5,23,o(45),.15,.15],[14.5,23,o(45),.15,.15],[16.5,23,o(45),.15,.15],[9.4,39,o(45),3,3],[16.5,43,o(45),3,3]],jumpers:[[11,65,.5,!0],[13,65,.5,!0],[15,65,.5,!0],[12,67.5,.5,!0],[14,67.5,.5,!0],[13,71,.8,!0],[10.7,77.5,.8,!0],[14.7,77.5,.8,!0],[12.625,80,1.5,!0],[12.625,80,1.2,!0]]},{title:"Pot of greed",goalY:111,zoomY:110,walls:[[[17,-300],[9,-300],[9,8.5],[2,15],[6,61.5]],[[7,71],[9,101],[8,100.5],[6,100],[5,90],[4,70],[7,71]],[[17,-300],[17,8.5],[24,15],[20,61.5]],[[19,71],[17,101],[18,100.5],[20,100],[21,90],[22,70],[19,71]],[[11,88],[12,90],[12,112]],[[15,88],[14,90],[14,112]],[[12,102],[11,103],[9,104],[8,104],[6,103],[5,102],[4,100],[3,90],[2,70],[3,65],[4,63],[5,62],[6,61.5]],[[14,102],[15,103],[17,104],[18,104],[20,103],[21,102],[22,100],[23,90],[24,70],[23,65],[22,63],[21,62],[20,61.5]]],boxes:[[13,20,o(45),3,3],[13,55,o(45),3,3],[8,37,o(45),2,2],[18,37,o(45),2,2]],jumpers:[],wheels:[[11,12,-3],[15,12,3],[8,104,-10,0,0,1],[6,103,-10,0,0,1.5],[4,100,-10,0,0,1.5],[3.5,95,-10],[3,90,-10],[2.75,85,-10],[2.5,80,-10],[2.25,75,-10],[2,70,-10],[18,104,10,0,0,1],[20,103,10,0,0,1.5],[22,100,10,0,0,1.5],[22.5,95,10],[23,90,10],[23.25,85,10],[23.5,80,10],[23.75,75,10],[24,70,10]]}];class l{get zoom(){return this._zoom}set zoom(t){this._targetZoom=t}get x(){return this._position.x}set x(t){this._targetPosition.x=t}get y(){return this._position.y}set y(t){this._targetPosition.y=t}get position(){return this._position}setPosition(t,e=!1){return e?this._position.set(t):this._targetPosition.set(t)}lock(t){this._locked=t}update({marbles:t,stage:e,needToZoom:i,targetIndex:s}){this._locked||this._calcTargetPositionAndZoom(t,e,i,s),this._position.x=this._interpolation(this.x,this._targetPosition.x),this._position.y=this._interpolation(this.y,this._targetPosition.y),this._zoom=this._interpolation(this._zoom,this._targetZoom)}_calcTargetPositionAndZoom(t,e,i,o){if(t.length>0){let s=t[o]?t[o]:t[0];if(this.setPosition(s.position),i){let t=Math.abs(e.zoomY-this._position.y);this.zoom=Math.max(1,(1-t/5)*4)}else this.zoom=1}else this.setPosition(new s.Vec2(0,0)),this.zoom=1}_interpolation(t,e){let i=e-t;return .03333333333333333>Math.abs(i)?e:t+i/10}renderScene(t,e){let i=60*this._zoom;t.save(),t.translate(-this.x*this._zoom,-this.y*this._zoom),t.scale(this.zoom,this.zoom),t.translate(t.canvas.width/i,t.canvas.height/i),e(t),t.restore()}constructor(){this._position=new s.Vec2,this._targetPosition=new s.Vec2,this._zoom=1,this._targetZoom=1,this._locked=!1}}class u{constructor(){this.sizeFactor=1}get width(){return this._canvas.width}get height(){return this._canvas.height}get canvas(){return this._canvas}init(){this._canvas=document.createElement("canvas"),this._canvas.width=1600,this._canvas.height=900,this._ctx=this._canvas.getContext("2d",{alpha:!1}),document.body.appendChild(this._canvas);let t=t=>{let e=t?t[0].contentRect:this._canvas.getBoundingClientRect(),i=Math.max(e.width/2,640),s=i/e.width*e.height;this._canvas.width=i,this._canvas.height=s,this.sizeFactor=i/e.width};new ResizeObserver(t).observe(this._canvas),t()}render(t,e){this._ctx.fillStyle="black",this._ctx.fillRect(0,0,this._canvas.width,this._canvas.height),this._ctx.save(),this._ctx.scale(30,30),this._ctx.textAlign="left",this._ctx.textBaseline="top",this._ctx.font="0.4pt sans-serif",t.camera.renderScene(this._ctx,()=>{this._renderWalls({...t}),this._renderObjects({...t}),this._renderEffects(t),this._renderMarbles(t)}),this._ctx.restore(),e.forEach(e=>e.render(this._ctx,t,this._canvas.width,this._canvas.height)),t.particleManager.render(this._ctx),this._renderWinner(t)}_renderWalls({stage:t,camera:e}){t&&(this._ctx.save(),this._ctx.strokeStyle="white",this._ctx.lineWidth=5/(e.zoom+30),this._ctx.beginPath(),t.walls.forEach(t=>{this._ctx.moveTo(t[0][0],t[0][1]);for(let e=1;e<t.length;e++)this._ctx.lineTo(t[e][0],t[e][1])}),this._ctx.shadowColor="cyan",this._ctx.shadowBlur=15,this._ctx.stroke(),this._ctx.closePath(),this._ctx.restore())}_renderObjects({objects:t,camera:e}){this._ctx.save(),this._ctx.fillStyle="black",this._ctx.lineWidth=3/(e.zoom+30),t.forEach(t=>{this._ctx.save();let e=t.getPosition(),i=t.getAngle();this._ctx.translate(e.x,e.y),this._ctx.rotate(i);for(let e=t.getFixtureList();e;e=e.getNext()){let t=e.getShape();if(this._ctx.beginPath(),"circle"===t.getType())this._ctx.strokeStyle="yellow",this._ctx.arc(0,0,t.m_radius,0,2*Math.PI);else{this._ctx.strokeStyle="#94d5ed";let e=t.m_vertices;this._ctx.moveTo(e[0].x,e[0].y);for(let t=1;t<e.length;t++){let i=e[t];this._ctx.lineTo(i.x,i.y)}this._ctx.closePath()}this._ctx.fill(),this._ctx.save(),this._ctx.shadowBlur=15,this._ctx.shadowColor="cyan",this._ctx.stroke(),this._ctx.restore(),this._ctx.closePath()}this._ctx.restore()}),this._ctx.restore()}_renderEffects({effects:t,camera:e}){t.forEach(t=>t.render(this._ctx,30*e.zoom))}_renderMarbles({marbles:t,camera:e,winnerRank:i,winners:s}){let o=i-s.length;t.forEach((t,i)=>{t.render(this._ctx,30*e.zoom,i===o,!1)})}_renderWinner({winner:t}){t&&(this._ctx.save(),this._ctx.fillStyle="rgba(0, 0, 0, 0.5)",this._ctx.fillRect(this._canvas.width/2,this._canvas.height-168,this._canvas.width/2,168),this._ctx.fillStyle="white",this._ctx.font="bold 48px sans-serif",this._ctx.textAlign="right",this._ctx.fillText("Winner",this._canvas.width-10,this._canvas.height-120),this._ctx.font="bold 72px sans-serif",this._ctx.fillStyle=t.color,this._ctx.fillText(t.name,this._canvas.width-10,this._canvas.height-55),this._ctx.restore())}}class p{constructor(t,e){this._size=0,this._elapsed=0,this.isDestroy=!1,this.position=new s.Vec2(t,e)}update(t){this._elapsed+=t,this._size=this._elapsed/500*10,this._elapsed>500&&(this.isDestroy=!0)}render(t,e){t.save();let i=this._elapsed/500;t.globalAlpha=1-i*i,t.strokeStyle="white",t.lineWidth=1/e,t.beginPath(),t.arc(this.position.x,this.position.y,this._size,0,2*Math.PI),t.stroke(),t.restore()}}function d(t,e,i){return{configurable:!0,get(){let t=i.value.bind(this);return Object.defineProperty(this,e,{value:t,configurable:!0,writable:!0}),t}}}class y{constructor(){this._currentY=0,this._targetY=0,this.fontHeight=16,this._userMoved=0,this._currentWinner=-1,this.maxY=0}onWheel(t){this._targetY+=t.deltaY,this._targetY>this.maxY&&(this._targetY=this.maxY),this._userMoved=2e3}render(t,{winners:e,marbles:i,winnerRank:s},o,n){let r=o-5,a=Math.max(0,this._currentY-n/2);this.maxY=Math.max(0,(i.length+e.length)*this.fontHeight),this._currentWinner=e.length,t.save(),t.translate(0,-a),t.font="bold 11pt sans-serif",t.textAlign="right",e.forEach((e,i)=>{let o=i*this.fontHeight;o>=a&&(t.fillStyle=e.color,t.fillText(`${i===s?"":""} ${e.name} #${i+1}`,r,20+o))}),t.font="10pt sans-serif",i.forEach((i,s)=>{t.fillStyle=i.color;let o=(s+e.length)*this.fontHeight;t.fillText(`${i.name} #${s+1+e.length}`,r,20+o)}),t.restore()}update(t){-1!==this._currentWinner&&(this._userMoved>0?this._userMoved-=t:this._targetY=this._currentWinner*this.fontHeight,this._currentY!==this._targetY&&(this._currentY+=(this._targetY-this._currentY)*(t/250)),1>Math.abs(this._currentY-this._targetY)&&(this._currentY=this._targetY))}getBoundingBox(){return null}}t([d],y.prototype,"onWheel",null);class f{constructor(){this.lastParams=null,this._onViewportChangeHandler=null,this.mousePosition=null,this.boundingBox={x:10,y:10,w:104,h:0}}getBoundingBox(){return this.boundingBox}onViewportChange(t){this._onViewportChangeHandler=t}update(t){}onMouseMove(t){if(!t){this.mousePosition=null,this._onViewportChangeHandler&&this._onViewportChangeHandler();return}this.lastParams&&(this.mousePosition={x:t.x,y:t.y},this._onViewportChangeHandler&&this._onViewportChangeHandler(new s.Vec2(this.mousePosition.x/4,this.mousePosition.y/4)))}render(t,e){if(!t)return;let{stage:i}=e;i&&(this.boundingBox.h=4*i.goalY,this.lastParams=e,this.ctx=t,t.save(),t.fillStyle="#333",t.translate(10,10),t.scale(4,4),t.fillRect(0,0,26,i.goalY),this.drawWalls(e),this.drawObjects(e),this.drawMarbles(e),this.drawViewport(e),t.restore(),t.save(),t.strokeStyle="green",t.lineWidth=1,t.strokeRect(this.boundingBox.x,this.boundingBox.y,this.boundingBox.w,this.boundingBox.h),t.restore())}drawViewport(t){this.ctx.save();let{camera:e,size:i}=t,s=30*e.zoom,o=i.x/s,n=i.y/s;this.ctx.strokeStyle="white",this.ctx.lineWidth=1/s,this.ctx.strokeRect(e.x-o/2,e.y-n/2,o,n),this.ctx.restore()}drawWalls(t){t.stage&&(this.ctx.save(),this.ctx.strokeStyle="black",this.ctx.lineWidth=.5,this.ctx.beginPath(),t.stage.walls.forEach(t=>{this.ctx.moveTo(t[0][0],t[0][1]);for(let e=1;e<t.length;e++)this.ctx.lineTo(t[e][0],t[e][1])}),this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore())}drawObjects(t){let{objects:e}=t;e&&(this.ctx.save(),this.ctx.fillStyle="black",this.ctx.lineWidth=1,e.forEach(t=>{this.ctx.save();let e=t.getPosition(),i=t.getAngle();this.ctx.translate(e.x,e.y),this.ctx.rotate(i);for(let e=t.getFixtureList();e;e=e.getNext()){let t=e.getShape();if(this.ctx.beginPath(),"circle"===t.getType())this.ctx.strokeStyle="yellow",this.ctx.arc(0,0,t.m_radius,0,2*Math.PI);else{this.ctx.strokeStyle="#94d5ed";let e=t.m_vertices;this.ctx.moveTo(e[0].x,e[0].y);for(let t=1;t<e.length;t++){let i=e[t];this.ctx.lineTo(i.x,i.y)}this.ctx.closePath()}this.ctx.fill(),this.ctx.closePath()}this.ctx.restore()}),this.ctx.restore())}drawMarbles(t){let{marbles:e}=t;e.forEach(t=>{t.render(this.ctx,1,!1,!0)})}}t([d],f.prototype,"onMouseMove",null);class v{constructor(t){this.chunks=[],this.stopping=!1,this.targetCanvas=t,this.videoStream=this.targetCanvas.captureStream(),this.mediaRecorder=new MediaRecorder(this.videoStream,{videoBitsPerSecond:6e6})}async start(){return this.stopping=!1,new Promise(t=>{this.chunks=[],this.mediaRecorder.ondataavailable=t=>{this.chunks.push(t.data)},this.mediaRecorder.onstop=()=>{let t=new Blob(this.chunks,{type:"video/webm"}),e=URL.createObjectURL(t),i=document.createElement("a"),s=new Date;i.href=e,i.download=`marble_roulette_${s.getFullYear()}${r(s.getMonth()+1)}${r(s.getDate())}${r(s.getHours())}${r(s.getMinutes())}${r(s.getSeconds())}.webm`,i.click(),i.remove(),URL.revokeObjectURL(e)},this.mediaRecorder.onstart=()=>{t()},this.mediaRecorder.start()})}stop(){this.stopping=!0,"recording"===this.mediaRecorder.state&&this.mediaRecorder.stop()}}class x extends EventTarget{constructor(){super(),this._marbles=[],this._lastTime=0,this._elapsed=0,this._noMoveDuration=0,this._shakeAvailable=!1,this._updateInterval=10,this._timeScale=1,this._speed=1,this._winners=[],this._objects=[],this._stageObjects=[],this._particleManager=new c,this._stage=null,this._camera=new l,this._renderer=new u,this._effects=[],this._winnerRank=0,this._totalMarbleCount=0,this._goalDist=1/0,this._isRunning=!1,this._winner=null,this._uiObjects=[],this._autoRecording=!1,this._renderer.init(),this._init(),this._update()}getZoom(){return 30*this._camera.zoom}addUiObject(t){this._uiObjects.push(t),t.onWheel&&this._renderer.canvas.addEventListener("wheel",t.onWheel)}_update(){this._lastTime||(this._lastTime=Date.now());let t=Date.now();this._elapsed+=(t-this._lastTime)*this._speed,this._elapsed>100&&(this._elapsed%=100),this._lastTime=t;let e=this._updateInterval/1e3*this._timeScale;for(;this._elapsed>=this._updateInterval;)this._world.step(e),this._updateMarbles(this._updateInterval),this._particleManager.update(this._updateInterval),this._updateEffects(this._updateInterval),this._elapsed-=this._updateInterval,this._uiObjects.forEach(t=>t.update(this._updateInterval));this._marbles.length>1&&this._marbles.sort((t,e)=>e.y-t.y),this._stage&&(this._camera.update({marbles:this._marbles,stage:this._stage,needToZoom:this._goalDist<5,targetIndex:this._winners.length>0?this._winnerRank-this._winners.length:0}),this._isRunning&&this._marbles.length>0&&this._noMoveDuration>3e3?this._changeShakeAvailable(!0):this._changeShakeAvailable(!1)),this._render(),window.requestAnimationFrame(this._update)}_updateMarbles(t){if(!this._stage)return;for(let t=this._world.getContactList();t;t=t.getNext())t.isTouching()&&[t.getFixtureA(),t.getFixtureB()].forEach(t=>{let e=t.getBody(),i=e.getUserData();i&&(i instanceof m?(i.impact+=200,i.impact>500&&(i.impact=500)):"isTemporary"in i&&i.isTemporary&&(this._world.destroyBody(e),this._objects=this._objects.filter(t=>t!==e)))});for(let i=0;i<this._marbles.length;i++){let s=this._marbles[i];s.update(t),s.skill===e.Impact&&(this._effects.push(new p(s.x,s.y)),this._marbles.filter(t=>t!==s&&100>t.position.clone().sub(s.position).lengthSquared()).forEach(t=>{let e=t.position.clone().sub(s.position),i=e.clone();i.normalize();let o=1-e.length()/10;i.mul(o*o*5),t.body.applyLinearImpulse(i,s.position)})),s.y>this._stage.goalY&&(this._winners.push(s),this._isRunning&&this._winners.length===this._winnerRank+1?(this.dispatchEvent(new CustomEvent("goal",{detail:{winner:s.name}})),this._winner=s,this._isRunning=!1,this._particleManager.shot(this._renderer.width,this._renderer.height),setTimeout(()=>{this._recorder.stop()},1e3)):this._isRunning&&this._winnerRank===this._winners.length&&this._winnerRank===this._totalMarbleCount-1&&(this.dispatchEvent(new CustomEvent("goal",{detail:{winner:this._marbles[i+1].name}})),this._winner=this._marbles[i+1],this._isRunning=!1,this._particleManager.shot(this._renderer.width,this._renderer.height),setTimeout(()=>{this._recorder.stop()},1e3)),setTimeout(()=>{this._world.destroyBody(s.body)},500))}let i=this._winnerRank-this._winners.length,s=this._marbles[i]?this._marbles[i].y:0;this._goalDist=Math.abs(this._stage.zoomY-s),this._timeScale=this._calcTimeScale(),this._marbles=this._marbles.filter(t=>t.y<=this._stage.goalY),.1>this._marbles.reduce((t,e)=>Math.max(t,e.body.getLinearVelocity().length()),0)?this._noMoveDuration+=t:this._noMoveDuration=0}_calcTimeScale(){if(!this._stage)return 1;let t=this._winnerRank-this._winners.length;return this._winners.length<this._winnerRank+1&&this._goalDist<5&&this._marbles[t].y>this._stage.zoomY-6&&(this._marbles[t-1]||this._marbles[t+1])?Math.max(.2,this._goalDist/5):1}_updateEffects(t){this._effects.forEach(e=>e.update(t)),this._effects=this._effects.filter(t=>!t.isDestroy)}_render(){if(!this._stage)return;let t={camera:this._camera,stage:this._stage,objects:this._objects,marbles:this._marbles,winners:this._winners,particleManager:this._particleManager,effects:this._effects,winnerRank:this._winnerRank,winner:this._winner,size:(0,s.Vec2)(this._renderer.width,this._renderer.height)};this._renderer.render(t,this._uiObjects)}_init(){this._recorder=new v(this._renderer.canvas),this._world=new s.World({gravity:new s.Vec2(0,10)}),this.addUiObject(new y),this.attachEvent();let t=new f;t.onViewportChange(t=>{t?(this._camera.setPosition(t,!1),this._camera.lock(!0)):this._camera.lock(!1)}),this.addUiObject(t),this._stage=_[0],this._loadMap()}attachEvent(){this._renderer.canvas.addEventListener("mousemove",t=>{let e=this._renderer.sizeFactor,i={x:t.offsetX*e,y:t.offsetY*e};this._uiObjects.forEach(t=>{if(!t.onMouseMove)return;let e=t.getBoundingBox();e?e&&i.x>=e.x&&i.y>=e.y&&i.x<=e.x+e.w&&i.y<=e.y+e.h?t.onMouseMove({x:i.x-e.x,y:i.y-e.y}):t.onMouseMove(void 0):t.onMouseMove({...i})})})}_loadMap(){if(!this._stage)throw Error("No map has been selected");this._stageObjects=[];let{walls:t,boxes:e,wheels:i,jumpers:o}=this._stage;t.forEach(t=>{let e=this._world.createBody({type:"static"});e.setPosition(new s.Vec2(0,0)),e.createFixture({shape:s.Chain(t.map(t=>new s.Vec2(...t)),!1)}),this._stageObjects.push(e)}),i.forEach(t=>{let e=function(t,e,i,o,n){let r=t.createKinematicBody({position:e});return r.createFixture({shape:new s.Box(n||2,.1,o||new s.Vec2),restitution:.7}),r.setAngularVelocity(i),r}(this._world,new s.Vec2(t[0],t[1]),t[2],void 0!==t[3]&&void 0!==t[4]?new s.Vec2(t[3],t[4]):void 0,t[5]??void 0);this._objects.push(e),this._stageObjects.push(e)}),e.forEach(t=>{let e=function(t,e,i,o=.5,n=.25){let r=t.createBody({type:"static",position:e});return r.createFixture({shape:new s.Box(o,n)}),r.setAngle(i),r}(this._world,new s.Vec2(t[0],t[1]),t[2],t[3],t[4]);this._objects.push(e),this._stageObjects.push(e)}),o&&o.forEach(t=>{let e=function(t,e,i,o=!1){let n=t.createBody({position:e});return n.createFixture({shape:new s.Circle(new s.Vec2,i),restitution:1.5}),n.setUserData({isTemporary:o}),n}(this._world,new s.Vec2(t[0],t[1]),t[2],t[3]);this._objects.push(e),this._stageObjects.push(e)})}clearMarbles(){this._marbles.forEach(t=>{this._world.destroyBody(t.body)}),this._winner=null,this._winners=[],this._marbles=[]}start(){this._isRunning=!0,this._winnerRank=a.winningRank,this._winnerRank>=this._marbles.length&&(this._winnerRank=this._marbles.length-1),this._autoRecording?this._recorder.start().then(()=>{this._marbles.forEach(t=>t.body.setActive(!0))}):this._marbles.forEach(t=>t.body.setActive(!0))}setSpeed(t){if(t<=0)throw Error("Speed multiplier must larger than 0");this._speed=t}getSpeed(){return this._speed}setWinningRank(t){this._winnerRank=t}setAutoRecording(t){this._autoRecording=t}setMarbles(t){this.reset();let e=t.slice(),i=-1/0,s=1/0,o=e.map(t=>{let e=function(t){let e=/(\/\d+)/,i=/(\*\d+)/,s=e.test(t),o=i.test(t),r=n(/^\s*([^\/*]+)?/,t);return r?{name:r,weight:s?parseInt(n(e,t).replace("/","")):1,count:o?parseInt(n(i,t).replace("*","")):1}:null}(t);if(!e)return null;let{name:o,weight:r,count:a}=e;return r>i&&(i=r),r<s&&(s=r),{name:o,weight:r,count:a}}).filter(t=>!!t),r=i-s,a=0;o.forEach(t=>{t&&(t.weight=.1+(r?(t.weight-s)/r:0),a+=t.count)});let h=Array(a).fill(0).map((t,e)=>e).sort(()=>Math.random()-.5);o.forEach(t=>{if(t)for(let e=0;e<t.count;e++){let e=h.pop()||0;this._marbles.push(new m(this._world,e,a,t.name,t.weight))}}),this._totalMarbleCount=a}_clearMap(){for(let t=this._world.getBodyList();t;t=t.getNext())this._world.destroyBody(t);this._objects=[],this._marbles=[]}reset(){this.clearMarbles(),this._clearMap(),this._loadMap(),this._goalDist=1/0}getCount(){return this._marbles.length}_changeShakeAvailable(t){this._shakeAvailable!==t&&(this._shakeAvailable=t,this.dispatchEvent(new CustomEvent("shakeAvailableChanged",{detail:t})))}shake(){if(!this._shakeAvailable)return;let t=new s.Vec2((Math.random()-.5)*4,(Math.random()-.5)*4);this._stageObjects.forEach(e=>{let i=e.getContactList();for(;i;)i.other&&i.other.applyLinearImpulse(t,i.other.getPosition()),i=i.next||null}),this._camera.setPosition(this._camera.position.add(t))}getMaps(){return _.map((t,e)=>({index:e,title:t.title}))}setMap(t){if(t<0||t>_.length-1)throw Error("Incorrect map number");let e=this._marbles.map(t=>t.name);this._stage=_[t],this.setMarbles(e)}}t([d],x.prototype,"_update",null);const g=new x;window.roullete=g,window.options=a;
//# sourceMappingURL=index.8efdd510.js.map
