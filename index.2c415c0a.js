let t;function e(t,e,i,s){Object.defineProperty(t,e,{get:i,set:s,enumerable:!0,configurable:!0})}var i,s=globalThis,o={},a={},n=s.parcelRequire94c2;null==n&&((n=function(t){if(t in o)return o[t].exports;if(t in a){var e=a[t];delete a[t];var i={id:t,exports:{}};return o[t]=i,e.call(i.exports,i,i.exports),i.exports}var s=Error("Cannot find module '"+t+"'");throw s.code="MODULE_NOT_FOUND",s}).register=function(t,e){a[t]=e},s.parcelRequire94c2=n);var r=n.register;r("27Lyk",function(t,i){e(t.exports,"register",()=>s,t=>s=t),e(t.exports,"resolve",()=>o,t=>o=t);var s,o,a=new Map;s=function(t,e){for(var i=0;i<e.length-1;i+=2)a.set(e[i],{baseUrl:t,path:e[i+1]})},o=function(t){var e=a.get(t);if(null==e)throw Error("Could not resolve bundle with id "+t);return new URL(e.path,e.baseUrl).toString()}}),r("4zFxA",function(t,e){var i=n("Gr8vk");t.exports=Promise.all([i("itWg3"),i("8BShk")]).then(()=>n("jaZ7o"))}),r("Gr8vk",function(t,e){t.exports=function(t){return import(n("27Lyk").resolve(t))}}),r("4Ppm5",function(t,e){var i=n("Gr8vk");t.exports=Promise.all([i("itWg3"),i("ilUZb")]).then(()=>n("6fGU3"))}),n("27Lyk").register(new URL("",import.meta.url).toString(),JSON.parse('["1LzKV","index.2c415c0a.js","cdgIR","chamru.d6926a56.png","8BShk","Box2D.simd.16878029.js","2rDQN","Box2D.simd.dd31b167.wasm","itWg3","Box2D.simd.110e63da.js","ilUZb","Box2D.325387e0.js","h7cmx","Box2D.b9b16b27.wasm"]'));const h={en:{"Enter names below":"Enter names below",Shuffle:"Shuffle",Start:"Start",Map:"Map",Recording:"Recording","The winner is":"The winner is","Using skills":"Using skills","Buy me a coffee":"Buy me a coffee",First:"First",Last:"Last","Wheel of fortune":"Wheel of fortune",BubblePop:"BubblePop","Pot of greed":"Pot of greed","Shake!":"Shake!","Input names separated by commas or line feed here":"Input names separated by commas or line feed here"},ko:{"Enter names below":"이름들을 입력하세요",Shuffle:"섞기",Start:"시작",Map:"맵",Recording:"녹화","The winner is":"당첨 순위","Using skills":"스킬 활성화","Buy me a coffee":"개발자에게 커피 사주기",First:"첫번째",Last:"마지막","Wheel of fortune":"운명의 수레바퀴",BubblePop:"버블팝","Pot of greed":"욕망의 항아리","Shake!":"흔들기!","Input names separated by commas or line feed here":"이름들을 쉼표나 엔터로 구분해서 넣어주세요"}};function l(e){if(!(e instanceof HTMLElement)||!t)return;let i=e.getAttribute("data-trans");if(i){let s=(e.getAttribute(i)||"").trim();s&&s in h[t]&&e.setAttribute(i,h[t][s])}else{let i=e.innerText.trim();i&&i in h[t]&&(e.innerText=h[t][i])}}function p(t,e,i,s){var o,a=arguments.length,n=a<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,i,s);else for(var r=t.length-1;r>=0;r--)(o=t[r])&&(n=(a<3?o(n):a>3?o(e,i,n):o(e,i))||n);return a>3&&n&&Object.defineProperty(e,i,n),n}document.addEventListener("DOMContentLoaded",()=>{console.log("localization loaded");let e=navigator.language.split("-")[0];console.log("detected locale: ",e),function(e){if(e===t)return;document.documentElement.lang=e;let i=e.toLocaleLowerCase();t=i in h?i:"en",document.querySelectorAll("[data-trans]").forEach(l)}(e)}),window.translateElement=l;var c=((i={})[i.None=0]="None",i[i.Impact=1]="Impact",i);const y={box:"cyan",circle:"yellow"};function d(t){return Math.PI*t/180}function u(t,e){let i=t.exec(e);return i?i[1]:""}function g(t){return t.toString().padStart(2,"0")}const x=new class{constructor(){this.useSkills=!0,this.winningRank=0,this.autoRecording=!0}};class _{static sub(t,e){return{x:e.x-t.x,y:e.y-t.y}}static lenSq(t){return t.x*t.x+t.y*t.y}static len(t){return Math.sqrt(this.lenSq(t))}static mul(t,e){return{x:t.x*e,y:t.y*e}}static add(t,e){return{x:t.x+e.x,y:t.y+e.y}}}class m{get position(){return this.physics.getMarblePosition(this.id)||{x:0,y:0,angle:0}}get x(){return this.position.x}set x(t){this.position.x=t}get y(){return this.position.y}set y(t){this.position.y=t}get angle(){return this.position.angle}constructor(t,e,i,s,o=1){this.type="marble",this.name="",this.size=.5,this.color="red",this.hue=0,this.impact=0,this.weight=1,this.skill=c.None,this.isActive=!1,this._skillRate=5e-4,this._coolTime=5e3,this._maxCoolTime=5e3,this._stuckTime=0,this.lastPosition={x:0,y:0},this.name=s||`M${e}`,this.weight=o,this.physics=t,this._maxCoolTime=1e3+(1-this.weight)*4e3,this._coolTime=this._maxCoolTime*Math.random(),this._skillRate=.2*this.weight;let a=Math.ceil(i/10),n=Math.floor(e/10),r=-Math.max(0,Math.ceil(a-5));this.hue=360/i*e,this.color=`hsl(${this.hue} 100% 70%)`,this.id=e,t.createMarble(e,10.25+e%10*.6,a-n+r)}update(t){this.isActive&&1e-5>_.lenSq(_.sub(this.lastPosition,this.position))?(this._stuckTime+=t,this._stuckTime>5e3&&(this.physics.shakeMarble(this.id),this._stuckTime=0)):this._stuckTime=0,this.lastPosition={x:this.position.x,y:this.position.y},this.skill=c.None,this.impact&&(this.impact=Math.max(0,this.impact-t)),this.isActive&&x.useSkills&&this._updateSkillInformation(t)}_updateSkillInformation(t){this._coolTime>0&&(this._coolTime-=t),this._coolTime<=0&&(this.skill=Math.random()<this._skillRate?c.Impact:c.None,this._coolTime=this._maxCoolTime)}render(t,e,i,s=!1,o){t.save(),s?this._renderMinimap(t):this._renderNormal(t,e,i,o),t.restore()}_renderMinimap(t){t.fillStyle=this.color,this._drawMarbleBody(t,!0)}_drawMarbleBody(t,e){t.beginPath(),t.arc(this.x,this.y,e?this.size:this.size/2,0,2*Math.PI),t.fill()}_renderNormal(t,e,i,s){if(t.fillStyle=`hsl(${this.hue} 100% ${70+25*Math.min(1,this.impact/500)}%`,this._stuckTime>0&&(t.fillStyle=`hsl(${this.hue} 100% ${70+25*Math.min(1,this._stuckTime/5e3)}%`),t.shadowColor=this.color,t.shadowBlur=e/2,s){let e=this.size/2;t.save(),t.translate(this.x,this.y),t.rotate(this.angle),t.drawImage(s,-e,-e,2*e,2*e),t.restore()}else this._drawMarbleBody(t,!1);t.shadowColor="",t.shadowBlur=0,this._drawName(t,e),i&&this._drawOutline(t,2/e),x.useSkills&&this._renderCooltime(t,e)}_drawName(t,e){t.save(),t.translate(this.x,this.y+.25),t.scale(1/e,1/e),t.font="12pt sans-serif",t.strokeStyle="black",t.lineWidth=2,t.fillStyle=this.color,t.shadowBlur=0,t.strokeText(this.name,0,0),t.fillText(this.name,0,0),t.restore()}_drawOutline(t,e){t.save(),t.beginPath(),t.strokeStyle="white",t.lineWidth=e,t.arc(this.x,this.y,this.size/2,0,2*Math.PI),t.stroke(),t.restore()}_renderCooltime(t,e){t.strokeStyle="red",t.lineWidth=1/e,t.beginPath(),t.arc(this.x,this.y,this.size/2+2/e,d(270),d(270+360*this._coolTime/this._maxCoolTime)),t.stroke()}_renderStuck(t,e){t.strokeStyle="green",t.lineWidth=1/e,t.beginPath(),t.arc(this.x,this.y,this.size/2+3/e,d(270),d(270+360*(1-this._stuckTime/5e3))),t.stroke()}}class w{constructor(t,e){this._elapsed=0,this.position={x:0,y:0},this.force={x:0,y:0},this.color="",this.isDestroy=!1,this.position.x=t,this.position.y=e;let i=250*Math.random(),s=d(90*Math.random()-180),o=Math.cos(s)*i,a=Math.sin(s)*i;this.color=`hsl(${360*Math.random()} 50% 50%)`,this.force={x:o,y:a}}update(t){this._elapsed+=t;let e=_.mul(this.force,t/100);this.position=_.add(this.position,e),this.force.y+=10*t/100,this._elapsed>3e3&&(this.isDestroy=!0)}render(t){t.save(),t.globalAlpha=1-Math.pow(this._elapsed/3e3,2),t.fillStyle=this.color,t.fillRect(this.position.x,this.position.y,20,20),t.restore()}}class b{update(t){this._particles.forEach(e=>{e.update(t)}),this._particles=this._particles.filter(t=>!t.isDestroy)}render(t){this._particles.forEach(e=>e.render(t))}shot(t,e){for(let i=0;i<200;i++)this._particles.push(new w(t,e))}constructor(){this._particles=[]}}const f=[{title:"Wheel of fortune",goalY:111,zoomY:106.75,walls:[[[16.5,-300],[9.25,-300],[9.25,8.5],[2,19.25],[2,26],[9.75,30],[9.75,33.5],[1.25,41],[1.25,53.75],[8.25,58.75],[8.25,63],[9.25,64],[8.25,65],[8.25,99.25],[15.1,106.75],[15.1,111.75]],[[16.5,-300],[16.5,9.25],[9.5,20],[9.5,22.5],[17.5,26],[17.5,33.5],[24,38.5],[19,45.5],[19,55.5],[24,59.25],[24,63],[23,64],[24,65],[24,100.5],[16,106.75],[16,111.75]],[[12.75,37.5],[7,43.5],[7,49.75],[12.75,53.75],[12.75,37.5]],[[14.75,37.5],[14.75,43],[17.5,40.25],[14.75,37.5]]],entities:[{position:{x:15.5,y:30},shape:{type:"box",width:.2,height:.2,rotation:-45},type:"static",props:{density:1,angularVelocity:0,restitution:1}},{position:{x:15.5,y:32},type:"static",shape:{type:"box",width:.2,height:.2,rotation:-45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:15.5,y:28},type:"static",shape:{type:"box",width:.2,height:.2,rotation:-45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:12.5,y:30},type:"static",shape:{type:"box",width:.2,height:.2,rotation:-45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:12.5,y:32},type:"static",shape:{type:"box",width:.2,height:.2,rotation:-45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:12.5,y:28},type:"static",shape:{type:"box",width:.2,height:.2,rotation:-45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:9.4,y:66.6},type:"static",shape:{type:"box",width:.6,height:.1,rotation:45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:11.3,y:66.6},type:"static",shape:{type:"box",width:.6,height:.1,rotation:45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:13.2,y:66.6},type:"static",shape:{type:"box",width:.6,height:.1,rotation:45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:15.1,y:66.6},type:"static",shape:{type:"box",width:.6,height:.1,rotation:45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:17,y:66.6},type:"static",shape:{type:"box",width:.6,height:.1,rotation:45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:18.9,y:66.6},type:"static",shape:{type:"box",width:.6,height:.1,rotation:45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:20.699999999999996,y:66.6},type:"static",shape:{type:"box",width:.6,height:.1,rotation:45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:22.7,y:66.6},type:"static",shape:{type:"box",width:.6,height:.1,rotation:45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:9.4,y:69.1},type:"static",shape:{type:"box",width:.6,height:.1,rotation:-45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:11.3,y:69.1},type:"static",shape:{type:"box",width:.6,height:.1,rotation:-45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:13.2,y:69.1},type:"static",shape:{type:"box",width:.6,height:.1,rotation:-45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:15.1,y:69.1},type:"static",shape:{type:"box",width:.6,height:.1,rotation:-45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:17,y:69.1},type:"static",shape:{type:"box",width:.6,height:.1,rotation:-45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:18.9,y:69.1},type:"static",shape:{type:"box",width:.6,height:.1,rotation:-45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:20.699999999999996,y:69.1},type:"static",shape:{type:"box",width:.6,height:.1,rotation:-45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:22.7,y:69.1},type:"static",shape:{type:"box",width:.6,height:.1,rotation:-45},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:9.5,y:92},type:"static",shape:{type:"box",width:.25,height:.25,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:12.75,y:92},type:"static",shape:{type:"box",width:.25,height:.25,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:16,y:92},type:"static",shape:{type:"box",width:.25,height:.25,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:19.25,y:92},type:"static",shape:{type:"box",width:.25,height:.25,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:22.5,y:92},type:"static",shape:{type:"box",width:.25,height:.25,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:11,y:95},type:"static",shape:{type:"box",width:.25,height:.25,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:14.25,y:95},type:"static",shape:{type:"box",width:.25,height:.25,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:17.5,y:95},type:"static",shape:{type:"box",width:.25,height:.25,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:20.75,y:95},type:"static",shape:{type:"box",width:.25,height:.25,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:9.5,y:98},type:"static",shape:{type:"box",width:.25,height:.25,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:12.75,y:98},type:"static",shape:{type:"box",width:.25,height:.25,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:16,y:98},type:"static",shape:{type:"box",width:.25,height:.25,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:19.25,y:98},type:"static",shape:{type:"box",width:.25,height:.25,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:22.5,y:98},type:"static",shape:{type:"box",width:.25,height:.25,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:8,y:75},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:3.5,restitution:0}},{position:{x:12,y:75},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:-3.5,restitution:0}},{position:{x:16,y:75},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:3.5,restitution:0}},{position:{x:20,y:75},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:-3.5,restitution:0}},{position:{x:24,y:75},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:3.5,restitution:0}},{position:{x:14,y:106.75},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:-1.2,restitution:0}}]},{title:"BubblePop",goalY:83,zoomY:78,walls:[[[16.5,-300],[9.25,-300],[9.25,0],[9.25,43],[4.25,50],[9.25,53],[9.25,75],[12,80],[12,83]],[[16.5,-300],[16.5,50],[19.5,54],[18.5,56],[19.5,58],[16.5,61],[16.5,75],[13,80],[13,83]],[[16.5,52.5],[17.5,54],[16.5,56],[17.5,58],[16.5,59],[15.5,56],[16.5,52.5]],[[9.25,45.5],[6.25,49.5],[9.25,51],[14.5,50.5],[9.25,45.5]],[[9.25,26],[11.0625,27.5]],[[16.5,26],[14.6875,27.5]],[[11.0625,30],[12.875,28.5],[14.6875,30]],[[9.25,31],[11.0625,32.5]],[[16.5,31],[14.6875,32.5]],[[11.0625,35],[12.875,33.5],[14.6875,35]]],entities:[{position:{x:9.25,y:18},type:"static",shape:{type:"box",width:.15,height:.15,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:11.25,y:18},type:"static",shape:{type:"box",width:.15,height:.15,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:13.25,y:18},type:"static",shape:{type:"box",width:.15,height:.15,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:15.25,y:18},type:"static",shape:{type:"box",width:.15,height:.15,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:10.5,y:19},type:"static",shape:{type:"box",width:.15,height:.15,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:12.5,y:19},type:"static",shape:{type:"box",width:.15,height:.15,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:14.5,y:19},type:"static",shape:{type:"box",width:.15,height:.15,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:16.5,y:19},type:"static",shape:{type:"box",width:.15,height:.15,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:9.25,y:20},type:"static",shape:{type:"box",width:.15,height:.15,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:11.25,y:20},type:"static",shape:{type:"box",width:.15,height:.15,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:13.25,y:20},type:"static",shape:{type:"box",width:.15,height:.15,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:15.25,y:20},type:"static",shape:{type:"box",width:.15,height:.15,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:10.5,y:21},type:"static",shape:{type:"box",width:.15,height:.15,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:12.5,y:21},type:"static",shape:{type:"box",width:.15,height:.15,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:14.5,y:21},type:"static",shape:{type:"box",width:.15,height:.15,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:16.5,y:21},type:"static",shape:{type:"box",width:.15,height:.15,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:9.25,y:22},type:"static",shape:{type:"box",width:.15,height:.15,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:11.25,y:22},type:"static",shape:{type:"box",width:.15,height:.15,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:13.25,y:22},type:"static",shape:{type:"box",width:.15,height:.15,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:15.25,y:22},type:"static",shape:{type:"box",width:.15,height:.15,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:10.5,y:23},type:"static",shape:{type:"box",width:.15,height:.15,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:12.5,y:23},type:"static",shape:{type:"box",width:.15,height:.15,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:14.5,y:23},type:"static",shape:{type:"box",width:.15,height:.15,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:16.5,y:23},type:"static",shape:{type:"box",width:.15,height:.15,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:9.4,y:39},type:"static",shape:{type:"box",width:3,height:3,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:16.5,y:43},type:"static",shape:{type:"box",width:3,height:3,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:10.7,y:10},type:"kinematic",shape:{type:"box",width:.5,height:.1,rotation:0},props:{density:1,angularVelocity:10,restitution:0}},{position:{x:14.7,y:10},type:"kinematic",shape:{type:"box",width:.5,height:.1,rotation:0},props:{density:1,angularVelocity:-10,restitution:0}},{position:{x:12.7,y:10},type:"kinematic",shape:{type:"box",width:.5,height:.1,rotation:0},props:{density:1,angularVelocity:10,restitution:0}},{position:{x:10.7,y:14},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:-3,restitution:0}},{position:{x:14.7,y:14},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:3,restitution:0}},{position:{x:11.2,y:44},type:"kinematic",shape:{type:"box",width:.5,height:.1,rotation:0},props:{density:1,angularVelocity:-5,restitution:0}},{position:{x:10.3,y:75},type:"kinematic",shape:{type:"box",width:1,height:.1,rotation:0},props:{density:1,angularVelocity:8,restitution:0}},{position:{x:15.2,y:75},type:"kinematic",shape:{type:"box",width:1,height:.1,rotation:0},props:{density:1,angularVelocity:-8,restitution:0}},{position:{x:11,y:65},type:"static",shape:{type:"circle",radius:.5},props:{density:1,angularVelocity:0,restitution:1.5,life:1}},{position:{x:13,y:65},type:"static",shape:{type:"circle",radius:.5},props:{density:1,angularVelocity:0,restitution:1.5,life:1}},{position:{x:15,y:65},type:"static",shape:{type:"circle",radius:.5},props:{density:1,angularVelocity:0,restitution:1.5,life:1}},{position:{x:12,y:67.5},type:"static",shape:{type:"circle",radius:.5},props:{density:1,angularVelocity:0,restitution:1.5,life:1}},{position:{x:14,y:67.5},type:"static",shape:{type:"circle",radius:.5},props:{density:1,angularVelocity:0,restitution:1.5,life:1}},{position:{x:13,y:71},type:"static",shape:{type:"circle",radius:.8},props:{density:1,angularVelocity:0,restitution:1.5,life:1}},{position:{x:10.7,y:77.5},type:"static",shape:{type:"circle",radius:.8},props:{density:1,angularVelocity:0,restitution:1.5,life:1}},{position:{x:14.7,y:77.5},type:"static",shape:{type:"circle",radius:.8},props:{density:1,angularVelocity:0,restitution:1.5,life:1}},{position:{x:12.625,y:80},type:"static",shape:{type:"circle",radius:1.5},props:{density:1,angularVelocity:0,restitution:1.5,life:1}},{position:{x:12.625,y:80},type:"static",shape:{type:"circle",radius:1.2},props:{density:1,angularVelocity:0,restitution:1.5,life:1}}]},{title:"Pot of greed",goalY:111,zoomY:110,walls:[[[17,-300],[9,-300],[9,8.5],[2,15],[6,61.5]],[[7,71],[9,101],[8,100.5],[6,100],[5,90],[4,70],[7,71]],[[17,-300],[17,8.5],[24,15],[20,61.5]],[[19,71],[17,101],[18,100.5],[20,100],[21,90],[22,70],[19,71]],[[11,88],[12,90],[12,112]],[[15,88],[14,90],[14,112]],[[12,102],[11,103],[9,104],[8,104],[6,103],[5,102],[4,100],[3,90],[2,70],[3,65],[4,63],[5,62],[6,61.5]],[[14,102],[15,103],[17,104],[18,104],[20,103],[21,102],[22,100],[23,90],[24,70],[23,65],[22,63],[21,62],[20,61.5]]],entities:[{position:{x:13,y:20},type:"static",shape:{type:"box",width:3,height:3,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:13,y:55},type:"static",shape:{type:"box",width:3,height:3,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:8,y:37},type:"static",shape:{type:"box",width:2,height:2,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:18,y:37},type:"static",shape:{type:"box",width:2,height:2,rotation:.7853981633974483},props:{density:1,angularVelocity:0,restitution:0}},{position:{x:11,y:12},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:-3,restitution:0}},{position:{x:15,y:12},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:3,restitution:0}},{position:{x:8,y:104},type:"kinematic",shape:{type:"box",width:1,height:.1,rotation:0},props:{density:1,angularVelocity:-10,restitution:0}},{position:{x:6,y:103},type:"kinematic",shape:{type:"box",width:1.5,height:.1,rotation:0},props:{density:1,angularVelocity:-10,restitution:0}},{position:{x:4,y:100},type:"kinematic",shape:{type:"box",width:1.5,height:.1,rotation:0},props:{density:1,angularVelocity:-10,restitution:0}},{position:{x:3.5,y:95},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:-10,restitution:0}},{position:{x:3,y:90},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:-10,restitution:0}},{position:{x:2.75,y:85},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:-10,restitution:0}},{position:{x:2.5,y:80},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:-10,restitution:0}},{position:{x:2.25,y:75},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:-10,restitution:0}},{position:{x:2,y:70},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:-10,restitution:0}},{position:{x:18,y:104},type:"kinematic",shape:{type:"box",width:1,height:.1,rotation:0},props:{density:1,angularVelocity:10,restitution:0}},{position:{x:20,y:103},type:"kinematic",shape:{type:"box",width:1.5,height:.1,rotation:0},props:{density:1,angularVelocity:10,restitution:0}},{position:{x:22,y:100},type:"kinematic",shape:{type:"box",width:1.5,height:.1,rotation:0},props:{density:1,angularVelocity:10,restitution:0}},{position:{x:22.5,y:95},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:10,restitution:0}},{position:{x:23,y:90},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:10,restitution:0}},{position:{x:23.25,y:85},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:10,restitution:0}},{position:{x:23.5,y:80},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:10,restitution:0}},{position:{x:23.75,y:75},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:10,restitution:0}},{position:{x:24,y:70},type:"kinematic",shape:{type:"box",width:2,height:.1,rotation:0},props:{density:1,angularVelocity:10,restitution:0}}]}];class v{get zoom(){return this._zoom}set zoom(t){this._targetZoom=t}get x(){return this._position.x}set x(t){this._targetPosition.x=t}get y(){return this._position.y}set y(t){this._targetPosition.y=t}get position(){return this._position}setPosition(t,e=!1){return e?this._position={x:t.x,y:t.y}:this._targetPosition={x:t.x,y:t.y}}lock(t){this._locked=t}update({marbles:t,stage:e,needToZoom:i,targetIndex:s}){this._locked||this._calcTargetPositionAndZoom(t,e,i,s),this._position.x=this._interpolation(this.x,this._targetPosition.x),this._position.y=this._interpolation(this.y,this._targetPosition.y),this._zoom=this._interpolation(this._zoom,this._targetZoom)}_calcTargetPositionAndZoom(t,e,i,s){if(t.length>0){let o=t[s]?t[s]:t[0];if(this.setPosition(o.position),i){let t=Math.abs(e.zoomY-this._position.y);this.zoom=Math.max(1,(1-t/5)*4)}else this.zoom=1}else this.setPosition({x:0,y:0}),this.zoom=1}_interpolation(t,e){let i=e-t;return .03333333333333333>Math.abs(i)?e:t+i/10}renderScene(t,e){let i=60*this._zoom;t.save(),t.translate(-this.x*this._zoom,-this.y*this._zoom),t.scale(this.zoom,this.zoom),t.translate(t.canvas.width/i,t.canvas.height/i),e(t),t.restore()}constructor(){this._position={x:0,y:0},this._targetPosition={x:0,y:0},this._zoom=1,this._targetZoom=1,this._locked=!1}}var k={};k=new URL("chamru.d6926a56.png",import.meta.url).toString();class V{constructor(){this.sizeFactor=1,this._images={}}get width(){return this._canvas.width}get height(){return this._canvas.height}get canvas(){return this._canvas}async init(){await this._load(),this._canvas=document.createElement("canvas"),this._canvas.width=1600,this._canvas.height=900,this.ctx=this._canvas.getContext("2d",{alpha:!1}),document.body.appendChild(this._canvas);let t=t=>{let e=t?t[0].contentRect:this._canvas.getBoundingClientRect(),i=Math.max(e.width/2,640),s=i/e.width*e.height;this._canvas.width=i,this._canvas.height=s,this.sizeFactor=i/e.width};new ResizeObserver(t).observe(this._canvas),t()}async _load(){return new Promise(t=>{let e=new URL(k);this._images["챔루"]=new Image,this._images["챔루"].src=e.toString(),this._images["챔루"].addEventListener("load",()=>{t()})})}render(t,e){this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this._canvas.width,this._canvas.height),this.ctx.save(),this.ctx.scale(30,30),this.ctx.textAlign="left",this.ctx.textBaseline="top",this.ctx.font="0.4pt sans-serif",this.ctx.lineWidth=3/(t.camera.zoom+30),t.camera.renderScene(this.ctx,()=>{this._renderWalls({...t}),this.renderEntities(t.entities),this.renderEffects(t),this.renderMarbles(t)}),this.ctx.restore(),e.forEach(e=>e.render(this.ctx,t,this._canvas.width,this._canvas.height)),t.particleManager.render(this.ctx),this.renderWinner(t)}_renderWalls({stage:t,camera:e}){t&&(this.ctx.save(),this.ctx.strokeStyle="white",this.ctx.lineWidth=5/(e.zoom+30),this.ctx.beginPath(),t.walls.forEach(t=>{this.ctx.moveTo(t[0][0],t[0][1]);for(let e=1;e<t.length;e++)this.ctx.lineTo(t[e][0],t[e][1])}),this.ctx.shadowColor="cyan",this.ctx.shadowBlur=15,this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore())}renderEntities(t){this.ctx.save(),t.forEach(t=>{this.ctx.save(),this.ctx.translate(t.x,t.y),this.ctx.rotate(t.angle),this.ctx.save(),this.ctx.fillStyle=y[t.shape.type],this.ctx.strokeStyle=y[t.shape.type];let e=t.shape;switch(e.type){case"box":let i=2*e.width,s=2*e.height;this.ctx.rotate(e.rotation),this.ctx.fillRect(-i/2,-s/2,i,s),this.ctx.shadowBlur=15,this.ctx.shadowColor=y[t.shape.type],this.ctx.strokeRect(-i/2,-s/2,i,s);break;case"circle":this.ctx.beginPath(),this.ctx.arc(0,0,e.radius,0,2*Math.PI,!1),this.ctx.shadowBlur=15,this.ctx.shadowColor=y[t.shape.type],this.ctx.stroke()}this.ctx.restore(),this.ctx.restore()}),this.ctx.restore()}renderEffects({effects:t,camera:e}){t.forEach(t=>t.render(this.ctx,30*e.zoom))}renderMarbles({marbles:t,camera:e,winnerRank:i,winners:s}){let o=i-s.length;t.forEach((t,i)=>{t.render(this.ctx,30*e.zoom,i===o,!1,this._images[t.name]||void 0)})}renderWinner({winner:t}){t&&(this.ctx.save(),this.ctx.fillStyle="rgba(0, 0, 0, 0.5)",this.ctx.fillRect(this._canvas.width/2,this._canvas.height-168,this._canvas.width/2,168),this.ctx.fillStyle="white",this.ctx.font="bold 48px sans-serif",this.ctx.textAlign="right",this.ctx.fillText("Winner",this._canvas.width-10,this._canvas.height-120),this.ctx.font="bold 72px sans-serif",this.ctx.fillStyle=t.color,this.ctx.fillText(t.name,this._canvas.width-10,this._canvas.height-55),this.ctx.restore())}}class M{constructor(t,e){this._size=0,this._elapsed=0,this.isDestroy=!1,this.position={x:t,y:e}}update(t){this._elapsed+=t,this._size=this._elapsed/500*10,this._elapsed>500&&(this.isDestroy=!0)}render(t,e){t.save();let i=this._elapsed/500;t.globalAlpha=1-i*i,t.strokeStyle="white",t.lineWidth=1/e,t.beginPath(),t.arc(this.position.x,this.position.y,this._size,0,2*Math.PI),t.stroke(),t.restore()}}function S(t,e,i){return{configurable:!0,get(){let t=i.value.bind(this);return Object.defineProperty(this,e,{value:t,configurable:!0,writable:!0}),t}}}class R{constructor(){this._currentY=0,this._targetY=0,this.fontHeight=16,this._userMoved=0,this._currentWinner=-1,this.maxY=0}onWheel(t){this._targetY+=t.deltaY,this._targetY>this.maxY&&(this._targetY=this.maxY),this._userMoved=2e3}render(t,{winners:e,marbles:i,winnerRank:s},o,a){let n=o-5,r=Math.max(0,this._currentY-a/2);this.maxY=Math.max(0,(i.length+e.length)*this.fontHeight),this._currentWinner=e.length,t.save(),t.translate(0,-r),t.font="bold 11pt sans-serif",t.textAlign="right",e.forEach((e,i)=>{let o=i*this.fontHeight;o>=r&&o<=r+t.canvas.height&&(t.fillStyle=e.color,t.fillText(`${i===s?"☆":"✔"} ${e.name} #${i+1}`,n,20+o))}),t.font="10pt sans-serif",i.forEach((i,s)=>{let o=(s+e.length)*this.fontHeight;o>=r&&o<=r+t.canvas.height&&(t.fillStyle=i.color,t.fillText(`${i.name} #${s+1+e.length}`,n,20+o))}),t.restore()}update(t){-1!==this._currentWinner&&(this._userMoved>0?this._userMoved-=t:this._targetY=this._currentWinner*this.fontHeight,this._currentY!==this._targetY&&(this._currentY+=(this._targetY-this._currentY)*(t/250)),1>Math.abs(this._currentY-this._targetY)&&(this._currentY=this._targetY))}getBoundingBox(){return null}}p([S],R.prototype,"onWheel",null);class E{constructor(){this.lastParams=null,this._onViewportChangeHandler=null,this.mousePosition=null,this.boundingBox={x:10,y:10,w:104,h:0}}getBoundingBox(){return this.boundingBox}onViewportChange(t){this._onViewportChangeHandler=t}update(){}onMouseMove(t){if(!t){this.mousePosition=null,this._onViewportChangeHandler&&this._onViewportChangeHandler();return}this.lastParams&&(this.mousePosition={x:t.x,y:t.y},this._onViewportChangeHandler&&this._onViewportChangeHandler({x:this.mousePosition.x/4,y:this.mousePosition.y/4}))}render(t,e){if(!t)return;let{stage:i}=e;i&&(this.boundingBox.h=4*i.goalY,this.lastParams=e,this.ctx=t,t.save(),t.fillStyle="#333",t.translate(10,10),t.scale(4,4),t.fillRect(0,0,26,i.goalY),this.ctx.lineWidth=3/(e.camera.zoom+30),this.drawWalls(e),this.drawEntities(e.entities),this.drawMarbles(e),this.drawViewport(e),t.restore(),t.save(),t.strokeStyle="green",t.lineWidth=1,t.strokeRect(this.boundingBox.x,this.boundingBox.y,this.boundingBox.w,this.boundingBox.h),t.restore())}drawViewport(t){this.ctx.save();let{camera:e,size:i}=t,s=30*e.zoom,o=i.x/s,a=i.y/s;this.ctx.strokeStyle="white",this.ctx.lineWidth=1/s,this.ctx.strokeRect(e.x-o/2,e.y-a/2,o,a),this.ctx.restore()}drawWalls(t){t.stage&&(this.ctx.save(),this.ctx.strokeStyle="black",this.ctx.lineWidth=.5,this.ctx.beginPath(),t.stage.walls.forEach(t=>{this.ctx.moveTo(t[0][0],t[0][1]);for(let e=1;e<t.length;e++)this.ctx.lineTo(t[e][0],t[e][1])}),this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore())}drawEntities(t){this.ctx.save(),t.forEach(t=>{this.ctx.save(),this.ctx.fillStyle=y[t.shape.type],this.ctx.strokeStyle=y[t.shape.type],this.ctx.translate(t.x,t.y),this.ctx.rotate(t.angle),this.ctx.save();let e=t.shape;switch(e.type){case"box":let i=2*e.width,s=2*e.height;this.ctx.rotate(e.rotation),this.ctx.fillRect(-i/2,-s/2,i,s);break;case"circle":this.ctx.beginPath(),this.ctx.arc(0,0,e.radius,0,2*Math.PI,!1),this.ctx.stroke()}this.ctx.restore(),this.ctx.restore()}),this.ctx.restore()}drawMarbles(t){let{marbles:e}=t;e.forEach(t=>{t.render(this.ctx,1,!1,!0)})}}p([S],E.prototype,"onMouseMove",null);class B{constructor(t){this.chunks=[],this.stopping=!1,this.targetCanvas=t,this.videoStream=this.targetCanvas.captureStream(),this.mediaRecorder=new MediaRecorder(this.videoStream,{videoBitsPerSecond:6e6})}async start(){return this.stopping=!1,new Promise(t=>{this.chunks=[],this.mediaRecorder.ondataavailable=t=>{this.chunks.push(t.data)},this.mediaRecorder.onstop=()=>{let t=new Blob(this.chunks,{type:"video/webm"}),e=URL.createObjectURL(t),i=document.createElement("a"),s=new Date;i.href=e,i.download=`marble_roulette_${s.getFullYear()}${g(s.getMonth()+1)}${g(s.getDate())}${g(s.getHours())}${g(s.getMinutes())}${g(s.getSeconds())}.webm`,i.click(),i.remove(),URL.revokeObjectURL(e)},this.mediaRecorder.onstart=()=>{t()},this.mediaRecorder.start()})}stop(){this.stopping=!0,"recording"===this.mediaRecorder.state&&this.mediaRecorder.stop()}}var P=async(...t)=>{let e=WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])),{default:i}=await (e?n("4zFxA"):n("4Ppm5"));return await i(...t)};class D{async init(){this.Box2D=await P(),this.gravity=new this.Box2D.b2Vec2(0,10),this.world=new this.Box2D.b2World(this.gravity),console.log("box2d ready")}clear(){this.clearWalls(),this.clearEntities()}clearMarbles(){Object.values(this.marbleMap).forEach(t=>{this.world.DestroyBody(t)}),this.marbleMap={}}createStage(t){this.createWalls(t.walls),this.createEntities(t.entities)}createEntities(t){if(!t)return;let e={static:this.Box2D.b2_staticBody,kinematic:this.Box2D.b2_kinematicBody};t.forEach(t=>{let i;let s=new this.Box2D.b2BodyDef;s.set_type(e[t.type]);let o=this.world.CreateBody(s),a=new this.Box2D.b2FixtureDef;switch(a.set_density(t.props.density),a.set_restitution(t.props.restitution),t.shape.type){case"box":(i=new this.Box2D.b2PolygonShape).SetAsBox(t.shape.width,t.shape.height,0,t.shape.rotation);break;case"circle":(i=new this.Box2D.b2CircleShape).set_m_radius(t.shape.radius)}a.set_shape(i),o.CreateFixture(a),o.SetAngularVelocity(t.props.angularVelocity),o.SetTransform(new this.Box2D.b2Vec2(t.position.x,t.position.y),0),this.entities.push({body:o,x:t.position.x,y:t.position.y,angle:0,shape:t.shape,life:t.props.life??-1})})}clearEntities(){this.entities.forEach(t=>{this.world.DestroyBody(t.body)}),this.entities=[]}createWalls(t){t.forEach(t=>{let e=new this.Box2D.b2BodyDef;e.set_type(this.Box2D.b2_staticBody);let i=this.world.CreateBody(e);for(let e=0;e<t.length-1;e++){let s=t[e],o=t[e+1],a=new this.Box2D.b2Vec2(s[0],s[1]),n=new this.Box2D.b2Vec2(o[0],o[1]),r=new this.Box2D.b2EdgeShape;r.SetTwoSided(a,n),i.CreateFixture(r,1)}this.walls.push(i)})}clearWalls(){this.walls.forEach(t=>{this.world.DestroyBody(t)}),this.walls=[]}createMarble(t,e,i){let s=new this.Box2D.b2CircleShape;s.set_m_radius(.25);let o=new this.Box2D.b2BodyDef;o.set_type(this.Box2D.b2_dynamicBody),o.set_position(new this.Box2D.b2Vec2(e,i));let a=this.world.CreateBody(o);a.CreateFixture(s,1+Math.random()),a.SetAwake(!1),a.SetEnabled(!1),this.marbleMap[t]=a}shakeMarble(t){let e=this.marbleMap[t];e&&e.ApplyLinearImpulseToCenter(new this.Box2D.b2Vec2(10*Math.random()-5,10*Math.random()-5),!0)}removeMarble(t){let e=this.marbleMap[t];e&&(this.world.DestroyBody(e),delete this.marbleMap[t])}getMarblePosition(t){let e=this.marbleMap[t];if(!e)return{x:0,y:0,angle:0};{let t=e.GetPosition();return{x:t.x,y:t.y,angle:e.GetAngle()}}}getEntities(){return this.entities.map(t=>({...t,angle:t.body.GetAngle()}))}impact(t){let e=this.marbleMap[t];e&&Object.values(this.marbleMap).forEach(t=>{if(t===e)return;let i=new this.Box2D.b2Vec2(t.GetPosition().x,t.GetPosition().y);if(i.op_sub(e.GetPosition()),100>i.LengthSquared()){i.Normalize();let e=1-i.Length()/10;i.op_mul(e*e*5),t.ApplyLinearImpulseToCenter(i,!0)}})}start(){for(let t in this.marbleMap){let e=this.marbleMap[t];e.SetAwake(!0),e.SetEnabled(!0)}}step(t){this.deleteCandidates.forEach(t=>{this.world.DestroyBody(t)}),this.deleteCandidates=[],this.world.Step(t,6,2);for(let t=this.entities.length-1;t>=0;t--){let e=this.entities[t];if(e.life>0){let i=e.body.GetContactList();i.contact&&i.contact.IsTouching()&&(this.deleteCandidates.push(e.body),this.entities.splice(t,1))}}}constructor(){this.marbleMap={},this.walls=[],this.entities=[],this.deleteCandidates=[]}}class T extends EventTarget{get isReady(){return this._isReady}constructor(){super(),this._marbles=[],this._lastTime=0,this._elapsed=0,this._noMoveDuration=0,this._shakeAvailable=!1,this._updateInterval=10,this._timeScale=1,this._speed=1,this._winners=[],this._particleManager=new b,this._stage=null,this._camera=new v,this._renderer=new V,this._effects=[],this._winnerRank=0,this._totalMarbleCount=0,this._goalDist=1/0,this._isRunning=!1,this._winner=null,this._uiObjects=[],this._autoRecording=!1,this._isReady=!1,this._renderer.init().then(()=>{this._init().then(()=>{this._isReady=!0,this._update()})})}getZoom(){return 30*this._camera.zoom}addUiObject(t){this._uiObjects.push(t),t.onWheel&&this._renderer.canvas.addEventListener("wheel",t.onWheel)}_update(){this._lastTime||(this._lastTime=Date.now());let t=Date.now();this._elapsed+=(t-this._lastTime)*this._speed,this._elapsed>100&&(this._elapsed%=100),this._lastTime=t;let e=this._updateInterval/1e3*this._timeScale;for(;this._elapsed>=this._updateInterval;)this.physics.step(e),this._updateMarbles(this._updateInterval),this._particleManager.update(this._updateInterval),this._updateEffects(this._updateInterval),this._elapsed-=this._updateInterval,this._uiObjects.forEach(t=>t.update(this._updateInterval));this._marbles.length>1&&this._marbles.sort((t,e)=>e.y-t.y),this._stage&&(this._camera.update({marbles:this._marbles,stage:this._stage,needToZoom:this._goalDist<5,targetIndex:this._winners.length>0?this._winnerRank-this._winners.length:0}),this._isRunning&&this._marbles.length>0&&this._noMoveDuration>3e3?this._changeShakeAvailable(!0):this._changeShakeAvailable(!1)),this._render(),window.requestAnimationFrame(this._update)}_updateMarbles(t){if(!this._stage)return;for(let e=0;e<this._marbles.length;e++){let i=this._marbles[e];i.update(t),i.skill===c.Impact&&(this._effects.push(new M(i.x,i.y)),this.physics.impact(i.id)),i.y>this._stage.goalY&&(this._winners.push(i),this._isRunning&&this._winners.length===this._winnerRank+1?(this.dispatchEvent(new CustomEvent("goal",{detail:{winner:i.name}})),this._winner=i,this._isRunning=!1,this._particleManager.shot(this._renderer.width,this._renderer.height),setTimeout(()=>{this._recorder.stop()},1e3)):this._isRunning&&this._winnerRank===this._winners.length&&this._winnerRank===this._totalMarbleCount-1&&(this.dispatchEvent(new CustomEvent("goal",{detail:{winner:this._marbles[e+1].name}})),this._winner=this._marbles[e+1],this._isRunning=!1,this._particleManager.shot(this._renderer.width,this._renderer.height),setTimeout(()=>{this._recorder.stop()},1e3)),setTimeout(()=>{this.physics.removeMarble(i.id)},500))}let e=this._winnerRank-this._winners.length,i=this._marbles[e]?this._marbles[e].y:0;this._goalDist=Math.abs(this._stage.zoomY-i),this._timeScale=this._calcTimeScale(),this._marbles=this._marbles.filter(t=>t.y<=this._stage.goalY)}_calcTimeScale(){if(!this._stage)return 1;let t=this._winnerRank-this._winners.length;return this._winners.length<this._winnerRank+1&&this._goalDist<5&&this._marbles[t].y>this._stage.zoomY-6&&(this._marbles[t-1]||this._marbles[t+1])?Math.max(.2,this._goalDist/5):1}_updateEffects(t){this._effects.forEach(e=>e.update(t)),this._effects=this._effects.filter(t=>!t.isDestroy)}_render(){if(!this._stage)return;let t={camera:this._camera,stage:this._stage,entities:this.physics.getEntities(),marbles:this._marbles,winners:this._winners,particleManager:this._particleManager,effects:this._effects,winnerRank:this._winnerRank,winner:this._winner,size:{x:this._renderer.width,y:this._renderer.height}};this._renderer.render(t,this._uiObjects)}async _init(){this._recorder=new B(this._renderer.canvas),this.physics=new D,await this.physics.init(),this.addUiObject(new R),this.attachEvent();let t=new E;t.onViewportChange(t=>{t?(this._camera.setPosition(t,!1),this._camera.lock(!0)):this._camera.lock(!1)}),this.addUiObject(t),this._stage=f[0],this._loadMap()}attachEvent(){this._renderer.canvas.addEventListener("mousemove",t=>{let e=this._renderer.sizeFactor,i={x:t.offsetX*e,y:t.offsetY*e};this._uiObjects.forEach(t=>{if(!t.onMouseMove)return;let e=t.getBoundingBox();e?e&&i.x>=e.x&&i.y>=e.y&&i.x<=e.x+e.w&&i.y<=e.y+e.h?t.onMouseMove({x:i.x-e.x,y:i.y-e.y}):t.onMouseMove(void 0):t.onMouseMove({...i})})})}_loadMap(){if(!this._stage)throw Error("No map has been selected");this.physics.createStage(this._stage)}clearMarbles(){this.physics.clearMarbles(),this._winner=null,this._winners=[],this._marbles=[]}start(){this._isRunning=!0,this._winnerRank=x.winningRank,this._winnerRank>=this._marbles.length&&(this._winnerRank=this._marbles.length-1),this._autoRecording?this._recorder.start().then(()=>{this.physics.start(),this._marbles.forEach(t=>t.isActive=!0)}):(this.physics.start(),this._marbles.forEach(t=>t.isActive=!0))}setSpeed(t){if(t<=0)throw Error("Speed multiplier must larger than 0");this._speed=t}getSpeed(){return this._speed}setWinningRank(t){this._winnerRank=t}setAutoRecording(t){this._autoRecording=t}setMarbles(t){this.reset();let e=t.slice(),i=-1/0,s=1/0,o=e.map(t=>{let e=function(t){let e=/\/(\d+)/,i=/\*(\d+)/,s=e.test(t),o=i.test(t),a=u(/^\s*([^\/*]+)?/,t);return a?{name:a,weight:s?parseInt(u(e,t)):1,count:o?parseInt(u(i,t)):1}:null}(t);if(!e)return null;let{name:o,weight:a,count:n}=e;return a>i&&(i=a),a<s&&(s=a),{name:o,weight:a,count:n}}).filter(t=>!!t),a=i-s,n=0;o.forEach(t=>{t&&(t.weight=.1+(a?(t.weight-s)/a:0),n+=t.count)});let r=Array(n).fill(0).map((t,e)=>e).sort(()=>Math.random()-.5);o.forEach(t=>{if(t)for(let e=0;e<t.count;e++){let e=r.pop()||0;this._marbles.push(new m(this.physics,e,n,t.name,t.weight))}}),this._totalMarbleCount=n}_clearMap(){this.physics.clear(),this._marbles=[]}reset(){this.clearMarbles(),this._clearMap(),this._loadMap(),this._goalDist=1/0}getCount(){return this._marbles.length}_changeShakeAvailable(t){this._shakeAvailable!==t&&(this._shakeAvailable=t,this.dispatchEvent(new CustomEvent("shakeAvailableChanged",{detail:t})))}shake(){if(!this._shakeAvailable)return}getMaps(){return f.map((t,e)=>({index:e,title:t.title}))}setMap(t){if(t<0||t>f.length-1)throw Error("Incorrect map number");let e=this._marbles.map(t=>t.name);this._stage=f[t],this.setMarbles(e)}}p([S],T.prototype,"_update",null);const C=new T;window.roullete=C,window.options=x;
//# sourceMappingURL=index.2c415c0a.js.map
