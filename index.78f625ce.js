let t;var e,s,i=globalThis,h={},r={},a=i.parcelRequire5cc2;null==a&&((a=function(t){if(t in h)return h[t].exports;if(t in r){var e=r[t];delete r[t];var s={id:t,exports:{}};return h[t]=s,e.call(s.exports,s,s.exports),s.exports}var i=Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(t,e){r[t]=e},i.parcelRequire5cc2=a);var o=a.register;o("4zFxA",function(t,e){var s=a("Gr8vk");t.exports=Promise.all([s("itWg3"),s("8BShk")]).then(()=>a("jaZ7o"))}),o("Gr8vk",function(t,e){t.exports=function(t){return import(a("27Lyk").resolve(t))}}),o("4Ppm5",function(t,e){var s=a("Gr8vk");t.exports=Promise.all([s("itWg3"),s("ilUZb")]).then(()=>a("6fGU3"))});const n={en:{"Enter names below":"Enter names below",Shuffle:"Shuffle",Start:"Start",Map:"Map",Recording:"Recording","The winner is":"The winner is","Using skills":"Using skills","Buy me a coffee":"Buy me a coffee",First:"First",Last:"Last","Wheel of fortune":"Wheel of fortune",BubblePop:"BubblePop","Pot of greed":"Pot of greed","Shake!":"Shake!","Input names separated by commas or line feed here":"Input names separated by commas or line feed here"},ko:{"Enter names below":"이름들을 입력하세요",Shuffle:"섞기",Start:"시작",Map:"맵",Recording:"녹화","The winner is":"당첨 순위","Using skills":"스킬 활성화","Buy me a coffee":"개발자에게 커피 사주기",First:"첫번째",Last:"마지막","Wheel of fortune":"운명의 수레바퀴",BubblePop:"버블팝","Pot of greed":"욕망의 항아리","Shake!":"흔들기!","Input names separated by commas or line feed here":"이름들을 쉼표나 엔터로 구분해서 넣어주세요"}};function l(e){if(!(e instanceof HTMLElement)||!t)return;let s=e.getAttribute("data-trans");if(s){let i=(e.getAttribute(s)||"").trim();i&&i in n[t]&&e.setAttribute(s,n[t][i])}else{let s=e.innerText.trim();s&&s in n[t]&&(e.innerText=n[t][s])}}function c(t,e,s,i){var h,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,s,i);else for(var o=t.length-1;o>=0;o--)(h=t[o])&&(a=(r<3?h(a):r>3?h(e,s,a):h(e,s))||a);return r>3&&a&&Object.defineProperty(e,s,a),a}function d(t){return Math.PI*t/180}function _(t,e){let s=t.exec(e);return s?s[1]:""}function u(t){return t.toString().padStart(2,"0")}document.addEventListener("DOMContentLoaded",()=>{console.log("localization loaded");let e=navigator.language.split("-")[0];console.log("detected locale: ",e),function(e){if(e===t)return;document.documentElement.lang=e;let s=e.toLocaleLowerCase();t=s in n?s:"en",document.querySelectorAll("[data-trans]").forEach(l)}(e)}),window.translateElement=l,(e=s||(s={}))[e.None=0]="None",e[e.Impact=1]="Impact";const x=new class{constructor(){this.useSkills=!0,this.winningRank=0,this.autoRecording=!0}};class m{static sub(t,e){return{x:e.x-t.x,y:e.y-t.y}}static lenSq(t){return t.x*t.x+t.y*t.y}static len(t){return Math.sqrt(this.lenSq(t))}static mul(t,e){return{x:t.x*e,y:t.y*e}}static add(t,e){return{x:t.x+e.x,y:t.y+e.y}}}class p{get position(){return this.physics.getMarblePosition(this.id)||{x:0,y:0}}get x(){return this.position.x}set x(t){this.position.x=t}get y(){return this.position.y}set y(t){this.position.y=t}constructor(t,e,i,h,r=1){this.type="marble",this.name="",this.size=.5,this.color="red",this.hue=0,this.impact=0,this.weight=1,this.skill=s.None,this.isActive=!1,this._skillRate=5e-4,this._coolTime=5e3,this._maxCoolTime=5e3,this._stuckTime=0,this.lastPosition={x:0,y:0},this.name=h||`M${e}`,this.weight=r,this.physics=t,this._maxCoolTime=1e3+(1-this.weight)*4e3,this._coolTime=this._maxCoolTime*Math.random(),this._skillRate=.2*this.weight;let a=Math.ceil(i/10),o=Math.floor(e/10);this.hue=360/i*e,this.color=`hsl(${this.hue} 100% 70%)`,this.id=e,t.createMarble(e,10.25+e%10*.6,a-o+-Math.max(0,Math.ceil(a-5)))}update(t){this.isActive&&1e-5>m.lenSq(m.sub(this.lastPosition,this.position))?(this._stuckTime+=t,this._stuckTime>5e3&&(this.physics.shakeMarble(this.id),this._stuckTime=0)):this._stuckTime=0,this.lastPosition={x:this.position.x,y:this.position.y},this.skill=s.None,this.impact&&(this.impact=Math.max(0,this.impact-t)),this.isActive&&x.useSkills&&this._updateSkillInformation(t)}_updateSkillInformation(t){this._coolTime>0&&(this._coolTime-=t),this._coolTime<=0&&(this.skill=Math.random()<this._skillRate?s.Impact:s.None,this._coolTime=this._maxCoolTime)}render(t,e,s,i=!1){t.save(),i?this._renderMinimap(t):this._renderNormal(t,e,s),t.restore()}_renderMinimap(t){t.fillStyle=this.color,this._drawMarbleBody(t,!0)}_drawMarbleBody(t,e){t.beginPath(),t.arc(this.x,this.y,e?this.size:this.size/2,0,2*Math.PI),t.fill()}_renderNormal(t,e,s){t.fillStyle=`hsl(${this.hue} 100% ${70+25*Math.min(1,this.impact/500)}%`,this._stuckTime>0&&(t.fillStyle=`hsl(${this.hue} 100% ${70+25*Math.min(1,this._stuckTime/5e3)}%`),t.shadowColor=this.color,t.shadowBlur=e/2,this._drawMarbleBody(t,!1),t.shadowColor="",t.shadowBlur=0,this._drawName(t,e),s&&this._drawOutline(t,2/e),x.useSkills&&this._renderCooltime(t,e)}_drawName(t,e){t.save(),t.translate(this.x,this.y+.25),t.scale(1/e,1/e),t.font="12pt sans-serif",t.strokeStyle="black",t.lineWidth=2,t.fillStyle=this.color,t.shadowBlur=0,t.strokeText(this.name,0,0),t.fillText(this.name,0,0),t.restore()}_drawOutline(t,e){t.save(),t.beginPath(),t.strokeStyle="white",t.lineWidth=e,t.arc(this.x,this.y,this.size/2,0,2*Math.PI),t.stroke(),t.restore()}_renderCooltime(t,e){t.strokeStyle="red",t.lineWidth=1/e,t.beginPath(),t.arc(this.x,this.y,this.size/2+2/e,d(270),d(270+360*this._coolTime/this._maxCoolTime)),t.stroke()}_renderStuck(t,e){t.strokeStyle="green",t.lineWidth=1/e,t.beginPath(),t.arc(this.x,this.y,this.size/2+3/e,d(270),d(270+360*(1-this._stuckTime/5e3))),t.stroke()}}class g{constructor(t,e){this._elapsed=0,this.position={x:0,y:0},this.force={x:0,y:0},this.color="",this.isDestroy=!1,this.position.x=t,this.position.y=e;let s=250*Math.random(),i=d(90*Math.random()-180);this.color=`hsl(${360*Math.random()} 50% 50%)`,this.force={x:Math.cos(i)*s,y:Math.sin(i)*s}}update(t){this._elapsed+=t;let e=m.mul(this.force,t/100);this.position=m.add(this.position,e),this.force.y+=10*t/100,this._elapsed>3e3&&(this.isDestroy=!0)}render(t){t.save(),t.globalAlpha=1-Math.pow(this._elapsed/3e3,2),t.fillStyle=this.color,t.fillRect(this.position.x,this.position.y,20,20),t.restore()}}class w{update(t){this._particles.forEach(e=>{e.update(t)}),this._particles=this._particles.filter(t=>!t.isDestroy)}render(t){this._particles.forEach(e=>e.render(t))}shot(t,e){for(let s=0;s<200;s++)this._particles.push(new g(t,e))}constructor(){this._particles=[]}}const y=[{title:"Wheel of fortune",goalY:111,zoomY:106.75,walls:[[[16.5,-300],[9.25,-300],[9.25,8.5],[2,19.25],[2,26],[9.75,30],[9.75,33.5],[1.25,41],[1.25,53.75],[8.25,58.75],[8.25,63],[9.25,64],[8.25,65],[8.25,99.25],[15.1,106.75],[15.1,111.75]],[[16.5,-300],[16.5,9.25],[9.5,20],[9.5,22.5],[17.5,26],[17.5,33.5],[24,38.5],[19,45.5],[19,55.5],[24,59.25],[24,63],[23,64],[24,65],[24,100.5],[16,106.75],[16,111.75]],[[12.75,37.5],[7,43.5],[7,49.75],[12.75,53.75],[12.75,37.5]],[[14.75,37.5],[14.75,43],[17.5,40.25],[14.75,37.5]]],boxes:[[15.5,30,-45,.2,.2],[15.5,32,-45,.2,.2],[15.5,28,-45,.2,.2],[12.5,30,-45,.2,.2],[12.5,32,-45,.2,.2],[12.5,28,-45,.2,.2],[9.4,66.6,45,.6,.1],[11.3,66.6,45,.6,.1],[13.2,66.6,45,.6,.1],[15.1,66.6,45,.6,.1],[17,66.6,45,.6,.1],[18.9,66.6,45,.6,.1],[20.699999999999996,66.6,45,.6,.1],[22.7,66.6,45,.6,.1],[9.4,69.1,-45,.6,.1],[11.3,69.1,-45,.6,.1],[13.2,69.1,-45,.6,.1],[15.1,69.1,-45,.6,.1],[17,69.1,-45,.6,.1],[18.9,69.1,-45,.6,.1],[20.699999999999996,69.1,-45,.6,.1],[22.7,69.1,-45,.6,.1],[9.5,92,d(45),.25,.25],[12.75,92,d(45),.25,.25],[16,92,d(45),.25,.25],[19.25,92,d(45),.25,.25],[22.5,92,d(45),.25,.25],[11,95,d(45),.25,.25],[14.25,95,d(45),.25,.25],[17.5,95,d(45),.25,.25],[20.75,95,d(45),.25,.25],[9.5,98,d(45),.25,.25],[12.75,98,d(45),.25,.25],[16,98,d(45),.25,.25],[19.25,98,d(45),.25,.25],[22.5,98,d(45),.25,.25]],wheels:[[8,75,3.5],[12,75,-3.5],[16,75,3.5],[20,75,-3.5],[24,75,3.5],[14,106.75,-1.2]]},{title:"BubblePop",goalY:83,zoomY:78,walls:[[[16.5,-300],[9.25,-300],[9.25,0],[9.25,43],[4.25,50],[9.25,53],[9.25,75],[12,80],[12,83]],[[16.5,-300],[16.5,50],[19.5,54],[18.5,56],[19.5,58],[16.5,61],[16.5,75],[13,80],[13,83]],[[16.5,52.5],[17.5,54],[16.5,56],[17.5,58],[16.5,59],[15.5,56],[16.5,52.5]],[[9.25,45.5],[6.25,49.5],[9.25,51],[14.5,50.5],[9.25,45.5]],[[9.25,26],[11.0625,27.5]],[[16.5,26],[14.6875,27.5]],[[11.0625,30],[12.875,28.5],[14.6875,30]],[[9.25,31],[11.0625,32.5]],[[16.5,31],[14.6875,32.5]],[[11.0625,35],[12.875,33.5],[14.6875,35]]],wheels:[[10.7,10,10,0,0,.5],[14.7,10,-10,0,0,.5],[12.7,10,10,0,0,.5],[10.7,14,-3],[14.7,14,3],[11.2,44,-5,0,0,.5],[10.3,75,8,0,0,1],[15.2,75,-8,0,0,1]],boxes:[[9.25,18,d(45),.15,.15],[11.25,18,d(45),.15,.15],[13.25,18,d(45),.15,.15],[15.25,18,d(45),.15,.15],[10.5,19,d(45),.15,.15],[12.5,19,d(45),.15,.15],[14.5,19,d(45),.15,.15],[16.5,19,d(45),.15,.15],[9.25,20,d(45),.15,.15],[11.25,20,d(45),.15,.15],[13.25,20,d(45),.15,.15],[15.25,20,d(45),.15,.15],[10.5,21,d(45),.15,.15],[12.5,21,d(45),.15,.15],[14.5,21,d(45),.15,.15],[16.5,21,d(45),.15,.15],[9.25,22,d(45),.15,.15],[11.25,22,d(45),.15,.15],[13.25,22,d(45),.15,.15],[15.25,22,d(45),.15,.15],[10.5,23,d(45),.15,.15],[12.5,23,d(45),.15,.15],[14.5,23,d(45),.15,.15],[16.5,23,d(45),.15,.15],[9.4,39,d(45),3,3],[16.5,43,d(45),3,3]],jumpers:[[11,65,.5,!0],[13,65,.5,!0],[15,65,.5,!0],[12,67.5,.5,!0],[14,67.5,.5,!0],[13,71,.8,!0],[10.7,77.5,.8,!0],[14.7,77.5,.8,!0],[12.625,80,1.5,!0],[12.625,80,1.2,!0]]},{title:"Pot of greed",goalY:111,zoomY:110,walls:[[[17,-300],[9,-300],[9,8.5],[2,15],[6,61.5]],[[7,71],[9,101],[8,100.5],[6,100],[5,90],[4,70],[7,71]],[[17,-300],[17,8.5],[24,15],[20,61.5]],[[19,71],[17,101],[18,100.5],[20,100],[21,90],[22,70],[19,71]],[[11,88],[12,90],[12,112]],[[15,88],[14,90],[14,112]],[[12,102],[11,103],[9,104],[8,104],[6,103],[5,102],[4,100],[3,90],[2,70],[3,65],[4,63],[5,62],[6,61.5]],[[14,102],[15,103],[17,104],[18,104],[20,103],[21,102],[22,100],[23,90],[24,70],[23,65],[22,63],[21,62],[20,61.5]]],boxes:[[13,20,d(45),3,3],[13,55,d(45),3,3],[8,37,d(45),2,2],[18,37,d(45),2,2]],jumpers:[],wheels:[[11,12,-3],[15,12,3],[8,104,-10,0,0,1],[6,103,-10,0,0,1.5],[4,100,-10,0,0,1.5],[3.5,95,-10],[3,90,-10],[2.75,85,-10],[2.5,80,-10],[2.25,75,-10],[2,70,-10],[18,104,10,0,0,1],[20,103,10,0,0,1.5],[22,100,10,0,0,1.5],[22.5,95,10],[23,90,10],[23.25,85,10],[23.5,80,10],[23.75,75,10],[24,70,10]]}];class f{get zoom(){return this._zoom}set zoom(t){this._targetZoom=t}get x(){return this._position.x}set x(t){this._targetPosition.x=t}get y(){return this._position.y}set y(t){this._targetPosition.y=t}get position(){return this._position}setPosition(t,e=!1){return e?this._position={x:t.x,y:t.y}:this._targetPosition={x:t.x,y:t.y}}lock(t){this._locked=t}update({marbles:t,stage:e,needToZoom:s,targetIndex:i}){this._locked||this._calcTargetPositionAndZoom(t,e,s,i),this._position.x=this._interpolation(this.x,this._targetPosition.x),this._position.y=this._interpolation(this.y,this._targetPosition.y),this._zoom=this._interpolation(this._zoom,this._targetZoom)}_calcTargetPositionAndZoom(t,e,s,i){if(t.length>0){let h=t[i]?t[i]:t[0];if(this.setPosition(h.position),s){let t=Math.abs(e.zoomY-this._position.y);this.zoom=Math.max(1,(1-t/5)*4)}else this.zoom=1}else this.setPosition({x:0,y:0}),this.zoom=1}_interpolation(t,e){let s=e-t;return .03333333333333333>Math.abs(s)?e:t+s/10}renderScene(t,e){let s=60*this._zoom;t.save(),t.translate(-this.x*this._zoom,-this.y*this._zoom),t.scale(this.zoom,this.zoom),t.translate(t.canvas.width/s,t.canvas.height/s),e(t),t.restore()}constructor(){this._position={x:0,y:0},this._targetPosition={x:0,y:0},this._zoom=1,this._targetZoom=1,this._locked=!1}}class b{constructor(){this.sizeFactor=1}get width(){return this._canvas.width}get height(){return this._canvas.height}get canvas(){return this._canvas}init(){this._canvas=document.createElement("canvas"),this._canvas.width=1600,this._canvas.height=900,this.ctx=this._canvas.getContext("2d",{alpha:!1}),document.body.appendChild(this._canvas);let t=t=>{let e=t?t[0].contentRect:this._canvas.getBoundingClientRect(),s=Math.max(e.width/2,640),i=s/e.width*e.height;this._canvas.width=s,this._canvas.height=i,this.sizeFactor=s/e.width};new ResizeObserver(t).observe(this._canvas),t()}render(t,e){this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this._canvas.width,this._canvas.height),this.ctx.save(),this.ctx.scale(30,30),this.ctx.textAlign="left",this.ctx.textBaseline="top",this.ctx.font="0.4pt sans-serif",this.ctx.lineWidth=3/(t.camera.zoom+30),t.camera.renderScene(this.ctx,()=>{this._renderWalls({...t}),this.renderBoxes(t.boxes),this.renderWheels(t.wheels),this.renderJumpers(t.jumpers),this.renderEffects(t),this.renderMarbles(t)}),this.ctx.restore(),e.forEach(e=>e.render(this.ctx,t,this._canvas.width,this._canvas.height)),t.particleManager.render(this.ctx),this.renderWinner(t)}_renderWalls({stage:t,camera:e}){t&&(this.ctx.save(),this.ctx.strokeStyle="white",this.ctx.lineWidth=5/(e.zoom+30),this.ctx.beginPath(),t.walls.forEach(t=>{this.ctx.moveTo(t[0][0],t[0][1]);for(let e=1;e<t.length;e++)this.ctx.lineTo(t[e][0],t[e][1])}),this.ctx.shadowColor="cyan",this.ctx.shadowBlur=15,this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore())}renderWheels(t){this.ctx.save(),this.ctx.fillStyle="#94d5ed",this.ctx.strokeStyle="#94d5ed",this.ctx.shadowBlur=15,this.ctx.shadowColor="cyan",t.forEach(t=>{this.ctx.save(),this.ctx.translate(t.x,t.y),this.ctx.rotate(t.angle),this.ctx.fillRect(-t.size,-.05,2*t.size,.1),this.ctx.strokeRect(-t.size,-.05,2*t.size,.1),this.ctx.restore()}),this.ctx.restore()}renderBoxes(t){this.ctx.save(),this.ctx.fillStyle="#94d5ed",this.ctx.strokeStyle="#94d5ed",t.forEach(t=>{this.ctx.save(),this.ctx.translate(t.x,t.y),this.ctx.rotate(t.angle),this.ctx.fillRect(-t.width/2,-t.height/2,t.width,t.height),this.ctx.shadowBlur=15,this.ctx.shadowColor="cyan",this.ctx.strokeRect(-t.width/2,-t.height/2,t.width,t.height),this.ctx.restore()}),this.ctx.restore()}renderJumpers(t){this.ctx.save(),this.ctx.fillStyle="yellow",this.ctx.strokeStyle="yellow",t.forEach(t=>{this.ctx.save(),this.ctx.translate(t.x,t.y),this.ctx.beginPath(),this.ctx.arc(0,0,t.radius,0,2*Math.PI,!1),this.ctx.shadowBlur=15,this.ctx.shadowColor="yellow",this.ctx.stroke(),this.ctx.restore()}),this.ctx.restore()}renderEffects({effects:t,camera:e}){t.forEach(t=>t.render(this.ctx,30*e.zoom))}renderMarbles({marbles:t,camera:e,winnerRank:s,winners:i}){let h=s-i.length;t.forEach((t,s)=>{t.render(this.ctx,30*e.zoom,s===h,!1)})}renderWinner({winner:t}){t&&(this.ctx.save(),this.ctx.fillStyle="rgba(0, 0, 0, 0.5)",this.ctx.fillRect(this._canvas.width/2,this._canvas.height-168,this._canvas.width/2,168),this.ctx.fillStyle="white",this.ctx.font="bold 48px sans-serif",this.ctx.textAlign="right",this.ctx.fillText("Winner",this._canvas.width-10,this._canvas.height-120),this.ctx.font="bold 72px sans-serif",this.ctx.fillStyle=t.color,this.ctx.fillText(t.name,this._canvas.width-10,this._canvas.height-55),this.ctx.restore())}}class v{constructor(t,e){this._size=0,this._elapsed=0,this.isDestroy=!1,this.position={x:t,y:e}}update(t){this._elapsed+=t,this._size=this._elapsed/500*10,this._elapsed>500&&(this.isDestroy=!0)}render(t,e){t.save();let s=this._elapsed/500;t.globalAlpha=1-s*s,t.strokeStyle="white",t.lineWidth=1/e,t.beginPath(),t.arc(this.position.x,this.position.y,this._size,0,2*Math.PI),t.stroke(),t.restore()}}function M(t,e,s){return{configurable:!0,get(){let t=s.value.bind(this);return Object.defineProperty(this,e,{value:t,configurable:!0,writable:!0}),t}}}class k{constructor(){this._currentY=0,this._targetY=0,this.fontHeight=16,this._userMoved=0,this._currentWinner=-1,this.maxY=0}onWheel(t){this._targetY+=t.deltaY,this._targetY>this.maxY&&(this._targetY=this.maxY),this._userMoved=2e3}render(t,{winners:e,marbles:s,winnerRank:i},h,r){let a=h-5,o=Math.max(0,this._currentY-r/2);this.maxY=Math.max(0,(s.length+e.length)*this.fontHeight),this._currentWinner=e.length,t.save(),t.translate(0,-o),t.font="bold 11pt sans-serif",t.textAlign="right",e.forEach((e,s)=>{let h=s*this.fontHeight;h>=o&&h<=o+t.canvas.height&&(t.fillStyle=e.color,t.fillText(`${s===i?"☆":"✔"} ${e.name} #${s+1}`,a,20+h))}),t.font="10pt sans-serif",s.forEach((s,i)=>{let h=(i+e.length)*this.fontHeight;h>=o&&h<=o+t.canvas.height&&(t.fillStyle=s.color,t.fillText(`${s.name} #${i+1+e.length}`,a,20+h))}),t.restore()}update(t){-1!==this._currentWinner&&(this._userMoved>0?this._userMoved-=t:this._targetY=this._currentWinner*this.fontHeight,this._currentY!==this._targetY&&(this._currentY+=(this._targetY-this._currentY)*(t/250)),1>Math.abs(this._currentY-this._targetY)&&(this._currentY=this._targetY))}getBoundingBox(){return null}}c([M],k.prototype,"onWheel",null);class B{constructor(){this.lastParams=null,this._onViewportChangeHandler=null,this.mousePosition=null,this.boundingBox={x:10,y:10,w:104,h:0}}getBoundingBox(){return this.boundingBox}onViewportChange(t){this._onViewportChangeHandler=t}update(t){}onMouseMove(t){if(!t){this.mousePosition=null,this._onViewportChangeHandler&&this._onViewportChangeHandler();return}this.lastParams&&(this.mousePosition={x:t.x,y:t.y},this._onViewportChangeHandler&&this._onViewportChangeHandler({x:this.mousePosition.x/4,y:this.mousePosition.y/4}))}render(t,e){if(!t)return;let{stage:s}=e;s&&(this.boundingBox.h=4*s.goalY,this.lastParams=e,this.ctx=t,t.save(),t.fillStyle="#333",t.translate(10,10),t.scale(4,4),t.fillRect(0,0,26,s.goalY),this.ctx.lineWidth=3/(e.camera.zoom+30),this.drawWalls(e),this.drawWheels(e.wheels),this.drawBoxes(e.boxes),this.drawJumpers(e.jumpers),this.drawMarbles(e),this.drawViewport(e),t.restore(),t.save(),t.strokeStyle="green",t.lineWidth=1,t.strokeRect(this.boundingBox.x,this.boundingBox.y,this.boundingBox.w,this.boundingBox.h),t.restore())}drawViewport(t){this.ctx.save();let{camera:e,size:s}=t,i=30*e.zoom,h=s.x/i,r=s.y/i;this.ctx.strokeStyle="white",this.ctx.lineWidth=1/i,this.ctx.strokeRect(e.x-h/2,e.y-r/2,h,r),this.ctx.restore()}drawWalls(t){t.stage&&(this.ctx.save(),this.ctx.strokeStyle="black",this.ctx.lineWidth=.5,this.ctx.beginPath(),t.stage.walls.forEach(t=>{this.ctx.moveTo(t[0][0],t[0][1]);for(let e=1;e<t.length;e++)this.ctx.lineTo(t[e][0],t[e][1])}),this.ctx.stroke(),this.ctx.closePath(),this.ctx.restore())}drawWheels(t){this.ctx.save(),this.ctx.fillStyle="#94d5ed",t.forEach(t=>{this.ctx.save(),this.ctx.translate(t.x,t.y),this.ctx.rotate(t.angle),this.ctx.fillRect(-t.size,-.05,2*t.size,.1),this.ctx.restore()}),this.ctx.restore()}drawBoxes(t){this.ctx.save(),this.ctx.fillStyle="#94d5ed",this.ctx.strokeStyle="#94d5ed",t.forEach(t=>{this.ctx.save(),this.ctx.translate(t.x,t.y),this.ctx.rotate(t.angle),this.ctx.fillRect(-t.width/2,-t.height/2,t.width,t.height),this.ctx.strokeRect(-t.width/2,-t.height/2,t.width,t.height),this.ctx.restore()}),this.ctx.restore()}drawJumpers(t){this.ctx.save(),this.ctx.fillStyle="yellow",this.ctx.strokeStyle="yellow",t.forEach(t=>{this.ctx.save(),this.ctx.translate(t.x,t.y),this.ctx.beginPath(),this.ctx.arc(0,0,t.radius,0,2*Math.PI,!1),this.ctx.stroke(),this.ctx.restore()}),this.ctx.restore()}drawMarbles(t){let{marbles:e}=t;e.forEach(t=>{t.render(this.ctx,1,!1,!0)})}}c([M],B.prototype,"onMouseMove",null);class S{constructor(t){this.chunks=[],this.stopping=!1,this.targetCanvas=t,this.videoStream=this.targetCanvas.captureStream(),this.mediaRecorder=new MediaRecorder(this.videoStream,{videoBitsPerSecond:6e6})}async start(){return this.stopping=!1,new Promise(t=>{this.chunks=[],this.mediaRecorder.ondataavailable=t=>{this.chunks.push(t.data)},this.mediaRecorder.onstop=()=>{let t=new Blob(this.chunks,{type:"video/webm"}),e=URL.createObjectURL(t),s=document.createElement("a"),i=new Date;s.href=e,s.download=`marble_roulette_${i.getFullYear()}${u(i.getMonth()+1)}${u(i.getDate())}${u(i.getHours())}${u(i.getMinutes())}${u(i.getSeconds())}.webm`,s.click(),s.remove(),URL.revokeObjectURL(e)},this.mediaRecorder.onstart=()=>{t()},this.mediaRecorder.start()})}stop(){this.stopping=!0,"recording"===this.mediaRecorder.state&&this.mediaRecorder.stop()}}var R=async(...t)=>{let e=WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])),{default:s}=await (e?a("4zFxA"):a("4Ppm5"));return await s(...t)};class E{async init(){this.Box2D=await R(),this.gravity=new this.Box2D.b2Vec2(0,10),this.world=new this.Box2D.b2World(this.gravity),console.log("box2d ready")}clear(){this.clearWalls(),this.clearWheels(),this.clearBoxes(),this.clearJumpers()}clearMarbles(){Object.values(this.marbleMap).forEach(t=>{this.world.DestroyBody(t)}),this.marbleMap={}}createStage(t){this.createWalls(t.walls),this.createWheels(t.wheels),this.createBoxes(t.boxes),this.createJumpers(t.jumpers)}createJumpers(t){t&&t.forEach(t=>{let[e,s,i,h]=t,r=new this.Box2D.b2BodyDef;r.set_type(this.Box2D.b2_staticBody);let a=this.world.CreateBody(r),o=new this.Box2D.b2CircleShape;o.set_m_radius(i);let n=new this.Box2D.b2FixtureDef;n.set_density(1),n.set_restitution(1.5),n.set_shape(o),a.CreateFixture(n),a.SetTransform(new this.Box2D.b2Vec2(e,s),0),this.jumpers.push({x:e,y:s,radius:i,body:a,isTemporary:!!h})})}clearJumpers(){this.jumpers.forEach(t=>{this.world.DestroyBody(t.body)}),this.jumpers=[]}createWheels(t){t.forEach(t=>{let e={x:t[0],y:t[1]},s=t[2];t[3],t[4];let i=t[5]??2,h=new this.Box2D.b2BodyDef;h.set_type(this.Box2D.b2_kinematicBody);let r=this.world.CreateBody(h),a=new this.Box2D.b2PolygonShape;a.SetAsBox(i,.1);let o=new this.Box2D.b2FixtureDef;o.set_density(1),o.set_shape(a),r.CreateFixture(o),r.SetAngularVelocity(s),r.SetTransform(new this.Box2D.b2Vec2(e.x,e.y),0),this.wheels.push({body:r,size:i})})}clearWheels(){this.wheels.forEach(t=>{this.world.DestroyBody(t.body)}),this.wheels=[]}createWalls(t){t.forEach(t=>{let e=new this.Box2D.b2BodyDef;e.set_type(this.Box2D.b2_staticBody);let s=this.world.CreateBody(e);for(let e=0;e<t.length-1;e++){let i=t[e],h=t[e+1],r=new this.Box2D.b2Vec2(i[0],i[1]),a=new this.Box2D.b2Vec2(h[0],h[1]),o=new this.Box2D.b2EdgeShape;o.SetTwoSided(r,a),s.CreateFixture(o,1)}this.walls.push(s)})}clearWalls(){this.walls.forEach(t=>{this.world.DestroyBody(t)}),this.walls=[]}createBoxes(t){t.forEach(t=>{let e={x:t[0],y:t[1]},s=t[3]??.5,i=t[4]??.25,h=t[2]??0,r=new this.Box2D.b2BodyDef;r.set_type(this.Box2D.b2_staticBody);let a=this.world.CreateBody(r),o=new this.Box2D.b2PolygonShape;o.SetAsBox(s,i,0,h),a.CreateFixture(o,1),a.SetTransform(new this.Box2D.b2Vec2(e.x,e.y),0),this.boxes.push({body:a,width:2*s,height:2*i,x:e.x,y:e.y,angle:h})})}clearBoxes(){this.boxes.forEach(t=>{this.world.DestroyBody(t.body)}),this.boxes=[]}createMarble(t,e,s){let i=new this.Box2D.b2CircleShape;i.set_m_radius(.25);let h=new this.Box2D.b2BodyDef;h.set_type(this.Box2D.b2_dynamicBody),h.set_position(new this.Box2D.b2Vec2(e,s));let r=this.world.CreateBody(h);r.CreateFixture(i,1+Math.random()),r.SetAwake(!1),r.SetEnabled(!1),this.marbleMap[t]=r}shakeMarble(t){let e=this.marbleMap[t];e&&e.ApplyLinearImpulseToCenter(new this.Box2D.b2Vec2(10*Math.random()-5,10*Math.random()-5),!0)}removeMarble(t){let e=this.marbleMap[t];e&&(this.world.DestroyBody(e),delete this.marbleMap[t])}getMarblePosition(t){let e=this.marbleMap[t];return e?e.GetPosition():{x:0,y:0}}getWheels(){return this.wheels.map(t=>{let e=t.body.GetPosition();return{x:e.x,y:e.y,size:t.size,angle:t.body.GetAngle()}})}getBoxes(){return this.boxes}getJumpers(){return this.jumpers}impact(t){let e=this.marbleMap[t];e&&Object.values(this.marbleMap).forEach(t=>{if(t===e)return;let s=new this.Box2D.b2Vec2(t.GetPosition().x,t.GetPosition().y);if(s.op_sub(e.GetPosition()),100>s.LengthSquared()){s.Normalize();let e=1-s.Length()/10;s.op_mul(e*e*5),t.ApplyLinearImpulseToCenter(s,!0)}})}start(){for(let t in this.marbleMap){let e=this.marbleMap[t];e.SetAwake(!0),e.SetEnabled(!0)}}step(t){this.deleteCandidates.forEach(t=>{this.world.DestroyBody(t)}),this.deleteCandidates=[],this.world.Step(t,6,2);for(let t=this.jumpers.length-1;t>=0;t--){let e=this.jumpers[t].body.GetContactList();e.contact&&e.contact.IsTouching()&&this.deleteCandidates.push(...this.jumpers.splice(t,1).map(t=>t.body))}}constructor(){this.marbleMap={},this.walls=[],this.boxes=[],this.wheels=[],this.jumpers=[],this.deleteCandidates=[]}}class P extends EventTarget{get isReady(){return this._isReady}constructor(){super(),this._marbles=[],this._lastTime=0,this._elapsed=0,this._noMoveDuration=0,this._shakeAvailable=!1,this._updateInterval=10,this._timeScale=1,this._speed=1,this._winners=[],this._particleManager=new w,this._stage=null,this._camera=new f,this._renderer=new b,this._effects=[],this._winnerRank=0,this._totalMarbleCount=0,this._goalDist=1/0,this._isRunning=!1,this._winner=null,this._uiObjects=[],this._autoRecording=!1,this._isReady=!1,this._renderer.init(),this._init().then(()=>{this._isReady=!0,this._update()})}getZoom(){return 30*this._camera.zoom}addUiObject(t){this._uiObjects.push(t),t.onWheel&&this._renderer.canvas.addEventListener("wheel",t.onWheel)}_update(){this._lastTime||(this._lastTime=Date.now());let t=Date.now();this._elapsed+=(t-this._lastTime)*this._speed,this._elapsed>100&&(this._elapsed%=100),this._lastTime=t;let e=this._updateInterval/1e3*this._timeScale;for(;this._elapsed>=this._updateInterval;)this.physics.step(e),this._updateMarbles(this._updateInterval),this._particleManager.update(this._updateInterval),this._updateEffects(this._updateInterval),this._elapsed-=this._updateInterval,this._uiObjects.forEach(t=>t.update(this._updateInterval));this._marbles.length>1&&this._marbles.sort((t,e)=>e.y-t.y),this._stage&&(this._camera.update({marbles:this._marbles,stage:this._stage,needToZoom:this._goalDist<5,targetIndex:this._winners.length>0?this._winnerRank-this._winners.length:0}),this._isRunning&&this._marbles.length>0&&this._noMoveDuration>3e3?this._changeShakeAvailable(!0):this._changeShakeAvailable(!1)),this._render(),window.requestAnimationFrame(this._update)}_updateMarbles(t){if(!this._stage)return;for(let e=0;e<this._marbles.length;e++){let i=this._marbles[e];i.update(t),i.skill===s.Impact&&(this._effects.push(new v(i.x,i.y)),this.physics.impact(i.id)),i.y>this._stage.goalY&&(this._winners.push(i),this._isRunning&&this._winners.length===this._winnerRank+1?(this.dispatchEvent(new CustomEvent("goal",{detail:{winner:i.name}})),this._winner=i,this._isRunning=!1,this._particleManager.shot(this._renderer.width,this._renderer.height),setTimeout(()=>{this._recorder.stop()},1e3)):this._isRunning&&this._winnerRank===this._winners.length&&this._winnerRank===this._totalMarbleCount-1&&(this.dispatchEvent(new CustomEvent("goal",{detail:{winner:this._marbles[e+1].name}})),this._winner=this._marbles[e+1],this._isRunning=!1,this._particleManager.shot(this._renderer.width,this._renderer.height),setTimeout(()=>{this._recorder.stop()},1e3)),setTimeout(()=>{this.physics.removeMarble(i.id)},500))}let e=this._winnerRank-this._winners.length,i=this._marbles[e]?this._marbles[e].y:0;this._goalDist=Math.abs(this._stage.zoomY-i),this._timeScale=this._calcTimeScale(),this._marbles=this._marbles.filter(t=>t.y<=this._stage.goalY)}_calcTimeScale(){if(!this._stage)return 1;let t=this._winnerRank-this._winners.length;return this._winners.length<this._winnerRank+1&&this._goalDist<5&&this._marbles[t].y>this._stage.zoomY-6&&(this._marbles[t-1]||this._marbles[t+1])?Math.max(.2,this._goalDist/5):1}_updateEffects(t){this._effects.forEach(e=>e.update(t)),this._effects=this._effects.filter(t=>!t.isDestroy)}_render(){if(!this._stage)return;let t={camera:this._camera,stage:this._stage,wheels:this.physics.getWheels(),boxes:this.physics.getBoxes(),jumpers:this.physics.getJumpers(),marbles:this._marbles,winners:this._winners,particleManager:this._particleManager,effects:this._effects,winnerRank:this._winnerRank,winner:this._winner,size:{x:this._renderer.width,y:this._renderer.height}};this._renderer.render(t,this._uiObjects)}async _init(){this._recorder=new S(this._renderer.canvas),this.physics=new E,await this.physics.init(),this.addUiObject(new k),this.attachEvent();let t=new B;t.onViewportChange(t=>{t?(this._camera.setPosition(t,!1),this._camera.lock(!0)):this._camera.lock(!1)}),this.addUiObject(t),this._stage=y[0],this._loadMap()}attachEvent(){this._renderer.canvas.addEventListener("mousemove",t=>{let e=this._renderer.sizeFactor,s={x:t.offsetX*e,y:t.offsetY*e};this._uiObjects.forEach(t=>{if(!t.onMouseMove)return;let e=t.getBoundingBox();e?e&&s.x>=e.x&&s.y>=e.y&&s.x<=e.x+e.w&&s.y<=e.y+e.h?t.onMouseMove({x:s.x-e.x,y:s.y-e.y}):t.onMouseMove(void 0):t.onMouseMove({...s})})})}_loadMap(){if(!this._stage)throw Error("No map has been selected");this.physics.createStage(this._stage)}clearMarbles(){this.physics.clearMarbles(),this._winner=null,this._winners=[],this._marbles=[]}start(){this._isRunning=!0,this._winnerRank=x.winningRank,this._winnerRank>=this._marbles.length&&(this._winnerRank=this._marbles.length-1),this._autoRecording?this._recorder.start().then(()=>{this.physics.start(),this._marbles.forEach(t=>t.isActive=!0)}):(this.physics.start(),this._marbles.forEach(t=>t.isActive=!0))}setSpeed(t){if(t<=0)throw Error("Speed multiplier must larger than 0");this._speed=t}getSpeed(){return this._speed}setWinningRank(t){this._winnerRank=t}setAutoRecording(t){this._autoRecording=t}setMarbles(t){this.reset();let e=t.slice(),s=-1/0,i=1/0,h=e.map(t=>{let e=function(t){let e=/(\/\d+)/,s=/(\*\d+)/,i=e.test(t),h=s.test(t),r=_(/^\s*([^\/*]+)?/,t);return r?{name:r,weight:i?parseInt(_(e,t).replace("/","")):1,count:h?parseInt(_(s,t).replace("*","")):1}:null}(t);if(!e)return null;let{name:h,weight:r,count:a}=e;return r>s&&(s=r),r<i&&(i=r),{name:h,weight:r,count:a}}).filter(t=>!!t),r=s-i,a=0;h.forEach(t=>{t&&(t.weight=.1+(r?(t.weight-i)/r:0),a+=t.count)});let o=Array(a).fill(0).map((t,e)=>e).sort(()=>Math.random()-.5);h.forEach(t=>{if(t)for(let e=0;e<t.count;e++){let e=o.pop()||0;this._marbles.push(new p(this.physics,e,a,t.name,t.weight))}}),this._totalMarbleCount=a}_clearMap(){this.physics.clear(),this._marbles=[]}reset(){this.clearMarbles(),this._clearMap(),this._loadMap(),this._goalDist=1/0}getCount(){return this._marbles.length}_changeShakeAvailable(t){this._shakeAvailable!==t&&(this._shakeAvailable=t,this.dispatchEvent(new CustomEvent("shakeAvailableChanged",{detail:t})))}shake(){if(!this._shakeAvailable)return}getMaps(){return y.map((t,e)=>({index:e,title:t.title}))}setMap(t){if(t<0||t>y.length-1)throw Error("Incorrect map number");let e=this._marbles.map(t=>t.name);this._stage=y[t],this.setMarbles(e)}}c([M],P.prototype,"_update",null);const D=new P;window.roullete=D,window.options=x;
//# sourceMappingURL=index.78f625ce.js.map
